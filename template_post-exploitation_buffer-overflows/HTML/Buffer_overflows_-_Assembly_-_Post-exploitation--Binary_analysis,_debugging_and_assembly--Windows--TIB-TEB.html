<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TIB/TEB</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">TIB/TEB</h1><br/>In computing, the Win32 Thread Information Block (TIB) is a data structure in Win32 on x86 that stores information about the currently running thread. This structure is also known as the Thread Environment Block (TEB).[1]<br /><br />The TIB is officially undocumented for Windows 9x. The Windows NT series DDK includes a struct NT_TIB in winnt.h that documents the subsystem independent part. Wine includes declarations for the extended (subsystem-specific part of) TIB.[citation needed] Yet so many Win32 programs use these undocumented fields that they are effectively a part of the API. The first field, in particular, is directly referenced by the code produced by Microsoft's own compiler.[1]<br /><br />The TIB can be used to get a lot of information on the process without calling Win32 API. Examples include emulating GetLastError(), GetVersion(). Through the pointer to the PEB one can obtain access to the import tables (IAT), process startup arguments, image name, etc. It is accessed from the FS segment register when operating on 32 bits, and from GS in 64 bits.<br /><br /><strong>Of importance</strong>:<br />FS:[0x00] Pointer to SEH chain<br />FS:[0x18] Address of TIB / TEB<br />FS:[0x20] Address of PIB (Process Identifier)<br />FS:[0x30] Address of PEB<br /><br /><table class="table"><col/><col/><col/><col/><col/><tr><th>Bytes/Type
</th><th>offset(32 bits, FS)
</th><th>offset(64 bits, GS)
</th><th>Windows Versions</th><th>Description</th></tr><tr><td>pointer</td><td>0x00</td><td>0x00</td><td>Win9x and NT</td><td>Current Structured Exception Handling (SEH) frame</td></tr><tr><td>pointer</td><td>0x04</td><td>0x08</td><td>Win9x and NT</td><td>Stack Base / Bottom of stack (high address)</td></tr><tr><td>pointer</td><td>0x08</td><td>0x10</td><td>Win9x and NT</td><td>Stack Limit / Ceiling of stack (low address)</td></tr><tr><td>pointer</td><td>0x0C</td><td>0x18</td><td>NT</td><td>SubSystemTib</td></tr><tr><td>pointer</td><td>0x10</td><td>0x20</td><td>NT</td><td>Fiber data</td></tr><tr><td>pointer</td><td>0x14</td><td>0x28</td><td>Win9x and NT</td><td>Arbitrary data slot</td></tr><tr><td>pointer</td><td>0x18</td><td>0x30</td><td>Win9x and NT</td><td>Linear address of TEB</td></tr><tr><td>---- End of NT subsystem independent part ----</td><td></td><td></td><td></td><td></td></tr><tr><td>pointer</td><td>0x1C</td><td>0x38</td><td>NT</td><td>Environment Pointer</td></tr><tr><td>pointer</td><td>0x20</td><td>0x40</td><td>NT</td><td>Process ID (in some windows distributions this field is used as 'DebugContext')</td></tr><tr><td>4</td><td>FS:[0x24]</td><td>GS:[0x48]</td><td>NT</td><td>Current thread ID</td></tr><tr><td>4</td><td>FS:[0x28]</td><td></td><td>NT</td><td>Active RPC Handle</td></tr><tr><td>4</td><td>FS:[0x2C]</td><td></td><td>Win9x and NT</td><td>Linear address of the thread-local storage array</td></tr><tr><td>4</td><td>FS:[0x30]</td><td>GS:[0x60]</td><td>NT</td><td>Linear address of Process Environment Block (PEB)</td></tr><tr><td>4</td><td>FS:[0x34]</td><td>GS:[0x68]</td><td>NT</td><td>Last error number</td></tr><tr><td>4</td><td>FS:[0x38]</td><td></td><td>NT</td><td>Count of owned critical sections</td></tr><tr><td>4</td><td>FS:[0x3C]</td><td></td><td>NT</td><td>Address of CSR Client Thread</td></tr><tr><td>4</td><td>FS:[0x40]</td><td></td><td>NT</td><td>Win32 Thread Information</td></tr><tr><td>124</td><td>FS:[0x44]</td><td></td><td>NT, Wine</td><td>Win32 client information (NT), user32 private data (Wine), 0x60 = LastError (Win95), 0x74 = LastError (WinME)</td></tr><tr><td>4</td><td>FS:[0xC0]</td><td></td><td>NT</td><td>Reserved for Wow64. Contains a pointer to FastSysCall in Wow64.</td></tr><tr><td>4</td><td>FS:[0xC4]</td><td></td><td>NT</td><td>Current Locale</td></tr><tr><td>4</td><td>FS:[0xC8]</td><td></td><td>NT</td><td>FP Software Status Register</td></tr><tr><td>216</td><td>FS:[0xCC]</td><td></td><td>NT, Wine</td><td>Reserved for OS (NT), kernel32 private data (Wine)
herein: FS:[0x124] 4 NT Pointer to KTHREAD (ETHREAD) structure</td></tr><tr><td>4</td><td>FS:[0x1A4]</td><td></td><td>NT</td><td>Exception code</td></tr><tr><td>18</td><td>FS:[0x1A8]</td><td></td><td>NT</td><td>Activation context stack</td></tr><tr><td>24</td><td>FS:[0x1BC]</td><td></td><td>NT, Wine</td><td>Spare bytes (NT), ntdll private data (Wine)</td></tr><tr><td>40</td><td>FS:[0x1D4]</td><td></td><td>NT, Wine</td><td>Reserved for OS (NT), ntdll private data (Wine)</td></tr><tr><td>1248</td><td>FS:[0x1FC]</td><td></td><td>NT, Wine</td><td>GDI TEB Batch (OS), vm86 private data (Wine)</td></tr><tr><td>4</td><td>FS:[0x6DC]</td><td></td><td>NT</td><td>GDI Region</td></tr><tr><td>4</td><td>FS:[0x6E0]</td><td></td><td>NT</td><td>GDI Pen</td></tr><tr><td>4</td><td>FS:[0x6E4]</td><td></td><td>NT</td><td>GDI Brush</td></tr><tr><td>4</td><td>FS:[0x6E8]</td><td></td><td>NT</td><td>Real Process ID</td></tr><tr><td>4</td><td>FS:[0x6EC]</td><td></td><td>NT</td><td>Real Thread ID</td></tr><tr><td>4</td><td>FS:[0x6F0]</td><td></td><td>NT</td><td>GDI cached process handle</td></tr><tr><td>4</td><td>FS:[0x6F4]</td><td></td><td>NT</td><td>GDI client process ID (PID)</td></tr><tr><td>4</td><td>FS:[0x6F8]</td><td></td><td>NT</td><td>GDI client thread ID (TID)</td></tr><tr><td>4</td><td>FS:[0x6FC]</td><td></td><td>NT</td><td>GDI thread locale information</td></tr><tr><td>20</td><td>FS:[0x700]</td><td></td><td>NT</td><td>Reserved for user application</td></tr><tr><td>1248</td><td>FS:[0x714]</td><td></td><td>NT</td><td>Reserved for GL</td></tr><tr><td>4</td><td>FS:[0xBF4]</td><td>GS:[0x1250]</td><td>NT</td><td>Last Status Value</td></tr><tr><td>532</td><td>FS:[0xBF8]</td><td>GS:[0x1258]</td><td>NT</td><td>Static UNICODE_STRING buffer</td></tr><tr><td>pointer</td><td>FS:[0xE0C]</td><td>GS:[0x1478]</td><td>NT</td><td>Address of memory allocated for stack</td></tr><tr><td>pointer[]</td><td>FS:[0xE10]</td><td>GS:[0x1480]</td><td>NT</td><td>TLS slots, 4/8 bytes per slot, 64 slots</td></tr><tr><td>8</td><td>FS:[0xF10]</td><td>GS:[0x1680]</td><td>NT</td><td>TLS links (LIST_ENTRY structure)</td></tr><tr><td>4</td><td>FS:[0xF18]</td><td></td><td>NT</td><td>VDM</td></tr><tr><td>4</td><td>FS:[0xF1C]</td><td></td><td>NT</td><td>Reserved for RPC</td></tr><tr><td>4</td><td>FS:[0xF28]</td><td></td><td>NT</td><td>Thread error mode (RtlSetThreadErrorMode)</td></tr></table><br /></div></body></html>