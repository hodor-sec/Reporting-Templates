<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Final: modifying ESI</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Final: modifying ESI</h1><br/><strong>Intro</strong><br />While stepping through several breakpoints and after receiving an initial shell connection, the program continued shortly to handle control to the called program<br />Having reminded from the course some values could interfere for backgrounding the initial application and only returing control when the shell exits, an analysis has been made after the "CALL EBP" instruction as indicated.<br /><br />Found a reference to some strings being pushed on the stack.<br /><br /><strong>Reference</strong><br /><a href="https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/block/block_shell.asm">https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/block/block_shell.asm</a><br /><br /><br /><br /><img src="images/102-1.png" alt="images/102-1.png" /><br /><br /><br />Putting a NOP instead of a "DEC ESI" in the instructions, to prevent ESI being -1, but just 0.<br /><br /><img src="images/102-2.png" alt="images/102-2.png" /><br /><br /><br />Saving and running the new file gives a shell without waiting for closing the connection<br /><br /><img src="images/102-3.png" alt="images/102-3.png" /><br /><br /><br /><img src="images/102-4.png" alt="images/102-4.png" /><br /><br /><br /><br /><br /></div></body></html>