<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>search_and_destroy.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">search_and_destroy.py</h1><br/><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">####################################################################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Search&nbsp;&amp;&nbsp;Destroy&nbsp;-&nbsp;v0.2</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;About:&nbsp;Simple&nbsp;IDA&nbsp;Python&nbsp;script&nbsp;to&nbsp;find&nbsp;vulnerable&nbsp;C&nbsp;functions</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;By&nbsp;Moloch</span><br /><span style="color:#0088ff;font-weight:400">####################################################################</span><br /><br /><span style="color:#333333;font-weight:400">import</span>&nbsp;idautils<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;idc<br /><br /><span style="color:#333333;font-weight:400">from</span>&nbsp;idaapi&nbsp;<span style="color:#333333;font-weight:400">import</span>&nbsp;*<br /><br /><br /><span style="color:#0088ff;font-weight:400">###&nbsp;Setup&nbsp;code,&nbsp;feel&nbsp;free&nbsp;to&nbsp;add&nbsp;more!</span><br />dangerous_functions&nbsp;=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"sprintf"</span>,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"strcpy"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"strcat"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"memcpy"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"gets"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"recv"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"read"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"fgets"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"printf"</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"scanf"</span>,<br />]<br /><br />current_address&nbsp;=&nbsp;ScreenEA()<br />func_lib&nbsp;=&nbsp;{}<br /><span style="color:#ff9d00;font-weight:700">for</span>&nbsp;function&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;Functions(SegStart(current_address),&nbsp;SegEnd(current_address)):<br />&nbsp;&nbsp;&nbsp;&nbsp;func_lib[GetFunctionName(function)]&nbsp;=&nbsp;function<br /><br /><span style="color:#0088ff;font-weight:400">###&nbsp;Main&nbsp;Class</span><br /><span style="color:#ff9d00;font-weight:700">class</span>&nbsp;SearchAndDestroy(Choose2):<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;__init__(<span style="color:#333333;font-weight:400">self</span>,&nbsp;title):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Choose2.__init__(<span style="color:#333333;font-weight:400">self</span>,&nbsp;title,&nbsp;[&nbsp;[<span style="color:#3ad900;font-weight:400">"Address"</span>,&nbsp;<span style="color:#ff0044;font-weight:400">10</span>&nbsp;|&nbsp;Choose2.CHCOL_HEX],&nbsp;[<span style="color:#3ad900;font-weight:400">"Name"</span>,&nbsp;<span style="color:#ff0044;font-weight:400">30</span>&nbsp;|&nbsp;Choose2.CHCOL_PLAIN]&nbsp;])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.title&nbsp;=&nbsp;title<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.n&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.icon&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">41</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.PopulateItems()<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;PopulateItems(<span style="color:#333333;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.items&nbsp;=&nbsp;[]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;func_name&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;dangerous_functions:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[*]&nbsp;Searching&nbsp;for&nbsp;"</span>,&nbsp;func_name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;=&nbsp;LocByName(func_name)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;address&nbsp;!=&nbsp;BADADDR:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;=&nbsp;func_lib[func_name]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code_refs&nbsp;=&nbsp;CodeRefsTo(address,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for</span>&nbsp;ref&nbsp;<span style="color:#ff9d00;font-weight:700">in</span>&nbsp;code_refs:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;+=&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xref&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"0x%08x"</span>&nbsp;%&nbsp;ref<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetColor(ref,&nbsp;CIC_ITEM,&nbsp;<span style="color:#ff0044;font-weight:400">0x0000ff</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.items.append([xref,&nbsp;GetFunctionName(function),&nbsp;ref])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[+]&nbsp;Found&nbsp;%d&nbsp;ref(s)&nbsp;to&nbsp;%s"</span>&nbsp;%&nbsp;(count,&nbsp;func_name)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnClose(<span style="color:#333333;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[*]&nbsp;Closed&nbsp;"</span>,&nbsp;<span style="color:#333333;font-weight:400">self</span>.title<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnSelectLine(<span style="color:#333333;font-weight:400">self</span>,&nbsp;index):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idc.Jump(<span style="color:#333333;font-weight:400">self</span>.items[index][<span style="color:#ff0044;font-weight:400">2</span>])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[*]&nbsp;Jumping&nbsp;to&nbsp;0x%08x"</span>&nbsp;%&nbsp;<span style="color:#333333;font-weight:400">self</span>.items[index][<span style="color:#ff0044;font-weight:400">2</span>]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnGetLine(<span style="color:#333333;font-weight:400">self</span>,&nbsp;index):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#333333;font-weight:400">self</span>.items[index]<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnGetSize(<span style="color:#333333;font-weight:400">self</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff9d00;font-weight:700">len</span>(<span style="color:#333333;font-weight:400">self</span>.items)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnDeleteLine(<span style="color:#333333;font-weight:400">self</span>,&nbsp;index):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ea&nbsp;=&nbsp;<span style="color:#333333;font-weight:400">self</span>.items[index][<span style="color:#ff0044;font-weight:400">2</span>]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idc.Delfunc_name(ea)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;index<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">def</span>&nbsp;OnRefresh(<span style="color:#333333;font-weight:400">self</span>,&nbsp;index):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">self</span>.PopulateItems()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;index<br /><br /><span style="color:#0088ff;font-weight:400">###&nbsp;Start&nbsp;GUI</span><br />gui&nbsp;=&nbsp;SearchAndDestroy(<span style="color:#3ad900;font-weight:400">"Search&nbsp;and&nbsp;Destroy&nbsp;-&nbsp;v0.2"</span>)<br />gui.Show()</div></div></div></body></html>