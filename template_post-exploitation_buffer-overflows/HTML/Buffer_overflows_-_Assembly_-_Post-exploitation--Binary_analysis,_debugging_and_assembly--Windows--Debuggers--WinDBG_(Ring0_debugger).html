<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>WinDBG (Ring0 debugger)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">WinDBG (Ring0 debugger)</h1><br/><h2>Loading stuff</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>.loadby sos mscorwks</td><td>Load SOS extension (will identify sos location by loaded mscorwks path)</td></tr><tr><td>.load c:\Windows\Microsoft.NET\Framework\v2.0.50727\sos</td><td>Load SOS extension for  .NET 2.0</td></tr><tr><td>.load psscor2</td><td>Load PSSCOR for .NET 2.0 (replaces SOS)</td></tr><tr><td>.load sosex</td><td>Load SOSEX extension</td></tr><tr><td>.load sieextpub</td><td>Load SieExtPub extension</td></tr><tr><td>.load rpcexts</td><td>Load RPC extension</td></tr><tr><td>.unload</td><td>Unload extension</td></tr><tr><td>.cordll -ve -u -l</td><td>Retry loading of SOS</td></tr><tr><td>!help &lt;command&gt;</td><td>Latest extension commands help (SOS,SOSEX,PSSCOR)</td></tr><tr><td>!sosex.help</td><td>Like !help but for specifically for SOSEX</td></tr><tr><td>!sosexhelp</td><td>Display this screen or details about the specified command (SOSEX)</td></tr><tr><td>!sym noisy
[.symfix c:\symbols]
.reload
</td><td>Load symbols if not set in environment</td></tr><tr><td>.load wow64exts
!sw
.effmach
</td><td>Switched to 32bit mode after doing this</td></tr></table><br /><br /><h2>Examining code and stacks</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>~&lt;thread id&gt;s</td><td>Set active thread</td></tr><tr><td>~</td><td>all threads</td></tr><tr><td>!clrstack [-a] [-p] [-l]</td><td>managed call stack (no CLR stuff)</td></tr><tr><td>!dumpstack [-ee]</td><td>unmanaged and managed call stack</td></tr><tr><td>!eestack -short [-ee]</td><td>Run dumpstack on all threads and show only ‘interesting’ (lock, hijacked, managed)</td></tr><tr><td>!mk [FrameCount] [-l] [-p] [-a]</td><td>unmanaged and managed call stack, better than !dumpheap (sosex)</td></tr><tr><td>Kb [number]</td><td>Unmanaged stack with arguments (kb4 limits stack to 4 frames)</td></tr><tr><td>!uniqstack</td><td>Unmanaged stacks without duplication, nice if have many worker threads</td></tr><tr><td>!threads [-live] [-special]</td><td>all managed threads</td></tr><tr><td>!dso [-verify] [top stack [bottom stack]]</td><td>Objects stack trace (the actual object type and not where the method is)</td></tr><tr><td>!mdso [/a | /r | /c:n | /t:&lt;typeFilter&gt; | /mt:&lt;mt&gt;]</td><td>Dumps object references on the stack and in CPU registers in the current context</td></tr><tr><td>!name2ee mscorlib.dll System.Threading.Thread
 
.foreach (t {!dumpheap -mt &lt;mtaddress&gt; -short})  {.if(poi(${t}+28)&gt;0){.printf ” Thread Obj: %N, Obj Address: ${t},  Name: %N \n”,poi(${t}+28), poi(${t}+c)}}
</td><td>2 commands
get the .net threads object address for each thread matching by thread obj id</td></tr></table><br /> <br /><br /><h2>Exceptions</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>!analyze -v [-hang]</td><td>-v Very detailed exception data (SLOW),  -hang Generates !analyze hung-application output.</td></tr><tr><td>!pe [&lt;exceptionAddr&gt;]</td><td>most recent exception data (don’t forget the external stack)</td></tr><tr><td>!dae</td><td>Dump all exception found (psscor)</td></tr><tr><td> </td><td> </td></tr></table><br /><br /><h2>CLR data structures</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>!eeheap -gc</td><td>Get managed heap size</td></tr><tr><td>!dumpheap [-stat] [-mt &lt;&gt;] [-type &lt;&gt;] [-strings] [-min] [-max]</td><td>What classes take space in managed heap</td></tr><tr><td>!dumpheap &lt;address&gt; &lt;address&gt;</td><td>Show the object that are in the given memory segments (show only specific generation by combining with output of !eeheap -gc)</td></tr><tr><td>!dumpgen &lt;genNum&gt; [-free] [-stat] [-type &lt;&gt;] [-nostrings]</td><td>Dumps the contents of the specified generation (sosex)</td></tr><tr><td>!gcgen &lt;objectAddr&gt;</td><td>Displays the GC generation of the specified object (sosex)</td></tr><tr><td>!gcroot &lt;objectAddr&gt; [-nostacks]</td><td>Find how an object reference is reachable</td></tr><tr><td>!refs &lt;objectAddr&gt; [-target|-source]</td><td>Displays all references from and to the specified object (sosex)</td></tr><tr><td>!finalizequeue</td><td>all the object that are in finalize queue</td></tr><tr><td>!finq [genNum] [-stat]</td><td>Displays objects in the finalization queue (sosex)</td></tr><tr><td>!frq [-stat]</td><td>Display objects in the Freachable queue (sosex)</td></tr><tr><td>!dumpdomain</td><td>Display app-domains info</td></tr><tr><td>!FindAppDomain &lt;address&gt;</td><td>Determines the application domain of an object at the specified address.</td></tr><tr><td>!mx &lt;Filter String&gt;</td><td>Displays managed type/field/method names matching the specified filter string (sosex)</td></tr><tr><td>!gchandles</td><td>List GC handles statistics</td></tr><tr><td>!gch [-handleType]</td><td>Lists all GC Handles, optionally filtered by specified handle types</td></tr></table><br /><br /><h2>Unmanaged Memory</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>gflags /i &lt;pocess name&gt; +ust</td><td>Add allocation stack for this process</td></tr><tr><td>!address -summary</td><td>Show summery of memory by types</td></tr><tr><td>!heap -s</td><td>Show all heaps</td></tr><tr><td>!heap -stat -h &lt;heap addr&gt;</td><td>Show blocks of specific heap</td></tr><tr><td>!heap -flt s &lt;block size&gt;</td><td>Show addresses of memory blocks of specific size by heap</td></tr><tr><td>!heap -p -a &lt;usrPtr&gt;</td><td>Display allocation call stack for given block user ptr address</td></tr><tr><td> </td><td> </td></tr><tr><td> </td><td> </td></tr></table><br /><br /><h2>Object Inspection</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>!do &lt;address&gt;</td><td>information about object</td></tr><tr><td>!dumpvc &lt;mt&gt; &lt;address&gt;</td><td>Information about struct</td></tr><tr><td>!mdt [typename | MT] [addr] [-r[:level]] [-e[:level]]</td><td>Displays the fields of an object or type, -r optionally recursively, -e optionally collections (sosex)</td></tr><tr><td>!mroot &lt;addr&gt;</td><td>Displays GC roots for the specified object (sosex)</td></tr><tr><td>!objsize &lt;addr&gt;</td><td>The size of the object including all fields</td></tr><tr><td>!dumpmt -md &lt;addr&gt;</td><td>see what methods the object exposes (preJiv – ngen, Jit – jitted, None  – never been called)</td></tr><tr><td>!name2ee * &lt;type name&gt;</td><td>Get the class data for specific type</td></tr><tr><td>!da &lt;addr&gt; [-start #] [-length #] [-details]</td><td>Displays the contents of an array at the address 00ad28d0. starts from the second element and continues for five elements.</td></tr><tr><td>!refs &lt;addr&gt; [-target|-source]</td><td>Displays all references from and to the specified object (sosex)</td></tr><tr><td>!DumpRCW</td><td>.NET 4.5</td></tr></table><br /><br /><h2>Locks</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>!syncblk [-all | &lt;syncblkNumber&gt;]</td><td>Show all sync blocks that are owned by the current thread but not thinlocks, use !DumpHeap -thinlock</td></tr><tr><td>!DumpHeap -thinlock</td><td>Show all the thin locks</td></tr><tr><td>!dlk [-d]</td><td>Displays deadlocks between SyncBlocks and/or ReaderWriterLocks, only managed (sosex)</td></tr><tr><td>!critlist</td><td>Get critical sections that threads are locked on (sieextpub)</td></tr><tr><td>!locks</td><td> </td></tr><tr><td>!mlocks [-d]</td><td>Lists all managed lock objects and CriticalSections and their owning threads (sosex)</td></tr><tr><td>!mwaits [-d]</td><td>Lists all waiting threads and, if known, the locks they are waiting on (sosex)</td></tr><tr><td>!rwlock [objectAddr | -nd]</td><td>Displays all RWLocks or, if provided a RWLock address, details of the specified lock (sosex)</td></tr><tr><td>dt &lt;lockAddr&gt;</td><td> </td></tr><tr><td>!handle &lt;handleAddr&gt; f</td><td>Show data on the handle, if mutex or event can show the owner (procId.ThreadId)</td></tr></table><br /><br /><h2>Misc</h2><br /><table class="table"><col/><col/><tr><th>click me</th><th>click me</th></tr><tr><td>.cls</td><td>Clear screen</td></tr><tr><td>~*e &lt;command&gt;</td><td>Execute command for all threads</td></tr><tr><td>!u, u &lt;method intptr&gt;</td><td>Show the disassemble of a method</td></tr><tr><td>!mu [addr] [-s] [-il] [-n]</td><td>Displays a disassembly around the current instruction with interleaved source, IL and asm code (sosex)</td></tr><tr><td>!muf [MD| Code Addr] [-s] [-il] [-n]</td><td>Displays a disassembly with interleaved source, IL and asm code (sosex)</td></tr><tr><td>!dumpil &lt;method intptr&gt;</td><td>Show the IL code of the method</td></tr><tr><td>!address &lt;address&gt;</td><td>displays information about the memory that the target process or target computer uses.</td></tr><tr><td>!runaway</td><td>CPU time of each thread</td></tr><tr><td>sxe ld:&lt;dll name&gt;</td><td>why a specific module was loaded</td></tr><tr><td>vertarget</td><td>The time of the dump</td></tr><tr><td>.foreach</td><td>Crazy loops</td></tr><tr><td>poi(&lt;address&gt;)</td><td>Follow reference for the given pointer (handle) address</td></tr><tr><td>!SaveModule &lt;addr&gt; &lt;path&gt;</td><td>Save the module dll to a file (can be used to get its version)</td></tr><tr><td>!TraverseHeap [-xml] &lt;filename&gt;</td><td>Dump heap data that can be used by CLR profiler</td></tr><tr><td>!teb</td><td> displays all elements of the TEB or “Thread Environment Block”</td></tr><tr><td>!vmstat</td><td> </td></tr><tr><td>!strings [ModuleAddress] [min] [max] [gen#] [filter]</td><td>Search the managed heap or a module for strings matching the specified criteria</td></tr><tr><td>!mln &lt;addr&gt;</td><td>Displays the type of managed data located at the specified address or the current instruction pointer</td></tr><tr><td>lm [v] [m] &lt;moduleName&gt;</td><td>Show data on the loaded modules (mscorwks, clr)</td></tr><tr><td>lmf</td><td>list loaded modules with full path</td></tr><tr><td>!filevers</td><td>Show version and paths of all loaded modules (sieextpub)</td></tr><tr><td>!comcalls</td><td>Show COM calls on all threads</td></tr><tr><td>!rpcreadstack &lt;stack addr&gt;</td><td>Get RPC call information (rpcexts)</td></tr><tr><td>!getendpointinfo &lt;port&gt;</td><td>searches the system’s RPC state information for endpoint information (rpcexts)</td></tr></table><br /></div></body></html>