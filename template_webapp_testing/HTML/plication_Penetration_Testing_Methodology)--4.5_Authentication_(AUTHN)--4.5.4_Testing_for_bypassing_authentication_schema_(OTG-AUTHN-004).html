<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.5.4 Testing for bypassing authentication schema (OTG-AUTHN-004)  </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.5.4 Testing for bypassing authentication schema (OTG-AUTHN-004)  </h1><br/><h2>Summary</h2><br /><br />While most applications require authentication to gain access to  private information or to execute tasks, not every authentication method  is able to provide adequate security. Negligence, ignorance, or simple  understatement of security threats often result in authentication  schemes that can be bypassed by simply skipping the log in page and  directly calling an internal page that is supposed to be accessed only  after authentication has been performed. <br /><br /> In addition, it is often possible to bypass authentication measures by  tampering with requests and tricking the application into thinking that  the user is already authenticated.  This can be accomplished either by  modifying the given URL parameter, by manipulating the form, or by  counterfeiting sessions. <br /><br /> Problems related to the authentication schema can be found at different  stages of the software development life cycle (SDLC), like the design,  development, and deployment phases: <br />•  In the design phase errors can include a wrong definition of application sections to be protected, the choice of not applying strong encryption protocols for securing the transmission of credentials, and many more.<br />•  In the development phase errors can include the incorrect implementation of input validation functionality or not following the security best practices for the specific language.<br />•  In the application deployment phase, there may be issues during the application setup (installation and configuration activities) due to a lack in required technical skills or due to the lack of good documentation.<br /><br /> <br /><br /><h2>How to Test</h2><br /><br /><h3>Black Box testing</h3><br />There are several methods of bypassing the authentication schema that is used by a web application: <br />•  Direct page request (<a href="https://www.owasp.org/index.php/Forced_browsing">forced browsing</a>)<br />•  Parameter modification<br />•  Session ID prediction<br />•  SQL injection<br /><br /> <br /><br /><h3>Direct page request</h3><br />If a web application implements access control only on the log in  page, the authentication schema could be bypassed.  For example, if a  user directly requests a different page via forced browsing, that page  may not check the credentials of the user before granting access.  Attempt to directly access a protected page through the address bar in  your browser to test using this method. <br /><br /> <br /><img src="images/205-1.png" alt="images/205-1.png" /><br /> <br /><br /><h3>Parameter Modification</h3><br />Another problem related to authentication design is when the  application verifies a successful log in on the basis of a fixed value  parameters. A user could modify these parameters to gain access to the  protected areas without providing valid credentials. In the example  below, the "authenticated" parameter is changed to a value of "yes",  which allows the user to gain access.  In this example, the parameter is  in the URL, but a proxy could also be used to modify the parameter,  especially when the parameters are sent as form elements in a POST  request or when the parameters are stored in a cookie. <br /><br />http://www.site.com/page.asp?authenticated=no <br /><br />raven@blackbox /home $nc www.site.com 80                    <br />GET /page.asp?authenticated=yes HTTP/1.0                    <br />                                                            <br />HTTP/1.1 200 OK                                             <br />Date: Sat, 11 Nov 2006 10:22:44 GMT                         <br />Server: Apache                                              <br />Connection: close                                           <br />Content-Type: text/html; charset=iso-8859-1                 <br /> <br />&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;          <br />&lt;HTML&gt;&lt;HEAD&gt;                                                <br />&lt;/HEAD&gt;&lt;BODY&gt;                                               <br />&lt;H1&gt;You Are Authenticated&lt;/H1&gt;                              <br />&lt;/BODY&gt;&lt;/HTML&gt;<br /><img src="images/205-2.png" alt="images/205-2.png" /><br /> <br /><br /><h3>Session ID Prediction</h3><br />Many web applications manage authentication by using session  identifiers (session IDs). Therefore, if session ID generation is  predictable, a malicious user could be able to find a valid session ID  and gain unauthorized access to the application, impersonating a  previously authenticated user. <br /><br /> In the following figure, values inside cookies increase linearly, so it  could be easy for an attacker to guess a valid session ID. <br /><br /> <br /><img src="images/205-3.png" alt="images/205-3.png" /><br /> In the following figure, values inside cookies change only partially, so  it's possible to restrict a brute force attack to the defined fields  shown below. <br /><br /> <br /><img src="images/205-4.png" alt="images/205-4.png" /><br /> <br /><br /><h3>SQL Injection (HTML Form Authentication)</h3><br />SQL Injection is a widely known attack technique. This section is not  going to describe this technique in detail as there are several  sections in this guide that explain injection techniques beyond the  scope of this section. <br /><br /> <br /><img src="images/205-5.png" alt="images/205-5.png" /><br /> The following figure shows that with a simple SQL injection attack, it is sometimes possible to bypass the authentication form. <br /><br /> <br /><img src="images/205-6.png" alt="images/205-6.png" /><br /> <br /><br /><h3>Gray Box Testing</h3><br />If an attacker has been able to retrieve the application source code  by exploiting a previously discovered vulnerability (e.g., directory  traversal), or from a web repository (Open Source Applications), it  could be possible to perform refined attacks against the implementation  of the authentication process.  <br /><br /> In the following example (PHPBB 2.0.13 - Authentication Bypass  Vulnerability), at line 5 the unserialize() function parses a user  supplied cookie and sets values inside the $row array. At line 10 the  user's MD5 password hash stored inside the back end database is compared  to the one supplied.  <br />1.  if ( isset($HTTP_COOKIE_VARS[$cookiename . '_sid']) ||<br />2.  {<br />3.  $sessiondata = isset( $HTTP_COOKIE_VARS[$cookiename . '_data'] ) ?<br />4. <br />5.  unserialize(stripslashes($HTTP_COOKIE_VARS[$cookiename . '_data'])) : array();<br />6. <br />7.  $sessionmethod = SESSION_METHOD_COOKIE;<br />8.  }<br />9. <br />10. if( md5($password) == $row['user_password'] &amp;&amp; $row['user_active'] )<br />11. <br />12. {<br />13. $autologin = ( isset($HTTP_POST_VARS['autologin']) ) ? TRUE : 0;<br />14. }<br /><br /> In PHP, a comparison between a string value and a boolean value (1 -  "TRUE") is always "TRUE", so by supplying the following string (the  important part is "b:1") to the unserialize() function, it is possible  to bypass the authentication control:  <br />a:2:{s:11:"autologinid";b:1;s:6:"userid";s:1:"2";}<br /><br /> <br /><br /><h2>Tools</h2><br />•  <a href="https://www.owasp.org/index.php/OWASP_WebScarab_Project">WebScarab</a><br />•  <a href="https://www.owasp.org/index.php/OWASP_WebGoat_Project">WebGoat</a><br />•  <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">OWASP Zed Attack Proxy (ZAP)</a><br /><br /> <br /><br /><h2>References</h2><br /><strong>Whitepapers</strong><br /> <br />•  Mark Roxberry: "PHPBB 2.0.13 vulnerability" <br />•  David Endler: "Session ID Brute Force Exploitation and Prediction" - <a href="http://www.cgisecurity.com/lib/SessionIDs.pdf">http://www.cgisecurity.com/lib/SessionIDs.pdf</a><br /></div></body></html>