<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.12.4 Testing for Client Side URL Redirect (OTG-CLIENT-004)  </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.12.4 Testing for Client Side URL Redirect (OTG-CLIENT-004)  </h1><br/><br /><h2>Summary</h2><br />This section describes how to check for Client Side URL Redirection,  also known as Open Redirection. It is an input validation flaw that  exists when an application accepts an user controlled input which  specifies a link that leads to an external URL that could be malicious.  This kind of vulnerability could be used to accomplish a phishing attack  or redirect a victim to an infection page. <br /><br /> <br /><br /><h2>How to Test</h2><br />This vulnerability occurs when an application accepts untrusted input  that contains an URL value without sanitizing it. This URL value could  cause the web application to redirect the user to another page as, for  example, a malicious page controlled by the attacker.  <br /><br /> By modifying untrusted URL input to a malicious site, an attacker may  successfully launch a phishing scam and steal user credentials. Since  the redirection is originated by the real application, the phishing  attempts may have a more trustworthy appearance. <br /><br /> A phishing attack example could be the following:  <br /> <br />http://www.target.site?#redirect=www.fake-target.site <br /><br /> The victim that visits target.site will be automatically redirected to  fake-target.site where an attacker could place a fake page to steal  victim's credentials.  <br /><br /> Moreover open redirections could also be used to maliciously craft an  URL that would bypass the application’s access control checks and then  forward the attacker to privileged functions that they would normally  not be able to access.  <br /><br /> <br /><br /><h3>Black Box testing</h3><br />Black box testing for Client Side URL Redirect is not usually  performed since access to the source code is always available as it  needs to be sent to the client to be executed.  <br /> <br /><br /><h3>Gray Box testing</h3><br /><strong>Testing for Client Side URL Redirect vulnerabilities:</strong><br /> When testers have to manually check for this type of vulnerability they  have to identify if there are client side redirections implemented in  the client side code (for example in the JavaScript code).  <br /> <br />These redirections could be implemented, for example in  JavaScript, using the “window.location” object that can be used to take  the browser to another page by simply assigning a string to it. (as you  can see in the following snippet of code). <br />var redir = location.hash.substring(1); <br />if (redir) <br />   window.location='http://'+decodeURIComponent(redir); <br /><br /> In the previous example the script does not perform any validation of  the variable “redir”, that contains the user supplied input via the  query string, and in the same time does not apply any form of encoding,  then this unvalidated input is passed to the windows.location object  originating a URL redirection vulnerability. <br /><br /> This implies that an attacker could redirect the victim to a malicious site simply by submitting the following query string:  <br />http://www.victim.site/?#www.malicious.site<br /> Note how, if the vulnerable code is the following: <br />var redir = location.hash.substring(1); <br />if (redir) <br />   window.location=decodeURIComponent(redir); <br /><br /> It also could be possible to inject JavaScript code, for example by submitting the following query string: <br />http://www.victim.site/?#javascript:alert(document.cookie)When trying to check for this kind of issues, consider that some characters are treated differently by different browsers. <br /> <br />Moreover always consider the possibility to try absolute URLs variants as described here: <a href="http://kotowicz.net/absolute/">http://kotowicz.net/absolute/</a> <br /> <br /><br /> <br /><br /><h2>Tools</h2><br />•  DOMinator - <a href="https://dominator.mindedsecurity.com/">https://dominator.mindedsecurity.com/</a><br /><br /><h2>References</h2><br /><strong>OWASP Resources</strong> <br />•  <a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet">DOM based XSS Prevention Cheat Sheet</a><br />•  DOMXSS.com - <a href="http://www.domxss.com">http://www.domxss.com</a><br /><br /> <strong>Whitepapers</strong><br /> <br />•  Browser location/document URI/URL Sources - <a href="https://code.google.com/p/domxsswiki/wiki/LocationSources">https://code.google.com/p/domxsswiki/wiki/LocationSources</a>•  i.e., what is returned when you ask the browser for things like document.URL, document.baseURI, location, location.href, etc.<br /><br />•  Krzysztof Kotowicz: "Local or External? Weird URL formats on the loose" - <a href="http://kotowicz.net/absolute/">http://kotowicz.net/absolute/</a><br /></div></body></html>