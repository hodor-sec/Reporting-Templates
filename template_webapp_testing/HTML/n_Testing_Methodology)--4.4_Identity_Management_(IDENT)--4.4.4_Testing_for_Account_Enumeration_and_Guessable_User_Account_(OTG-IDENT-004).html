<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.4.4 Testing for Account Enumeration and Guessable User Account (OTG-IDENT-004) </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.4.4 Testing for Account Enumeration and Guessable User Account (OTG-IDENT-004) </h1><br/><br /><h2>Summary</h2><br />The scope of this test is to verify if it is possible to collect a  set of valid usernames by interacting with the authentication mechanism  of the application. This test will be useful for brute force testing, in  which the tester verifies if, given a valid username, it is possible to  find the corresponding password.  <br /><br /> Often, web applications reveal when a username exists on system, either  as a consequence of mis-configuration or as a design decision. For  example, sometimes, when we submit wrong credentials, we receive a  message that states that either the username is present on the system or  the provided password is wrong. The information obtained can be used by  an attacker to gain a list of users on system. This information can be  used to attack the web application, for example, through a brute force  or default username and password attack. <br /><br /> The tester should interact with the authentication mechanism of the  application to understand if sending particular requests causes the  application to answer in different manners. This issue exists because  the information released from web application or web server when the  user provide a valid username is different than when they use an invalid  one. <br /><br /> In some cases, a message is received that reveals if the provided  credentials are wrong because an invalid username or an invalid password  was used. Sometimes, testers can enumerate the existing users by  sending a username and an empty password. <br /><br /> <br /><br /><h2>How to Test</h2><br />In black box testing, the tester knows nothing about the specific  application, username, application logic, error messages on log in page,  or password recovery facilities. If the application is vulnerable, the  tester receives a response message that reveals, directly or indirectly,  some information useful for enumerating users.  <br /><br /> <br /><br /><h3>HTTP Response message</h3><br /><strong>Testing for Valid user/right password</strong>  <br />Record the server answer when you submit a valid user ID and valid password. <br /><br /> <strong>Result Expected:</strong> <br />Using WebScarab, notice the information retrieved from this  successful authentication (HTTP 200 Response, length of the response). <br /><br /> <strong>Testing for valid user with wrong password</strong> <br /> Now, the tester should try to insert a valid user ID and a wrong  password and record the error message generated by the application. <br /><br /> <strong>Result Expected:</strong><br /> The browser should display a message similar to the following one:<br /> <img src="images/200-1.png" alt="images/200-1.png" /><br /> <br /><br /> or something like:<br /> <img src="images/200-2.png" alt="images/200-2.png" /><br /> <br /><br /> against any message that reveals the existence of user, for instance, message similar to:<br />   <br />Login for User foo: invalid password<br />Using WebScarab, notice the information retrieved from this  unsuccessful authentication attempt (HTTP 200 Response, length of the  response). <br /><br /> <strong>Testing for a nonexistent username</strong>  <br />Now, the tester should try to insert an invalid user ID and a  wrong password and record the server answer (the tester should be  confident that the username is not valid in the application). Record the  error message and the server answer. <br /><br /> <strong>Result Expected:</strong> <br />If the tester enters a nonexistent user ID, they can receive a message similar to:<br /> <img src="images/200-3.png" alt="images/200-3.png" /><br /> <br />or message like the following one:<br /> <br />Login failed for User foo: invalid Account<br /><br /> Generally the application should respond with the same error message and  length to the different incorrect requests. If the responses are not  the same, the tester should investigate and find out the key that  creates a difference between the two responses. For example:  <br />•  Client request: Valid user/wrong password --&gt; Server answer:'The password is not correct'<br />•  Client request: Wrong user/wrong password --&gt; Server answer:'User not recognized'<br />The above responses let the client understand that for the first  request they have a valid user name. So they can interact with the  application requesting a set of possible user IDs and observing the  answer. <br />Looking at the second server response, the tester understand in  the same way that they don't hold a valid username. So they can interact  in the same manner and create a list of valid user ID looking at the  server answers. <br /><br /> <br /><br /><h3>Other ways to enumerate users</h3><br />Testers can enumerate users in several ways, such as: <br /> <br /><br /> <strong>- Analyzing the error code received on login pages</strong><br /> Some web application release a specific error code or message that we can analyze. <br /><br /> <strong>- Analyzing URLs and URLs re-directions</strong><br /> For example:<br /> <br /><a href="http://www.foo.com/err.jsp?User=baduser&Error=0">http://www.foo.com/err.jsp?User=baduser&amp;Error=0</a><br /><br /><a href="http://www.foo.com/err.jsp?User=gooduser&Error=2">http://www.foo.com/err.jsp?User=gooduser&amp;Error=2</a><br /><br /> As is seen above, when a tester provides a user ID and password to the  web application, they see a message indication that an error has  occurred in the URL. In the first case they have provided a bad user ID  and bad password. In the second, a good user ID and a bad password, so  they can identify a valid user ID. <br /><br /> <strong>- URI Probing</strong><br /> Sometimes a web server responds differently if it receives a request for  an existing directory or not. For instance in some portals every user  is associated with a directory. If testers try to access an existing  directory they could receive a web server error. <br /><br /> A very common error that is received from web server is:<br /> <br />  403 Forbidden error code <br />and <br /> <br />  404 Not found error code<br /><br /> Example<br /> <br /><a href="http://www.foo.com/account1">http://www.foo.com/account1</a> - we receive from web server: 403 Forbidden <br /><a href="http://www.foo.com/account2">http://www.foo.com/account2</a> - we receive from web server: 404 file Not Found<br /><br /> In the first case the user exists, but the tester cannot view the web  page, in second case instead the user “account2” does not exist. By  collecting this information testers can enumerate the users. <br /><br /> <strong>- Analyzing Web page Titles</strong><br /> Testers can receive useful information on Title of web page, where they  can obtain a specific error code or messages that reveal if the problems  are with the username or password. <br /><br /> For instance, if a user cannot authenticate to an application and receives a web page whose title is similar to: <br />Invalid user<br />Invalid authentication<br /><br /> <strong>- Analyzing a message received from a recovery facility</strong><br />  When we use a recovery facility (i.e. a forgotten password function) a  vulnerable application might return a message that reveals if a username  exists or not. <br />For example, message similar to the following:<br /> <br />Invalid username: e-mail address is not valid or the specified user was not found.<br />Valid username: Your password has been successfully sent to the email address you registered with.<br /><br /> <br /><br /> <strong>- Friendly 404 Error Message</strong><br /> When we request a user within the directory that does not exist, we  don't always receive 404 error code. Instead, we may receive “200 ok”  with an image, in this case we can assume that when we receive the  specific image the user does not exist. This logic can be applied to  other web server response; the trick is a good analysis of web server  and web application messages. <br /> <br /> <br /><br /><h3>Guessing Users</h3><br />In some cases the user IDs are created with specific policies of  administrator or company. For example we can view a user with a user ID  created in sequential order:<br />   CN000100<br />   CN000101<br />   …. <br /> <br />Sometimes the usernames are created with a REALM alias and then a sequential numbers:<br />   R1001 – user 001 for REALM1<br />    R2001 – user 001 for REALM2<br /> <br /> <br />In the above sample we can create simple shell scripts that  compose user IDs and submit a request with tool like wget to automate a  web query to discern valid user IDs. To create a script we can also use  Perl and CURL. <br /><br /> Other possibilities are: - user IDs associated with credit card numbers, or in general numbers  with a pattern. - user IDs associated with real names, e.g. if Freddie Mercury has a  user ID of "fmercury", then you might guess Roger Taylor to have the  user ID of "rtaylor".  <br /><br /> Again, we can guess a username from the information received from an  LDAP query or from Google information gathering, for example, from a  specific domain. Google can help to find domain users through specific  queries or through a simple shell script or tool. <br /><br /> <strong>Attention:</strong> by enumerating user accounts, you risk locking out  accounts after a predefined number of failed probes (based on  application policy). Also, sometimes, your IP address can be banned by  dynamic rules on the application firewall or Intrusion Prevention  System. <br /><br /> <br /><br /><h3>Gray Box testing</h3><br /><strong>Testing for Authentication error messages</strong><br /> <br />Verify that the application answers in the same manner for every  client request that produces a failed authentication. For this issue the  Black Box testing and  Gray Box testing have the same concept based on  the analysis of messages or error codes received from web application.<br /> <br /><br /> <strong>Result Expected:</strong><br /> The application should answer in the same manner for every failed attempt of authentication.<br /> <br />For Example: <br /> <br />Credentials submitted are not valid<br /><br /> <br /><br /><h2>Tools</h2><br />•  WebScarab: <a href="https://www.owasp.org/index.php/OWASP_WebScarab_Project">OWASP_WebScarab_Project</a><br />•  CURL: <a href="http://curl.haxx.se/">http://curl.haxx.se/</a><br />•  PERL: <a href="http://www.perl.org">http://www.perl.org</a><br />•  Sun Java Access &amp; Identity Manager users enumeration tool: <a href="http://www.aboutsecurity.net">http://www.aboutsecurity.net</a><br /><br /> <br /><br /><h2>References</h2><br />•  Marco Mella, <em>Sun Java Access &amp; Identity Manager Users enumeration: </em><a href="http://www.aboutsecurity.net">http://www.aboutsecurity.net</a><em><br /></em><br />•  <em>Username Enumeration Vulnerabilities: </em><a href="http://www.gnucitizen.org/blog/username-enumeration-vulnerabilities">http://www.gnucitizen.org/blog/username-enumeration-vulnerabilities</a><em><br /></em> <br /><br /> <br /><br /><h2>Remediation</h2><br />Ensure the application returns consistent generic error messages in  response to invalid account name, password or other user credentials  entered during the log in process. <br />Ensure default system accounts and test accounts are deleted  prior to releasing the system into production (or exposing it to an  untrusted network). <br /></div></body></html>