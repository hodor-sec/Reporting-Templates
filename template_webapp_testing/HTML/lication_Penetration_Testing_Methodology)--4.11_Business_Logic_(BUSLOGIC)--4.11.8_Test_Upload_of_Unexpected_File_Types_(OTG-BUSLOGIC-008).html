<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.11.8 Test Upload of Unexpected File Types (OTG-BUSLOGIC-008)  </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.11.8 Test Upload of Unexpected File Types (OTG-BUSLOGIC-008)  </h1><br/><br /><h2>Summary</h2><br />Many application’s business processes allow for the upload and  manipulation of data that is submitted via files. But the business  process must check the files and only allow certain “approved” file  types. Deciding what files are "approved" is determined by the business  logic and is application/system specific. The risk in that by allowing  users to upload files, attackers may submit an unexpected file type that  that could be executed and adversely impact the application or system  through attacks that may deface the web site, perform remote commands,  browse the system files, browse the local resources, attack other  servers, or exploit the local vulnerabilities, just to name a few.   <br /><br /> Vulnerabilities related to the upload of unexpected file types is unique  in that the upload should quickly reject a file if it does not have a  specific extension. Additionally, this is different from uploading  malicious files in that in most cases an incorrect file format may not  by it self be inherently “malicious” but may be detrimental to the saved  data. For example if an application accepts Windows Excel files, if an  similar database file is uploaded it may be read but data extracted my  be moved to incorrect locations.  <br /><br /> The application may be expecting only certain file types to be uploaded  for processing, such as .CSV, .txt files. The application may not  validate the uploaded file by extension (for low assurance file  validation) or content (high assurance file validation). This may result  in unexpected system or database results within the application/system  or give attackers additional methods to exploit the application/system.. <br /><br /> <br /><br /><h2>Example</h2><br />Suppose a picture sharing application allows users to upload a .gif  or .jpg graphic file to the web site. What if an attacker is able to  upload an html file with a &lt;script&gt; tag in it or php file? The  system may move the file from a temporary location to the final location  where the php code can now be executed against the application or  system. <br /><br /> <br /><br /><h2>How to Test</h2><br />Generic Testing Method <br />• Review the project documentation and perform some exploratory  testing looking for file types that should be "unsupported" by the  application/system. <br />• Try to upload these “unsupported” files an verify that it are properly rejected.    <br />• If multiple files can be uploaded at once, there must be tests in place to verify that each file is properly evaluated.  <br /><br /> Specific Testing Method  <br />• Study the applications logical requirements. <br />• Prepare a library of files that are “not approved” for upload  that may contain files such as: jsp, exe, or html files containing  script. <br />• In the application navigate to the file submission or upload mechanism. <br />• Submit the “not approved” file for upload and verify that they are properly prevented from uploading <br />• Check if the website only do file type check in client side JavaScript  <br />• Check if the website only check the file type by "Content-Type" in HTTP request. <br />• Check if the website only check by the file extension. <br />• Check if other uploaded files can be accessed directly by specified URL.  <br />• Check if the uploaded file can include code or script injection. <br />• Check if there is any file path checking for uploaded files.  Especially, hackers may compress files with specified path in ZIP so  that the unzip files can be uploaded to intended path after uploading  and unzip. <br /><br /><h2>Related Test Cases</h2><br /><a href="https://www.owasp.org/index.php/Test_File_Extensions_Handling_for_Sensitive_Information_(OTG-CONFIG-003)"> Test File Extensions Handling for Sensitive Information (OTG-CONFIG-003)</a>  <br /><a href="https://www.owasp.org/index.php/Test_Upload_of_Malicious_Files_(OTG-BUSLOGIC-009)"> Test Upload of Malicious Files (OTG-BUSLOGIC-009)</a>  <br /><br /> <br /><br /><h2>References</h2><br />OWASP - Unrestricted File Upload - <a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">https://www.owasp.org/index.php/Unrestricted_File_Upload</a> <br />File upload security best practices: Block a malicious file upload - <a href="http://www.computerweekly.com/answer/File-upload-security-best-practices-Block-a-malicious-file-upload">http://www.computerweekly.com/answer/File-upload-security-best-practices-Block-a-malicious-file-upload</a> <br />Stop people uploading malicious PHP files via forms - <a href="http://stackoverflow.com/questions/602539/stop-people-uploading-malicious-php-files-via-forms">http://stackoverflow.com/questions/602539/stop-people-uploading-malicious-php-files-via-forms</a> <br />CWE-434: Unrestricted Upload of File with Dangerous Type - <a href="http://cwe.mitre.org/data/definitions/434.html">http://cwe.mitre.org/data/definitions/434.html</a> <br />Secure Programming Tips - Handling File Uploads - <a href="https://www.datasprings.com/resources/dnn-tutorials/artmid/535/articleid/65/secure-programming-tips-handling-file-uploads?AspxAutoDetectCookieSupport=1">https://www.datasprings.com/resources/dnn-tutorials/artmid/535/articleid/65/secure-programming-tips-handling-file-uploads?AspxAutoDetectCookieSupport=1</a> <br /><br /> <br /><br /><h2>Remediation</h2><br />Applications should be developed with mechanisms to only accept and  manipulate “acceptable“ files that the rest of the application  functionality is ready to handle and expecting.  Some specific examples  include: Black or White listing of file extensions, using “Content-Type”  from the header, or using a file type recognizer, all to only allow  specified file types into the system. <br /></div></body></html>