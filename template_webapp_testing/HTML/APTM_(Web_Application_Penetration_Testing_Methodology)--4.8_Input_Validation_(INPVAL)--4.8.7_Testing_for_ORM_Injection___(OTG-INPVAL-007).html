<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.8.7 Testing for ORM Injection   (OTG-INPVAL-007) </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.8.7 Testing for ORM Injection   (OTG-INPVAL-007) </h1><br/><br /><h2>Summary</h2><br />ORM Injection is an attack using SQL Injection against an ORM  generated data access object model.  From the point of view of a tester,  this attack is virtually identical to a SQL Injection attack.  However,  the injection vulnerability exists in code generated by the ORM tool.  <br /><br /> An ORM is an Object Relational Mapping tool.  It is used to expedite  object oriented development within the data access layer of software  applications, including web applications.  The benefits of using an ORM  tool include quick generation of an object layer to communicate to a  relational database, standardized code templates for these objects, and  usually a set of safe functions to protect against SQL Injection  attacks.  ORM generated objects can use SQL or in some cases, a variant  of SQL, to perform CRUD (Create, Read, Update, Delete) operations on a  database.   It is possible, however, for a web application using ORM  generated objects to be vulnerable to SQL Injection attacks if methods  can accept unsanitized input parameters. <br /><br /> ORM tools include Hibernate for Java, NHibernate for .NET, ActiveRecord  for Ruby on Rails, EZPDO for PHP and many others. For a reasonably  comprehensive list of ORM tools, see <a href="http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software">http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software</a> <br /><br /><h2>How to Test</h2><br /><br /><h3>Black Box testing</h3><br />Blackbox testing for ORM Injection vulnerabilities is identical to SQL Injection testing (see <a href="https://www.owasp.org/index.php/Testing_for_SQL_Injection_(OWASP-DV-005)">Testing for SQL Injection</a>).   In most cases, the vulnerability in the ORM layer is a result of  customized code that does not properly validate input parameters.  Most  ORM tools provide safe functions to escape user input.  However, if  these functions are not used, and the developer uses custom functions  that accept user input, it may be possible to execute a SQL injection  attack. <br /><br /> <br /><br /><h3>Gray Box testing</h3><br />If a tester has access to the source code for a web application, or  can discover vulnerabilities of an ORM tool and tests web applications  that use this tool, there is a higher probability of successfully  attacking the application.   <br /><br /> Patterns to look for in code include: <br />•  Input parameters concatenated with SQL strings. This code that uses ActiveRecord for Ruby on Rails is vulnerable (though any ORM can be vulnerable)<br />Orders.find_all "customer_id = 123 AND order_date = '#{@params['order_date']}'"<br />Simply sending "' OR 1--" in the form where order date can be entered can yield positive results. <br /><br /> <br /><br /><h2>Tools</h2><br />•  Hibernate <a href="http://www.hibernate.org">http://www.hibernate.org</a><br /><br />•  NHibernate <a href="http://nhforge.org/">http://nhforge.org/</a><br /><br /><br /><h2>References</h2><br /><strong>Whitepapers</strong><br /> <br />•  <a href="https://www.owasp.org/index.php/Testing_for_SQL_Injection_(OWASP-DV-005)#References">References from Testing for SQL Injection</a> are applicable to ORM Injection <br />•  Wikipedia - ORM <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">http://en.wikipedia.org/wiki/Object-relational_mapping</a><br /><br />•  <a href="https://www.owasp.org/index.php?title=Interpreter_Injection&action=edit&redlink=1">OWASP Interpreter Injection</a><br /></div></body></html>