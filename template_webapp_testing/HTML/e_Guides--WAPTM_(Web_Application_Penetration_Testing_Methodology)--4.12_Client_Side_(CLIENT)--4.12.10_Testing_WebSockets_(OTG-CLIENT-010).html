<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.12.10 Testing WebSockets (OTG-CLIENT-010)  </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.12.10 Testing WebSockets (OTG-CLIENT-010)  </h1><br/><br /><h2>Summary</h2><br />Traditionally the HTTP protocol only allows one request/response per  TCP connection. Asynchronous JavaScript and XML (AJAX) allows clients to  send and receive data asynchronously (in the background without a page  refresh) to the server, however, AJAX requires the client to initiate  the requests and wait for the server responses (half-duplex).  <br /><br /> HTML5 WebSockets allow the client/server to create a 'full-duplex'  (two-way) communication channels, allowing the client and server to  truly communicate asynchronously. WebSockets conduct their initial  'upgrade' handshake over HTTP and from then on all communication is  carried out over TCP channels by use of frames. <br /><br /> <br /><br /><h3>Origin</h3><br />It is the server’s responsibility to verify the Origin header in the  initial HTTP WebSocket handshake. If the server does not validate the  origin header in the initial WebSocket handshake, the WebSocket server  may accept connections from any origin. This could allow attackers to  communicate with the WebSocket server cross-domain allowing for <a href="https://www.owasp.org/index.php/Top_10_2013-A8-Cross-Site_Request_Forgery_(CSRF)">Top 10 2013-A8-Cross-Site Request Forgery (CSRF)</a> type issues. <br /><br /> <br /><br /><h3>Confidentiality and Integrity</h3><br />WebSockets can be used over unencrypted TCP or over encrypted TLS. To use unencrypted WebSockets the <em>ws://</em> URI scheme is used (default port 80), to use encrypted (TLS) WebSockets the <em>wss://</em> URI scheme is used (default port 443). Look out for <a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">Top 10 2013-A6-Sensitive Data Exposure</a> type issues. <br /><br /> <br /><br /><h3>Authentication</h3><br />WebSockets do not handle authentication, instead normal application  authentication mechanisms apply, such as cookies, HTTP Authentication or  TLS authentication. Look out for <a href="https://www.owasp.org/index.php/Top_10_2013-A2-Broken_Authentication_and_Session_Management">Top 10 2013-A2-Broken Authentication and Session Management</a> type issues. <br /><br /> <br /><br /><h3>Authorization</h3><br />WebSockets do not handle authorization, normal application authorization mechanisms apply. Look out for <a href="https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References">Top 10 2013-A4-Insecure Direct Object References</a> and <a href="https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control">Top 10 2013-A7-Missing Function Level Access Control</a> type issues. <br /><br /> <br /><br /><h3>Input Sanitization</h3><br />As with any data originating from untrusted sources, the data should be properly sanitised and encoded. Look out for <a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection">Top 10 2013-A1-Injection</a> and <a href="https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS)">Top 10 2013-A3-Cross-Site Scripting (XSS)</a> type issues. <br /><br /> <br /><br /><h2>How to Test</h2><br /><br /><h3>Black Box testing</h3><br />1. Identify that the application is using WebSockets.  <br />• Inspect the client-side source code for the <em>ws://</em> or <em>wss://</em> URI scheme.<br />• Use Google Chrome's Developer Tools to view the Network WebSocket communication.<br />• Use <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">OWASP Zed Attack Proxy</a> (ZAP)'s WebSocket tab.<br /><br /> 2. Origin. <br />•  Using a WebSocket client (one can be found in the Tools section below) attempt to connect to the remote WebSocket server. If a connection is established the server may not be checking the origin header of the WebSocket handshake.<br /><br /> 3. Confidentiality and Integrity. <br />•  Check that the WebSocket connection is using SSL to transport sensitive information (wss://).<br />•  Check the SSL Implementation for security issues (Valid Certificate, BEAST, CRIME, RC4, etc). Refer to the <a href="https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001)">Testing for Weak SSL/TLS Ciphers, Insufficient Transport Layer Protection (OTG-CRYPST-001)</a> section of this guide.<br /><br /> 4. Authentication. <br />•  WebSockets do not handle authentication, normal black-box authentication tests should be carried out. Refer to the <a href="https://www.owasp.org/index.php/Testing_for_authentication">Authentication Testing</a> sections of this guide.<br /><br /> 5. Authorization. <br />•  WebSockets do not handle authorization, normal black-box authorization tests should be carried out. Refer to the <a href="https://www.owasp.org/index.php/Testing_for_Authorization">Authorization Testing</a> sections of this guide.<br /><br /> 6. Input Sanitization. <br />•  Use <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">OWASP Zed Attack Proxy</a> (ZAP)'s WebSocket tab to replay and fuzz WebSocket request and responses. Refer to the <a href="https://www.owasp.org/index.php/Testing_for_Data_Validation">Testing for Data Validation</a> sections of this guide.<br /><br /> <strong>Example 1</strong> <br />Once we have identified that the application is using WebSockets (as described above) we can use the <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">OWASP Zed Attack Proxy (ZAP)</a> to intercept the WebSocket request and responses. ZAP can then be used to replay and fuzz the WebSocket request/responses. <br /><img src="images/91-1.png" alt="images/91-1.png" /> <br /><br /> <strong>Example 2</strong> <br />Using a WebSocket client (one can be found in the Tools section  below) attempt to connect to the remote WebSocket server. If the  connection is allowed the WebSocket server may not be checking the  WebSocket handshake's origin header. Attempt to replay requests  previously intercepted to verify that cross-domain WebSocket  communication is possible. <br /><img src="images/91-2.png" alt="images/91-2.png" /> <br /><br /> <br /><br /><h3>Gray Box testing</h3><br />Gray box testing is similar to black box testing. In gray box testing  the pen-tester has partial knowledge of the application. The only  difference here is that you may have API documentation for the  application being tested which includes the expected WebSocket request  and responses. <br /><br /><h2>Tools</h2><br />•  <strong>OWASP Zed Attack Proxy (ZAP)</strong> - <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project</a><br />ZAP is an easy to use integrated penetration testing tool for finding  vulnerabilities in web applications. It is designed to be used by  people with a wide range of security experience and as such is ideal for  developers and functional testers who are new to penetration testing.  ZAP provides automated scanners as well as a set of tools that allow you  to find security vulnerabilities manually. <br />• <strong>WebSocket Client</strong> - <a href="https://github.com/ethicalhack3r/scripts/blob/master/WebSockets.html">https://github.com/ethicalhack3r/scripts/blob/master/WebSockets.html</a><br />A WebSocket client that can be used to interact with a WebSocket server. <br />• <strong>Google Chrome Simple WebSocket Client</strong> - <a href="https://chrome.google.com/webstore/detail/simple-websocket-client/pfdhoblngboilpfeibdedpjgfnlcodoo?hl=en">https://chrome.google.com/webstore/detail/simple-websocket-client/pfdhoblngboilpfeibdedpjgfnlcodoo?hl=en</a><br />Construct custom Web Socket requests and handle responses to directly test your Web Socket services. <br /><br /><h2>References</h2><br /><strong>Whitepapers</strong><br /> <br />• <strong>HTML5 Rocks</strong> - Introducing WebSockets: Bringing Sockets to the Web: <a href="http://www.html5rocks.com/en/tutorials/websockets/basics/">http://www.html5rocks.com/en/tutorials/websockets/basics/</a><br />• <strong>W3C</strong> - The WebSocket API: <a href="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</a><br />• <strong>IETF</strong> - The WebSocket Protocol: <a href="https://tools.ietf.org/html/rfc6455">https://tools.ietf.org/html/rfc6455</a><br />• <strong>Christian Schneider</strong> - Cross-Site WebSocket Hijacking (CSWSH): <a href="http://www.christian-schneider.net/CrossSiteWebSocketHijacking.html">http://www.christian-schneider.net/CrossSiteWebSocketHijacking.html</a><br />• <strong>Jussi-Pekka Erkkilä</strong> - WebSocket Security Analysis: <a href="http://juerkkil.iki.fi/files/writings/websocket2012.pdf">http://juerkkil.iki.fi/files/writings/websocket2012.pdf</a><br />• <strong>Robert Koch</strong>- On WebSockets in Penetration Testing: <a href="http://www.ub.tuwien.ac.at/dipl/2013/AC07815487.pdf">http://www.ub.tuwien.ac.at/dipl/2013/AC07815487.pdf</a><br />• <strong>DigiNinja</strong> - OWASP ZAP and Web Sockets: <a href="http://www.digininja.org/blog/zap_web_sockets.php">http://www.digininja.org/blog/zap_web_sockets.php</a><br /></div></body></html>