<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>4.3.8 Test RIA cross domain policy (OTG-CONFIG-008)  </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">4.3.8 Test RIA cross domain policy (OTG-CONFIG-008)  </h1><br/><br /><h2>Summary</h2><br />Rich Internet Applications (RIA) have adopted Adobe's crossdomain.xml  policy files to allow for controlled cross domain access to data and  service consumption using technologies such as Oracle Java, Silverlight,  and Adobe Flash. Therefore, a domain can grant remote access to its  services from a different domain. However, often the policy files that  describe the access restrictions are poorly configured. Poor  configuration of the policy files enables Cross-site Request Forgery  attacks, and may allow third parties to access sensitive data meant for  the user.  <br /><br /> <br /><br /><h3>What are cross-domain policy files?</h3><br />A cross-domain policy file specifies the permissions that a web  client such as Java, Adobe Flash, Adobe Reader, etc. use to access data  across different domains. For Silverlight, Microsoft adopted a subset of  the Adobe's crossdomain.xml, and additionally created it's own  cross-domain policy file: clientaccesspolicy.xml. <br /><br /> Whenever a web client detects that a resource has to be requested from  other domain, it will first look for a policy file in the target domain  to determine if performing cross-domain requests, including headers, and  socket-based connections are allowed. <br /><br /> Master policy files are located at the domain's root. A client may be  instructed to load a different policy file but it will always check the  master policy file first to ensure that the master policy file permits  the requested policy file. <br /><br /> <br /><br /><h3>Crossdomain.xml vs. Clientaccesspolicy.xml</h3><br />Most RIA applications support crossdomain.xml. However in the case of  Silverlight, it will only work if the crossdomain.xml specifies that  access is allowed from any domain. For more granular control with  Silverlight, clientaccesspolicy.xml must be used. <br /><br /> Policy files grant several types of permissions: <br />•  Accepted policy files (Master policy files can disable or restrict specific policy files)<br />•  Sockets permissions<br />•  Header permissions<br />•  HTTP/HTTPS access permissions<br />•  Allowing access based on cryptographic credentials<br /><br /> An example of an overly permissive policy file: <br />&lt;?xml version="1.0"?&gt;<br />&lt;!DOCTYPE cross-domain-policy SYSTEM<br />"http://www.adobe.com/xml/dtds/cross-domain-policy.dtd"&gt;<br />&lt;cross-domain-policy&gt;<br />   &lt;site-control permitted-cross-domain-policies="all"/&gt;<br />   &lt;allow-access-from domain="*" secure="false"/&gt;<br />   &lt;allow-http-request-headers-from domain="*" headers="*" secure="false"/&gt;<br />&lt;/cross-domain-policy&gt;<br /><br /> <br /><br /><h3>How can cross domain policy files be abused?</h3><br />•  Overly permissive cross-domain policies.<br />•  Generating server responses that may be treated as cross-domain policy files.<br />•  Using file upload functionality to upload files that may be treated as cross-domain policy files.<br /><br /> <br /><br /><h3>Impact of abusing cross-domain access</h3><br />•  Defeat CSRF protections.<br />•  Read data restricted or otherwise protected by cross-origin policies.<br /><br /> <br /><br /><h2>How to Test</h2><br /><strong>Testing for RIA policy files weakness:</strong> <br /> To test for RIA policy file weakness the tester should try to retrieve  the policy files crossdomain.xml and clientaccesspolicy.xml from the  application's root, and from every folder found.<br /><br /> For example, if the application's URL is <a href="http://www.owasp.org">http://www.owasp.org</a>, the tester should try to download the files <a href="http://www.owasp.org/crossdomain.xml">http://www.owasp.org/crossdomain.xml</a> and <a href="http://www.owasp.org/clientaccesspolicy.xml">http://www.owasp.org/clientaccesspolicy.xml</a>. <br /><br /> After retrieving all the policy files, the permissions allowed should be  be checked under the least privilege principle. Requests should only  come from the domains, ports, or protocols that are necessary. Overly  permissive policies should be avoided. Policies with "*" in them should  be closely examined.  <br /><br /> Example: <br />&lt;cross-domain-policy&gt; <br /> &lt;allow-access-from domain="*" /&gt; <br />&lt;/cross-domain-policy&gt;<br /> <strong>Result Expected:</strong><br /> <br />• A list of policy files found. <br /><br />• A list of weak settings in the policies.<br /><br /><br /> <br /><br /><h2>Tools</h2><br />•  Nikto<br />•  OWASP Zed Attack Proxy Project<br />•  W3af<br /><br /> <br /><br /><h2>References</h2><br /><strong>Whitepapers</strong><br /> <br />•  UCSD: "Analyzing the Crossdomain Policies of Flash Applications" - <a href="http://cseweb.ucsd.edu/~hovav/dist/crossdomain.pdf">http://cseweb.ucsd.edu/~hovav/dist/crossdomain.pdf</a><br />•  Adobe: "Cross-domain policy file specification" - <a href="http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html">http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html</a><br />•  Adobe: "Cross-domain policy file usage recommendations for Flash Player" - <a href="http://www.adobe.com/devnet/flashplayer/articles/cross_domain_policy.html">http://www.adobe.com/devnet/flashplayer/articles/cross_domain_policy.html</a><br />•  Oracle: "Cross-Domain XML Support" - <a href="http://www.oracle.com/technetwork/java/javase/plugin2-142482.html#CROSSDOMAINXML">http://www.oracle.com/technetwork/java/javase/plugin2-142482.html#CROSSDOMAINXML</a><br />•  MSDN: "Making a Service Available Across Domain Boundaries" - <a href="http://msdn.microsoft.com/en-us/library/cc197955(v=vs.95).aspx">http://msdn.microsoft.com/en-us/library/cc197955(v=vs.95).aspx</a><br />•  MSDN: "Network Security Access Restrictions in Silverlight" - <a href="http://msdn.microsoft.com/en-us/library/cc645032(v=vs.95).aspx">http://msdn.microsoft.com/en-us/library/cc645032(v=vs.95).aspx</a><br />•  Stefan Esser: "Poking new holes with Flash Crossdomain Policy Files" <a href="http://www.hardened-php.net/library/poking_new_holes_with_flash_crossdomain_policy_files.html">http://www.hardened-php.net/library/poking_new_holes_with_flash_crossdomain_policy_files.html</a><br />•  Jeremiah Grossman: "Crossdomain.xml Invites Cross-site Mayhem" <a href="http://jeremiahgrossman.blogspot.com/2008/05/crossdomainxml-invites-cross-site.html">http://jeremiahgrossman.blogspot.com/2008/05/crossdomainxml-invites-cross-site.html</a><br />•  Google Doctype: "Introduction to Flash security " - <a href="http://code.google.com/p/doctype-mirror/wiki/ArticleFlashSecurity">http://code.google.com/p/doctype-mirror/wiki/ArticleFlashSecurity</a><br /></div></body></html>