<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>PHP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">PHP</h1><br/><strong>Apart from eval there are other ways to execute PHP code: include/require can be used for remote code execution in the form of Local File Include and Remote File Include vulnerabilities.</strong><br /><br />eval()<br />assert()  - identical to eval()<br />preg_replace('/.*/e',...) - /e does an eval() on the match<br />create_function()<br />include()<br />include_once()<br />require()<br />require_once()<br />$_GET['func_name']($_GET['argument']);<br />$func = new ReflectionFunction($_GET['func_name']); $func-&gt;invoke(); or $func-&gt;invokeArgs(array());<br /><br /><strong>Command execution</strong><br />exec           - Returns last line of commands output<br />passthru       - Passes commands output directly to the browser<br />system         - Passes commands output directly to the browser and returns last line<br />shell_exec     - Returns commands output<br />\`\` (backticks) - Same as shell_exec()<br />popen          - Opens read or write pipe to process of a command<br />proc_open      - Similar to popen() but greater degree of control<br />pcntl_exec     - Executes a program<br /><br /><strong>List of functions which accept callbacks</strong><br />These functions accept a string parameter which could be used to call a function of the attacker's choice. Depending on the function the attacker may or may not have the ability to pass a parameter. In that case an Information Disclosure function like phpinfo() could be used.<br /><br />Function                     =&gt; Position of callback arguments<br />'ob_start'                   =&gt;  0,<br />'array_diff_uassoc'          =&gt; -1,<br />'array_diff_ukey'            =&gt; -1,<br />'array_filter'               =&gt;  1,<br />'array_intersect_uassoc'     =&gt; -1,<br />'array_intersect_ukey'       =&gt; -1,<br />'array_map'                  =&gt;  0,<br />'array_reduce'               =&gt;  1,<br />'array_udiff_assoc'          =&gt; -1,<br />'array_udiff_uassoc'         =&gt; array(-1, -2),<br />'array_udiff'                =&gt; -1,<br />'array_uintersect_assoc'     =&gt; -1,<br />'array_uintersect_uassoc'    =&gt; array(-1, -2),<br />'array_uintersect'           =&gt; -1,<br />'array_walk_recursive'       =&gt;  1,<br />'array_walk'                 =&gt;  1,<br />'assert_options'             =&gt;  1,<br />'uasort'                     =&gt;  1,<br />'uksort'                     =&gt;  1,<br />'usort'                      =&gt;  1,<br />'preg_replace_callback'      =&gt;  1,<br />'spl_autoload_register'      =&gt;  0,<br />'iterator_apply'             =&gt;  1,<br />'call_user_func'             =&gt;  0,<br />'call_user_func_array'       =&gt;  0,<br />'register_shutdown_function' =&gt;  0,<br />'register_tick_function'     =&gt;  0,<br />'set_error_handler'          =&gt;  0,<br />'set_exception_handler'      =&gt;  0,<br />'session_set_save_handler'   =&gt; array(0, 1, 2, 3, 4, 5),<br />'sqlite_create_aggregate'    =&gt; array(2, 3),<br />'sqlite_create_function'     =&gt;  2,<br /><br /><strong>Other</strong><br /><br />extract - Opens the door for register_globals attacks (see study in scarlet).<br />parse_str -  works like extract if only one argument is given.  <br />putenv<br />ini_set<br />mail - has CRLF injection in the 3rd parameter, opens the door for spam. <br />header - on old systems CRLF injection could be used for xss or other purposes, now it is still a problem if they do a header("location: ..."); and they do not die();. The script keeps executing after a call to header(), and will still print output normally. This is nasty if you are trying to protect an administrative area. <br />proc_nice<br />proc_terminate<br />proc_close<br />pfsockopen<br />fsockopen<br />apache_child_terminate<br />posix_kill<br />posix_mkfifo<br />posix_setpgid<br />posix_setsid<br />posix_setuid<br /><br /><strong>Filesystem Functions</strong><br />According to RATS all filesystem functions in php are nasty. Some of these don't seem very useful to the attacker. Others are more useful than you might think. For instance if allow_url_fopen=On then a url can be used as a file path, so a call to copy($_GET['s'], $_GET['d']); can be used to upload a PHP script anywhere on the system. Also if a site is vulnerable to a request send via GET everyone of those file system functions can be abused to channel and attack to another host through your server.<br /><br />// open filesystem handler<br />fopen<br />tmpfile<br />bzopen<br />gzopen<br />SplFileObject-&gt;__construct<br />// write to filesystem (partially in combination with reading)<br />chgrp<br />chmod<br />chown<br />copy<br />file_put_contents<br />lchgrp<br />lchown<br />link<br />mkdir<br />move_uploaded_file<br />rename<br />rmdir<br />symlink<br />tempnam<br />touch<br />unlink<br />imagepng   - 2nd parameter is a path.<br />imagewbmp  - 2nd parameter is a path. <br />image2wbmp - 2nd parameter is a path. <br />imagejpeg  - 2nd parameter is a path.<br />imagexbm   - 2nd parameter is a path.<br />imagegif   - 2nd parameter is a path.<br />imagegd    - 2nd parameter is a path.<br />imagegd2   - 2nd parameter is a path.<br />iptcembed<br />ftp_get<br />ftp_nb_get<br />// read from filesystem<br />file_exists<br />file_get_contents<br />file<br />fileatime<br />filectime<br />filegroup<br />fileinode<br />filemtime<br />fileowner<br />fileperms<br />filesize<br />filetype<br />glob<br />is_dir<br />is_executable<br />is_file<br />is_link<br />is_readable<br />is_uploaded_file<br />is_writable<br />is_writeable<br />linkinfo<br />lstat<br />parse_ini_file<br />pathinfo<br />readfile<br />readlink<br />realpath<br />stat<br />gzfile<br />readgzfile<br />getimagesize<br />imagecreatefromgif<br />imagecreatefromjpeg<br />imagecreatefrompng<br />imagecreatefromwbmp<br />imagecreatefromxbm<br />imagecreatefromxpm<br />ftp_put<br />ftp_nb_put<br />exif_read_data<br />read_exif_data<br />exif_thumbnail<br />exif_imagetype<br />hash_file<br />hash_hmac_file<br />hash_update_file<br />md5_file<br />sha1_file<br />highlight_file<br />show_source<br />php_strip_whitespace<br />get_meta_tags<br /></div></body></html>